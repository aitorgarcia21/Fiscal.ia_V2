const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-BaWd0N-J.js","assets/vendor-UD6CX1rU.js"])))=>i.map(i=>d[i]);
import{j as e,X as t,m as s,M as r,E as i,U as n,C as a,A as o,S as l,a as c,b as d,B as u,c as h,T as p,L as m,d as f,e as g,G as b,H as x,Z as v,f as y,g as w,h as _,i as j,k,l as N,n as S,o as T,P as E,p as C,q as A,r as P,s as O,t as I,u as R}from"./ui-B_KOjy3N.js";import{a as $,g as L,c as U,r as D,b as F}from"./vendor-UD6CX1rU.js";import{u as q,B as M,R as z,a as B,N as J}from"./router-RMwWabV4.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var G={},V=$;G.createRoot=V.createRoot,G.hydrateRoot=V.hydrateRoot;const H={},K=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in H)return;H[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script"),i.crossOrigin="",i.href=e,s&&i.setAttribute("nonce",s),document.head.appendChild(i),t?new Promise(((t,s)=>{i.addEventListener("load",t),i.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then((t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)}))};class W extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Y extends W{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Q extends W{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class X extends W{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Z,ee;(ee=Z||(Z={})).Any="any",ee.ApNortheast1="ap-northeast-1",ee.ApNortheast2="ap-northeast-2",ee.ApSouth1="ap-south-1",ee.ApSoutheast1="ap-southeast-1",ee.ApSoutheast2="ap-southeast-2",ee.CaCentral1="ca-central-1",ee.EuCentral1="eu-central-1",ee.EuWest1="eu-west-1",ee.EuWest2="eu-west-2",ee.EuWest3="eu-west-3",ee.SaEast1="sa-east-1",ee.UsEast1="us-east-1",ee.UsWest1="us-west-1",ee.UsWest2="us-west-2";var te=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};class se{constructor(e,{headers:t={},customFetch:s,region:r=Z.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>K((async()=>{const{default:e}=await Promise.resolve().then((()=>fe));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return te(this,void 0,void 0,(function*(){try{const{headers:r,method:i,body:n}=t;let a,o={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(o["x-region"]=l),n&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",a=n):"string"==typeof n?(o["Content-Type"]="text/plain",a=n):"undefined"!=typeof FormData&&n instanceof FormData?a=n:(o["Content-Type"]="application/json",a=JSON.stringify(n)));const c=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:a}).catch((e=>{throw new Y(e)})),d=c.headers.get("x-relay-error");if(d&&"true"===d)throw new Q(c);if(!c.ok)throw new X(c);let u,h=(null!==(s=c.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return u="application/json"===h?yield c.json():"application/octet-stream"===h?yield c.blob():"text/event-stream"===h?c:"multipart/form-data"===h?yield c.formData():yield c.text(),{data:u,error:null}}catch(r){return{data:null,error:r}}}))}}var re={},ie={},ne={},ae={},oe={},le={},ce=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const de=ce.fetch,ue=ce.fetch.bind(ce),he=ce.Headers,pe=ce.Request,me=ce.Response,fe=Object.freeze(Object.defineProperty({__proto__:null,Headers:he,Request:pe,Response:me,default:ue,fetch:de},Symbol.toStringTag,{value:"Module"})),ge=L(fe);var be={};Object.defineProperty(be,"__esModule",{value:!0});let xe=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};be.default=xe;var ve=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(le,"__esModule",{value:!0});const ye=ve(ge),we=ve(be);le.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=ye.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async e=>{var t,s,r;let i=null,n=null,a=null,o=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(n="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const r=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");r&&c&&c.length>1&&(a=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(n)&&(n.length>1?(i={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,a=null,o=406,l="Not Acceptable"):n=1===n.length?n[0]:null)}else{const t=await e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(n=[],i=null,o=200,l="OK")}catch(c){404===e.status&&""===t?(o=204,l="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(r=null==i?void 0:i.details)||void 0===r?void 0:r.includes("0 rows"))&&(i=null,o=200,l="OK"),i&&this.shouldThrowOnError)throw new we.default(i)}return{error:i,data:n,count:a,status:o,statusText:l}}));return this.shouldThrowOnError||(s=s.catch((e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}}))),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var _e=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(oe,"__esModule",{value:!0});const je=_e(le);let ke=class extends je.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:i=r}={}){const n=i?`${i}.order`:"order",a=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const i=void 0===r?"offset":`${r}.offset`,n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(n,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:i=!1,format:n="text"}={}){var a;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=null!==(a=this.headers.Accept)&&void 0!==a?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};oe.default=ke;var Ne=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ae,"__esModule",{value:!0});const Se=Ne(oe);let Te=class extends Se.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let i="";"plain"===r?i="pl":"phrase"===r?i="ph":"websearch"===r&&(i="w");const n=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${n}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};ae.default=Te;var Ee=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ne,"__esModule",{value:!0});const Ce=Ee(ae);ne.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let i=!1;const n=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e))).join("");return this.url.searchParams.set("select",n),s&&(this.headers.Prefer=`count=${s}`),new Ce.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new Ce.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:i=!0}={}){const n=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&n.push(this.headers.Prefer),r&&n.push(`count=${r}`),i||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new Ce.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Ce.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new Ce.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var Ae={},Pe={};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.version=void 0,Pe.version="0.0.0-automated",Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.DEFAULT_HEADERS=void 0;const Oe=Pe;Ae.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Oe.version}`};var Ie=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ie,"__esModule",{value:!0});const Re=Ie(ne),$e=Ie(ae),Le=Ae;ie.default=class e{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},Le.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new Re.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:i}={}){let n;const a=new URL(`${this.url}/rpc/${e}`);let o;s||r?(n=s?"HEAD":"GET",Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`])).forEach((([e,t])=>{a.searchParams.append(e,t)}))):(n="POST",o=t);const l=Object.assign({},this.headers);return i&&(l.Prefer=`count=${i}`),new $e.default({method:n,url:a,headers:l,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}};var Ue=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(re,"__esModule",{value:!0}),re.PostgrestError=re.PostgrestBuilder=re.PostgrestTransformBuilder=re.PostgrestFilterBuilder=re.PostgrestQueryBuilder=re.PostgrestClient=void 0;const De=Ue(ie);re.PostgrestClient=De.default;const Fe=Ue(ne);re.PostgrestQueryBuilder=Fe.default;const qe=Ue(ae);re.PostgrestFilterBuilder=qe.default;const Me=Ue(oe);re.PostgrestTransformBuilder=Me.default;const ze=Ue(le);re.PostgrestBuilder=ze.default;const Be=Ue(be);re.PostgrestError=Be.default;var Je=re.default={PostgrestClient:De.default,PostgrestQueryBuilder:Fe.default,PostgrestFilterBuilder:qe.default,PostgrestTransformBuilder:Me.default,PostgrestBuilder:ze.default,PostgrestError:Be.default};const{PostgrestClient:Ge,PostgrestQueryBuilder:Ve,PostgrestFilterBuilder:He,PostgrestTransformBuilder:Ke,PostgrestBuilder:We,PostgrestError:Ye}=Je,Qe={"X-Client-Info":"realtime-js/2.11.2"};var Xe,Ze,et,tt,st,rt,it,nt,at,ot,lt;(Ze=Xe||(Xe={}))[Ze.connecting=0]="connecting",Ze[Ze.open=1]="open",Ze[Ze.closing=2]="closing",Ze[Ze.closed=3]="closed",(tt=et||(et={})).closed="closed",tt.errored="errored",tt.joined="joined",tt.joining="joining",tt.leaving="leaving",(rt=st||(st={})).close="phx_close",rt.error="phx_error",rt.join="phx_join",rt.reply="phx_reply",rt.leave="phx_leave",rt.access_token="access_token",(it||(it={})).websocket="websocket",(at=nt||(nt={})).Connecting="connecting",at.Open="open",at.Closing="closing",at.Closed="closed";class ct{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),i=t.getUint8(2);let n=this.HEADER_LENGTH+2;const a=s.decode(e.slice(n,n+r));n+=r;const o=s.decode(e.slice(n,n+i));n+=i;return{ref:null,topic:a,event:o,payload:JSON.parse(s.decode(e.slice(n,e.byteLength)))}}}class dt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}(lt=ot||(ot={})).abstime="abstime",lt.bool="bool",lt.date="date",lt.daterange="daterange",lt.float4="float4",lt.float8="float8",lt.int2="int2",lt.int4="int4",lt.int4range="int4range",lt.int8="int8",lt.int8range="int8range",lt.json="json",lt.jsonb="jsonb",lt.money="money",lt.numeric="numeric",lt.oid="oid",lt.reltime="reltime",lt.text="text",lt.time="time",lt.timestamp="timestamp",lt.timestamptz="timestamptz",lt.timetz="timetz",lt.tsrange="tsrange",lt.tstzrange="tstzrange";const ut=(e,t,s={})=>{var r;const i=null!==(r=s.skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce(((s,r)=>(s[r]=ht(r,e,t,i),s)),{})},ht=(e,t,s,r)=>{const i=t.find((t=>t.name===e)),n=null==i?void 0:i.type,a=s[e];return n&&!r.includes(n)?pt(n,a):mt(a)},pt=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return xt(t,s)}switch(e){case ot.bool:return ft(t);case ot.float4:case ot.float8:case ot.int2:case ot.int4:case ot.int8:case ot.numeric:case ot.oid:return gt(t);case ot.json:case ot.jsonb:return bt(t);case ot.timestamp:return vt(t);case ot.abstime:case ot.date:case ot.daterange:case ot.int4range:case ot.int8range:case ot.money:case ot.reltime:case ot.text:case ot.time:case ot.timestamptz:case ot.timetz:case ot.tsrange:case ot.tstzrange:default:return mt(t)}},mt=e=>e,ft=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},gt=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},bt=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},xt=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const n=e.slice(1,s);try{r=JSON.parse("["+n+"]")}catch(i){r=n?n.split(","):[]}return r.map((e=>pt(t,e)))}return e},vt=e=>"string"==typeof e?e.replace(" ","T"):e,yt=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class wt{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var _t,jt,kt,Nt,St,Tt,Et,Ct;(jt=_t||(_t={})).SYNC="sync",jt.JOIN="join",jt.LEAVE="leave";class At{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},(e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=At.syncState(this.state,e,t,s),this.pendingDiffs.forEach((e=>{this.state=At.syncDiff(this.state,e,t,s)})),this.pendingDiffs=[],r()})),this.channel._on(s.diff,{},(e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=At.syncDiff(this.state,e,t,s),r())})),this.onJoin(((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})})),this.onLeave(((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,s,r){const i=this.cloneDeep(e),n=this.transformState(t),a={},o={};return this.map(i,((e,t)=>{n[e]||(o[e]=t)})),this.map(n,((e,t)=>{const s=i[e];if(s){const r=t.map((e=>e.presence_ref)),i=s.map((e=>e.presence_ref)),n=t.filter((e=>i.indexOf(e.presence_ref)<0)),l=s.filter((e=>r.indexOf(e.presence_ref)<0));n.length>0&&(a[e]=n),l.length>0&&(o[e]=l)}else a[e]=t})),this.syncDiff(i,{joins:a,leaves:o},s,r)}static syncDiff(e,t,s,r){const{joins:i,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,((t,r)=>{var i;const n=null!==(i=e[t])&&void 0!==i?i:[];if(e[t]=this.cloneDeep(r),n.length>0){const s=e[t].map((e=>e.presence_ref)),r=n.filter((e=>s.indexOf(e.presence_ref)<0));e[t].unshift(...r)}s(t,n,r)})),this.map(n,((t,s)=>{let i=e[t];if(!i)return;const n=s.map((e=>e.presence_ref));i=i.filter((e=>n.indexOf(e.presence_ref)<0)),e[t]=i,r(t,i,s),0===i.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((s=>t(s,e[s])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):r,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Nt=kt||(kt={})).ALL="*",Nt.INSERT="INSERT",Nt.UPDATE="UPDATE",Nt.DELETE="DELETE",(Tt=St||(St={})).BROADCAST="broadcast",Tt.PRESENCE="presence",Tt.POSTGRES_CHANGES="postgres_changes",Tt.SYSTEM="system",(Ct=Et||(Et={})).SUBSCRIBED="SUBSCRIBED",Ct.TIMED_OUT="TIMED_OUT",Ct.CLOSED="CLOSED",Ct.CHANNEL_ERROR="CHANNEL_ERROR";class Pt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=et.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new wt(this,st.join,this.params,this.timeout),this.rejoinTimer=new dt((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=et.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=et.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=et.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=et.errored,this.rejoinTimer.scheduleTimeout())})),this._on(st.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new At(this),this.broadcastEndpointURL=yt(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:n,private:a}}=this.params;this._onError((t=>null==e?void 0:e(Et.CHANNEL_ERROR,t))),this._onClose((()=>null==e?void 0:e(Et.CLOSED)));const o={},l={broadcast:i,presence:n,postgres_changes:null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map((e=>e.filter)))&&void 0!==r?r:[],private:a};this.socket.accessTokenValue&&(o.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,i=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,n=[];for(let s=0;s<i;s++){const i=r[s],{filter:{event:a,schema:o,table:l,filter:c}}=i,d=t&&t[s];if(!d||d.event!==a||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),void(null==e||e(Et.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},i),{id:d.id}))}return this.bindings.postgres_changes=n,void(e&&e(Et.SUBSCRIBED))}null==e||e(Et.SUBSCRIBED)})).receive("error",(t=>{null==e||e(Et.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{null==e||e(Et.TIMED_OUT)}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise((s=>{var r,i,n;const a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(n=null===(i=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===i?void 0:i.broadcast)||void 0===n?void 0:n.ack)||s("ok"),a.receive("ok",(()=>s("ok"))),a.receive("error",(()=>s("error"))),a.receive("timeout",(()=>s("timed out")))}));{const{event:n,payload:a}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(i){return"AbortError"===i.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=et.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(st.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((s=>{const r=new wt(this,st.leave,{},e);r.receive("ok",(()=>{t(),s("ok")})).receive("timeout",(()=>{t(),s("timed out")})).receive("error",(()=>{s("error")})),r.send(),this._canPush()||r.trigger("ok",{})}))}async _fetchWithTimeout(e,t,s){const r=new AbortController,i=setTimeout((()=>r.abort()),s),n=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),n}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new wt(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,i;const n=e.toLocaleLowerCase(),{close:a,error:o,leave:l,join:c}=st;if(s&&[a,o,l,c].indexOf(n)>=0&&s!==this._joinRef())return;let d=this._onMessage(n,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter((e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===n})).map((e=>e.callback(d,s))):null===(i=this.bindings[n])||void 0===i||i.filter((e=>{var s,r,i,a,o,l;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in e){const n=e.id,a=null===(s=e.filter)||void 0===s?void 0:s.event;return n&&(null===(r=t.ids)||void 0===r?void 0:r.includes(n))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null===(i=t.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{const s=null===(o=null===(a=null==e?void 0:e.filter)||void 0===a?void 0:a.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===n})).map((e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:r,type:i,errors:n}=e,a={schema:t,table:s,commit_timestamp:r,eventType:i,new:{},old:{},errors:n};d=Object.assign(Object.assign({},a),this._getPayloadRecords(e))}e.callback(d,s)}))}_isClosed(){return this.state===et.closed}_isJoined(){return this.state===et.joined}_isJoining(){return this.state===et.joining}_isLeaving(){return this.state===et.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter((e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&Pt.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(st.close,{},e)}_onError(e){this._on(st.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=et.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=ut(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=ut(e.columns,e.old_record)),t}}const Ot=()=>{},It="undefined"!=typeof WebSocket;class Rt{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Qe,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ot,this.conn=null,this.sendBuffer=[],this.serializer=new ct,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>K((async()=>{const{default:e}=await Promise.resolve().then((()=>fe));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${it.websocket}`,this.httpEndpoint=yt(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const r=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new dt((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});else{if(It)return this.conn=new WebSocket(this.endpointURL()),void this.setupConnection();this.conn=new $t(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),K((async()=>{const{default:e}=await import("./browser-BaWd0N-J.js").then((e=>e.b));return{default:e}}),__vite__mapDeps([0,1])).then((({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()}))}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Xe.connecting:return nt.Connecting;case Xe.open:return nt.Open;case Xe.closing:return nt.Closing;default:return nt.Closed}}isConnected(){return this.connectionState()===nt.Open}channel(e,t={config:{}}){const s=new Pt(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:r,ref:i}=e,n=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${s} (${i})`,r),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let e=null;try{e=JSON.parse(atob(t.split(".")[1]))}catch(s){}if(e&&e.exp){if(!(Math.floor(Date.now()/1e3)-e.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`)}this.accessTokenValue=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(st.access_token,{access_token:t})}))}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t._joinRef()!==e._joinRef()))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:s,payload:r,ref:i}=e;i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${t} ${s} ${i&&"("+i+")"||""}`,r),this.channels.filter((e=>e._isMember(t))).forEach((e=>e._trigger(s,r,i))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(st.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class $t{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Xe.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class Lt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ut(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Dt extends Lt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ft extends Lt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var qt=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const Mt=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>K((async()=>{const{default:e}=await Promise.resolve().then((()=>fe));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},zt=e=>{if(Array.isArray(e))return e.map((e=>zt(e)));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach((([e,s])=>{const r=e.replace(/([-_][a-z])/gi,(e=>e.toUpperCase().replace(/[-_]/g,"")));t[r]=zt(s)})),t};var Bt=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const Jt=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Gt=(e,t,s)=>Bt(void 0,void 0,void 0,(function*(){const r=yield qt(void 0,void 0,void 0,(function*(){return"undefined"==typeof Response?(yield K((()=>Promise.resolve().then((()=>fe))),void 0)).Response:Response}));e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then((s=>{t(new Dt(Jt(s),e.status||500))})).catch((e=>{t(new Ft(Jt(e),e))})):t(new Ft(Jt(e),e))}));function Vt(e,t,s,r,i,n){return Bt(this,void 0,void 0,(function*(){return new Promise(((a,o)=>{e(s,((e,t,s,r)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),r&&(i.body=JSON.stringify(r)),Object.assign(Object.assign({},i),s))})(t,r,i,n)).then((e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()})).then((e=>a(e))).catch((e=>Gt(e,o,r)))}))}))}function Ht(e,t,s,r){return Bt(this,void 0,void 0,(function*(){return Vt(e,"GET",t,s,r)}))}function Kt(e,t,s,r,i){return Bt(this,void 0,void 0,(function*(){return Vt(e,"POST",t,r,i,s)}))}function Wt(e,t,s,r,i){return Bt(this,void 0,void 0,(function*(){return Vt(e,"DELETE",t,r,i,s)}))}var Yt=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const Qt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Xt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Zt{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Mt(r)}uploadOrUpdate(e,t,s,r){return Yt(this,void 0,void 0,(function*(){try{let i;const n=Object.assign(Object.assign({},Xt),r);let a=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});const o=n.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(i=new FormData,i.append("cacheControl",n.cacheControl),o&&i.append("metadata",this.encodeMetadata(o)),i.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(i=s,i.append("cacheControl",n.cacheControl),o&&i.append("metadata",this.encodeMetadata(o))):(i=s,a["cache-control"]=`max-age=${n.cacheControl}`,a["content-type"]=n.contentType,o&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==r?void 0:r.headers)&&(a=Object.assign(Object.assign({},a),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:a},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{})),u=yield d.json();if(d.ok)return{data:{path:l,id:u.Id,fullPath:u.Key},error:null};return{data:null,error:u}}catch(i){if(Ut(i))return{data:null,error:i};throw i}}))}upload(e,t,s){return Yt(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,s)}))}uploadToSignedUrl(e,t,s,r){return Yt(this,void 0,void 0,(function*(){const i=this._removeEmptyFolders(e),n=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${n}`);a.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Xt.upsert},r),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,n["cache-control"]=`max-age=${t.cacheControl}`,n["content-type"]=t.contentType);const o=yield this.fetch(a.toString(),{method:"PUT",body:e,headers:n}),l=yield o.json();if(o.ok)return{data:{path:i,fullPath:l.Key},error:null};return{data:null,error:l}}catch(o){if(Ut(o))return{data:null,error:o};throw o}}))}createSignedUploadUrl(e,t){return Yt(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const i=yield Kt(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),n=new URL(this.url+i.url),a=n.searchParams.get("token");if(!a)throw new Lt("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:a},error:null}}catch(s){if(Ut(s))return{data:null,error:s};throw s}}))}update(e,t,s){return Yt(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,s)}))}move(e,t,s){return Yt(this,void 0,void 0,(function*(){try{return{data:yield Kt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(Ut(r))return{data:null,error:r};throw r}}))}copy(e,t,s){return Yt(this,void 0,void 0,(function*(){try{return{data:{path:(yield Kt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(Ut(r))return{data:null,error:r};throw r}}))}createSignedUrl(e,t,s){return Yt(this,void 0,void 0,(function*(){try{let r=this._getFinalPath(e),i=yield Kt(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${n}`)},{data:i,error:null}}catch(r){if(Ut(r))return{data:null,error:r};throw r}}))}createSignedUrls(e,t,s){return Yt(this,void 0,void 0,(function*(){try{const r=yield Kt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${i}`):null}))),error:null}}catch(r){if(Ut(r))return{data:null,error:r};throw r}}))}download(e,t){return Yt(this,void 0,void 0,(function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=r?`?${r}`:"";try{const t=this._getFinalPath(e),r=yield Ht(this.fetch,`${this.url}/${s}/${t}${i}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(n){if(Ut(n))return{data:null,error:n};throw n}}))}info(e){return Yt(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{const e=yield Ht(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:zt(e),error:null}}catch(s){if(Ut(s))return{data:null,error:s};throw s}}))}exists(e){return Yt(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return Bt(this,void 0,void 0,(function*(){return Vt(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)}))}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(Ut(s)&&s instanceof Ft){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}}))}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],i=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==i&&r.push(i);const n=void 0!==(null==t?void 0:t.transform)?"render/image":"object",a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&r.push(a);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${s}${o}`)}}}remove(e){return Yt(this,void 0,void 0,(function*(){try{return{data:yield Wt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Ut(t))return{data:null,error:t};throw t}}))}list(e,t,s){return Yt(this,void 0,void 0,(function*(){try{const r=Object.assign(Object.assign(Object.assign({},Qt),t),{prefix:e||""});return{data:yield Kt(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(Ut(r))return{data:null,error:r};throw r}}))}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const es={"X-Client-Info":"storage-js/2.7.1"};var ts=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};class ss{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},es),t),this.fetch=Mt(s)}listBuckets(){return ts(this,void 0,void 0,(function*(){try{return{data:yield Ht(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Ut(e))return{data:null,error:e};throw e}}))}getBucket(e){return ts(this,void 0,void 0,(function*(){try{return{data:yield Ht(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Ut(t))return{data:null,error:t};throw t}}))}createBucket(e,t={public:!1}){return ts(this,void 0,void 0,(function*(){try{return{data:yield Kt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Ut(s))return{data:null,error:s};throw s}}))}updateBucket(e,t){return ts(this,void 0,void 0,(function*(){try{const s=yield function(e,t,s,r,i){return Bt(this,void 0,void 0,(function*(){return Vt(e,"PUT",t,r,i,s)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:s,error:null}}catch(s){if(Ut(s))return{data:null,error:s};throw s}}))}emptyBucket(e){return ts(this,void 0,void 0,(function*(){try{return{data:yield Kt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Ut(t))return{data:null,error:t};throw t}}))}deleteBucket(e){return ts(this,void 0,void 0,(function*(){try{return{data:yield Wt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Ut(t))return{data:null,error:t};throw t}}))}}class rs extends ss{constructor(e,t={},s){super(e,t,s)}from(e){return new Zt(this.url,this.headers,e,this.fetch)}}let is="";is="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const ns={headers:{"X-Client-Info":`supabase-js-${is}/2.49.8`}},as={schema:"public"},os={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ls={};var cs=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const ds=(e,t,s)=>{const r=(e=>{let t;return t=e||("undefined"==typeof fetch?ue:fetch),(...e)=>t(...e)})(s),i="undefined"==typeof Headers?he:Headers;return(s,n)=>cs(void 0,void 0,void 0,(function*(){var a;const o=null!==(a=yield t())&&void 0!==a?a:e;let l=new i(null==n?void 0:n.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,Object.assign(Object.assign({},n),{headers:l}))}))};var us=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const hs="2.69.1",ps=3e4,ms=9e4,fs={"X-Client-Info":`gotrue-js/${hs}`},gs="X-Supabase-Api-Version",bs={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},xs=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class vs extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function ys(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class ws extends vs{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class _s extends vs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class js extends vs{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class ks extends js{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Ns extends js{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ss extends js{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ts extends js{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Es extends js{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Cs extends js{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function As(e){return ys(e)&&"AuthRetryableFetchError"===e.name}class Ps extends js{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Os extends js{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Is="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Rs=" \t\n\r=".split(""),$s=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Rs.length;t+=1)e[Rs[t].charCodeAt(0)]=-2;for(let t=0;t<Is.length;t+=1)e[Is[t].charCodeAt(0)]=t;return e})();function Ls(e,t,s){const r=$s[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Us(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let a=0;a<e.length;a+=1)Ls(e.charCodeAt(a),i,n);return t.join("")}function Ds(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Fs(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let i=0;i<e.length;i+=1)Ls(e.charCodeAt(i),s,r);return new Uint8Array(t)}function qs(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}Ds(r,t)}}(e,(e=>t.push(e))),new Uint8Array(t)}const Ms=()=>"undefined"!=typeof window&&"undefined"!=typeof document,zs={tested:!1,writable:!1},Bs=()=>{if(!Ms())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(zs.tested)return zs.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),zs.tested=!0,zs.writable=!0}catch(t){zs.tested=!0,zs.writable=!1}return zs.writable};const Js=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>K((async()=>{const{default:e}=await Promise.resolve().then((()=>fe));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},Gs=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},Vs=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(r){return s}},Hs=async(e,t)=>{await e.removeItem(t)};class Ks{constructor(){this.promise=new Ks.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function Ws(e){const t=e.split(".");if(3!==t.length)throw new Os("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!xs.test(t[s]))throw new Os("JWT not in base64url format");return{header:JSON.parse(Us(t[0])),payload:JSON.parse(Us(t[1])),signature:Fs(t[2]),raw:{header:t[0],payload:t[1]}}}function Ys(e){return("0"+e.toString(16)).substr(-2)}async function Qs(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map((e=>String.fromCharCode(e))).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Xs(e,t,s=!1){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Ys).join("")}();let i=r;s&&(i+="/PASSWORD_RECOVERY"),await Gs(e,`${t}-code-verifier`,i);const n=await Qs(r);return[n,r===n?"plain":"s256"]}Ks.promiseConstructor=Promise;const Zs=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const er=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),tr=[502,503,504];async function sr(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Cs(er(e),0);if(tr.includes(e.status))throw new Cs(er(e),e.status);let r,i;try{r=await e.json()}catch(a){throw new _s(er(a),a)}const n=function(e){const t=e.headers.get(gs);if(!t)return null;if(!t.match(Zs))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(a){return null}}(e);if(n&&n.getTime()>=bs.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?i=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(i=r.error_code),i){if("weak_password"===i)throw new Ps(er(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===i)throw new ks}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new Ps(er(r),e.status,r.weak_password.reasons);throw new ws(er(r),e.status||500,i)}async function rr(e,t,s,r){var i;const n=Object.assign({},null==r?void 0:r.headers);n[gs]||(n[gs]=bs.name),(null==r?void 0:r.jwt)&&(n.Authorization=`Bearer ${r.jwt}`);const a=null!==(i=null==r?void 0:r.query)&&void 0!==i?i:{};(null==r?void 0:r.redirectTo)&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await async function(e,t,s,r,i,n){const a=((e,t,s,r)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),s))})(t,r,i,n);let o;try{o=await e(s,Object.assign({},a))}catch(l){throw console.error(l),new Cs(er(l),0)}o.ok||await sr(o);if(null==r?void 0:r.noResolveJson)return o;try{return await o.json()}catch(l){await sr(l)}}(e,t,s+o,{headers:n,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function ir(e){var t;let s=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function nr(e){const t=ir(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function ar(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function or(e){return{data:e,error:null}}function lr(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:i,verification_type:n}=e,a=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:i,verification_type:n},user:Object.assign({},a)},error:null}}function cr(e){return e}class dr{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Js(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await rr(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(ys(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await rr(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ar})}catch(s){if(ys(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s}(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await rr(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:lr,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(ys(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await rr(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ar})}catch(t){if(ys(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,i,n,a,o;try{const l={nextPage:null,lastPage:0,total:0},c=await rr(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(i=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==i?i:""},xform:cr});if(c.error)throw c.error;const d=await c.json(),u=null!==(n=c.headers.get("x-total-count"))&&void 0!==n?n:0,h=null!==(o=null===(a=c.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t})),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(ys(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await rr(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ar})}catch(t){if(ys(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await rr(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ar})}catch(s){if(ys(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await rr(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ar})}catch(s){if(ys(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await rr(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(ys(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await rr(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ys(t))return{data:null,error:t};throw t}}}const ur={getItem:e=>Bs()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{Bs()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{Bs()&&globalThis.localStorage.removeItem(e)}};function hr(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const pr=!!(globalThis&&Bs()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class mr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class fr extends mr{}async function gr(e,t,s){pr&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout((()=>{r.abort(),pr&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)}),t),await Promise.resolve().then((()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},(async r=>{if(!r){if(0===t)throw pr&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new fr(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(pr)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}pr&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await s()}finally{pr&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const br={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:fs,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function xr(e,t,s){return await s()}class vr{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=vr.nextInstanceID,vr.nextInstanceID+=1,this.instanceID>0&&Ms()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},br),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new dr({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Js(r.fetch),this.lock=r.lock||xr,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:Ms()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=gr:this.lock=xr,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:Bs()?this.storage=ur:(this.memoryStorage={},this.storage=hr(this.memoryStorage)):(this.memoryStorage={},this.storage=hr(this.memoryStorage)),Ms()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",(async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${hs}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach(((e,s)=>{t[s]=e}))}catch(r){}return s.searchParams.forEach(((e,s)=>{t[s]=e})),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),Ms()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),function(e){return ys(e)&&"AuthImplicitGrantRedirectError"===e.name}(i)){const t=null===(e=i.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:i}}return await this._removeSession(),{error:i}}const{session:n,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",n,"redirect type",a),await this._saveSession(n),setTimeout((async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",n):await this._notifyAllSubscribers("SIGNED_IN",n)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ys(t)?{error:t}:{error:new _s("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const i=await rr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:ir}),{data:n,error:a}=i;if(a||!n)return{data:{user:null,session:null},error:a};const o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(i){if(ys(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,r;try{let i;if("email"in e){const{email:s,password:r,options:n}=e;let a=null,o=null;"pkce"===this.flowType&&([a,o]=await Xs(this.storage,this.storageKey)),i=await rr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:a,code_challenge_method:o},xform:ir})}else{if(!("phone"in e))throw new Ss("You must provide either an email or phone number and a password");{const{phone:t,password:n,options:a}=e;i=await rr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:n,data:null!==(s=null==a?void 0:a.data)&&void 0!==s?s:{},channel:null!==(r=null==a?void 0:a.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:ir})}}const{data:n,error:a}=i;if(a||!n)return{data:{user:null,session:null},error:a};const o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(i){if(ys(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:r,options:i}=e;t=await rr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:nr})}else{if(!("phone"in e))throw new Ss("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:i}=e;t=await rr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:nr})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new Ns}}catch(t){if(ys(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(e)))}async _exchangeCodeForSession(e){const t=await Vs(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:i}=await rr(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:ir});if(await Hs(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:i}):{data:{user:null,session:null,redirectType:null},error:new Ns}}catch(i){if(ys(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:i,nonce:n}=e,a=await rr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:ir}),{data:o,error:l}=a;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new Ns}}catch(t){if(ys(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,i,n;try{if("email"in e){const{email:r,options:i}=e;let n=null,a=null;"pkce"===this.flowType&&([n,a]=await Xs(this.storage,this.storageKey));const{error:o}=await rr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},create_user:null===(s=null==i?void 0:i.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:a},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:a,error:o}=await rr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(i=null==s?void 0:s.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(n=null==s?void 0:s.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o}}throw new Ss("You must provide either an email or phone number.")}catch(a){if(ys(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let r,i;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,i=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:n,error:a}=await rr(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:ir});if(a)throw a;if(!n)throw new Error("An error occurred on token verification.");const o=n.session,l=n.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(ys(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let i=null,n=null;return"pkce"===this.flowType&&([i,n]=await Xs(this.storage,this.storageKey)),await rr(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:n}),headers:this.headers,xform:or})}catch(i){if(ys(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new ks;const{error:r}=await rr(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}}))}catch(e){if(ys(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:i}=e,{error:n}=await rr(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){const{phone:s,type:r,options:i}=e,{data:n,error:a}=await rr(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:a}}throw new Ss("You must provide either an email or phone number and a type")}catch(t){if(ys(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,(async()=>this._useSession((async e=>e))))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Vs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<ms;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,(async()=>await this._getUser()))}async _getUser(e){try{return e?await rr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ar}):await this._useSession((async e=>{var t,s,r;const{data:i,error:n}=e;if(n)throw n;return(null===(t=i.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await rr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=i.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:ar}):{data:{user:null},error:new ks}}))}catch(t){if(ys(t))return function(e){return ys(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await Hs(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(e,t)))}async _updateUser(e,t={}){try{return await this._useSession((async s=>{const{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new ks;const n=r.session;let a=null,o=null;"pkce"===this.flowType&&null!=e.email&&([a,o]=await Xs(this.storage,this.storageKey));const{data:l,error:c}=await rr(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:o}),jwt:n.access_token,xform:ar});if(c)throw c;return n.user=l.user,await this._saveSession(n),await this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}}))}catch(s){if(ys(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(e)))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ks;const t=Date.now()/1e3;let s=t,r=!0,i=null;const{payload:n}=Ws(e.access_token);if(n.exp&&(s=n.exp,r=s<=t),r){const{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};i=t}else{const{data:r,error:n}=await this._getUser(e.access_token);if(n)throw n;i={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(ys(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(e)))}async _refreshSession(e){try{return await this._useSession((async t=>{var s;if(!e){const{data:r,error:i}=t;if(i)throw i;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new ks;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(ys(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Ms())throw new Ts("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ts(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Es("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Ts("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Es("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:n,expires_in:a,expires_at:o,token_type:l}=e;if(!(i&&a&&n&&l))throw new Ts("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(a);let u=c+d;o&&(u=parseInt(o));const h=u-c;1e3*h<=ps&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const p=u-d;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,u,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,u,c);const{data:m,error:f}=await this._getUser(i);if(f)throw f;const g={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:d,expires_at:u,refresh_token:n,token_type:l,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(s){if(ys(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Vs(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(e)))}async _signOut({scope:e}={scope:"global"}){return await this._useSession((async t=>{var s;const{data:r,error:i}=t;if(i)return{error:i};const n=null===(s=r.session)||void 0===s?void 0:s.access_token;if(n){const{error:t}=await this.admin.signOut(n,e);if(t&&(!function(e){return ys(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await Hs(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(t)}))})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession((async t=>{var s,r;try{const{data:{session:r},error:i}=t;if(i)throw i;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(i){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}}))}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await Xs(this.storage,this.storageKey,!0));try{return await rr(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(ys(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(ys(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession((async t=>{var s,r,i,n,a;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(i=e.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:!0});return await rr(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(a=null===(n=o.session)||void 0===n?void 0:n.access_token)&&void 0!==a?a:void 0})}));if(r)throw r;return Ms()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(ys(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession((async t=>{var s,r;const{data:i,error:n}=t;if(n)throw n;return await rr(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=i.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})}))}catch(t){if(ys(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const i=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise((t=>{setTimeout((()=>t(null)),e)}))}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await rr(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ir})),r=(e,t)=>{const s=200*Math.pow(2,e);return t&&As(t)&&Date.now()+s-i<ps},new Promise(((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{const t=await s(n);if(!r(n,null,t))return void e(t)}catch(i){if(!r(n,i))return void t(i)}})()})))}catch(i){if(this._debug(t,"error",i),ys(i))return{data:{session:null,user:null},error:i};throw i}finally{this._debug(t,"end")}var s,r}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Ms()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Vs(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s))return this._debug(t,"session is not valid"),void(null!==s&&await this._removeSession());const r=1e3*(null!==(e=s.expires_at)&&void 0!==e?e:1/0)-Date.now()<ms;if(this._debug(t,`session has${r?"":" not"} expired with margin of 90000s`),r){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),As(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return this._debug(t,"error",s),void console.error(s)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new ks;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Ks;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new ks;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(i){if(this._debug(r,"error",i),ys(i)){const e={session:null,error:i};return As(i)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],i=Array.from(this.stateChangeEmitters.values()).map((async s=>{try{await s.callback(e,t)}catch(i){r.push(i)}}));if(await Promise.all(i),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Gs(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Hs(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ms()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),ps);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const t=Date.now();try{return await this._useSession((async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-t)/ps);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof mr))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ms()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await Xs(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession((async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await rr(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(ys(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession((async t=>{var s,r;const{data:i,error:n}=t;if(n)return{data:null,error:n};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await rr(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}))}catch(t){if(ys(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:n,error:a}=await rr(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",n),{data:n,error:a})}))}catch(t){if(ys(t))return{data:null,error:t};throw t}}))}async _challenge(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await rr(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(ys(t))return{data:null,error:t};throw t}}))}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],r=s.filter((e=>"totp"===e.factor_type&&"verified"===e.status)),i=s.filter((e=>"phone"===e.factor_type&&"verified"===e.status));return{data:{all:s,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async e=>{var t,s;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=Ws(r.access_token);let a=null;n.aal&&(a=n.aal);let o=a;(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==s?s:[]).length>0&&(o="aal2");return{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:n.amr||[]},error:null}}))))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find((t=>t.kid===e));if(s)return s;if(s=this.jwks.keys.find((t=>t.kid===e)),s&&this.jwks_cached_at+6e5>Date.now())return s;const{data:r,error:i}=await rr(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!r.keys||0===r.keys.length)throw new Os("JWKS is empty");if(this.jwks=r,this.jwks_cached_at=Date.now(),s=r.keys.find((t=>t.kid===e)),!s)throw new Os("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:i,signature:n,raw:{header:a,payload:o}}=Ws(s);if(function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(i.exp),!r.kid||"HS256"===r.alg||!("crypto"in globalThis)||!("subtle"in globalThis.crypto)){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:i,header:r,signature:n},error:null}}const l=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),c=await this.fetchJwk(r.kid,t),d=await crypto.subtle.importKey("jwk",c,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,d,n,qs(`${a}.${o}`))))throw new Os("Invalid JWT signature");return{data:{claims:i,header:r,signature:n},error:null}}catch(s){if(ys(s))return{data:null,error:s};throw s}}}vr.nextInstanceID=0;const yr=vr;class wr extends yr{constructor(e){super(e)}}var _r=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};class jr{constructor(e,t,s){var r,i,n;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=(o=e).endsWith("/")?o:o+"/";var o;const l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d=function(e,t){var s,r;const{db:i,auth:n,realtime:a,global:o}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},l),i),auth:Object.assign(Object.assign({},c),n),realtime:Object.assign(Object.assign({},d),a),global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},null!==(s=null==u?void 0:u.headers)&&void 0!==s?s:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:()=>us(this,void 0,void 0,(function*(){return""}))};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:as,realtime:ls,auth:Object.assign(Object.assign({},os),{storageKey:c}),global:ns});this.storageKey=null!==(r=d.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(i=d.global.headers)&&void 0!==i?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(n=d.auth)&&void 0!==n?n:{},this.headers,d.global.fetch),this.fetch=ds(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Ge(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new se(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new rs(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return _r(this,void 0,void 0,(function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:i,flowType:n,lock:a,debug:o},l,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new wr({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:n,lock:a,debug:o,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Rt(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}const kr="https://ddfwgsaxsapvmdnivbli.supabase.co",Nr="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZndnc2F4c2Fwdm1kbml2YmxpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc3MTg5NDYsImV4cCI6MjA1MzI5NDk0Nn0.Txu0KG6OzE0zwLYT3MBhymLneHHfprNYquZBTWIVDjM";kr.includes("[VOTRE-PROJET]")&&console.error("❌ ERREUR: VITE_SUPABASE_URL non configuré correctement"),Nr.includes("[VOTRE-CLE]")&&console.error("❌ ERREUR: VITE_SUPABASE_ANON_KEY non configuré correctement"),console.log("✅ Configuration Supabase frontend:",{url:kr,keySet:!0});const Sr=new jr(kr,Nr,Tr);var Tr;const Er=({onClose:s,mode:r})=>{const[i,n]=D.useState("signup"!==r),[a,o]=D.useState(""),[l,c]=D.useState(""),[d,u]=D.useState(""),[h,p]=D.useState(null),[m,f]=D.useState(!1),[g,b]=D.useState(!1),x=q();D.useEffect((()=>{"signup"===r&&n(!1),"login"===r&&n(!0),p(null),b(!1)}),[r]);return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative bg-gradient-to-br from-[#1a2942] to-[#234876] rounded-2xl p-8 w-full max-w-md mx-4 shadow-2xl border border-[#c5a572]/20",children:[e.jsx("button",{onClick:s,className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors",children:e.jsx(t,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:i?"Connexion":"Inscription"}),e.jsx("p",{className:"text-gray-300",children:i?"Bienvenue ! Connectez-vous à votre compte.":"Créez votre compte Francis"})]}),h&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-500 text-sm",children:h}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),p(null),f(!0);try{if(!i&&l!==d)throw new Error("Les mots de passe ne correspondent pas");if(!i&&!g)throw new Error("Veuillez accepter la politique de confidentialité pour continuer.");if(i){const{data:e,error:t}=await Sr.auth.signInWithPassword({email:a,password:l});if(t)throw t;e.user&&(x("/dashboard"),s())}else{const{data:e,error:t}=await Sr.auth.signUp({email:a,password:l});if(t)throw t;e.user&&(x("/dashboard"),s())}}catch(t){p(t.message)}finally{f(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-1",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:a,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 bg-[#1a2942]/50 border border-[#c5a572]/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-[#c5a572] focus:ring-1 focus:ring-[#c5a572]",placeholder:"votre@email.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Mot de passe"}),e.jsx("input",{type:"password",id:"password",value:l,onChange:e=>c(e.target.value),className:"w-full px-4 py-2 bg-[#1a2942]/50 border border-[#c5a572]/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-[#c5a572] focus:ring-1 focus:ring-[#c5a572]",placeholder:"••••••••",required:!0})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300 mb-1",children:"Confirmer le mot de passe"}),e.jsx("input",{type:"password",id:"confirmPassword",value:d,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 bg-[#1a2942]/50 border border-[#c5a572]/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-[#c5a572] focus:ring-1 focus:ring-[#c5a572]",placeholder:"••••••••",required:!0})]}),e.jsxs("div",{className:"mt-4 flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"terms",name:"terms",type:"checkbox",checked:g,onChange:e=>b(e.target.checked),className:"focus:ring-[#c5a572] h-4 w-4 text-[#c5a572] border-gray-500 rounded bg-[#1a2942]/50 cursor-pointer"})}),e.jsx("div",{className:"ml-3 text-sm",children:e.jsxs("label",{htmlFor:"terms",className:"font-medium text-gray-300 cursor-pointer",children:["J'ai lu et j'accepte la",e.jsx("a",{href:"/politique-de-confidentialite",target:"_blank",rel:"noopener noreferrer",className:"text-[#c5a572] hover:text-[#e8cfa0] underline ml-1",children:"Politique de Confidentialité"})]})})]})]}),e.jsx("button",{type:"submit",disabled:m||!i&&!g,className:"w-full bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#1a2942] font-bold py-3 px-4 rounded-lg hover:shadow-lg hover:shadow-[#c5a572]/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed mt-6",children:m?"Chargement...":i?"Se connecter":"S'inscrire"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>n(!i),className:"text-[#c5a572] hover:text-[#e8cfa0] transition-colors",children:i?"Pas encore de compte ? S'inscrire":"Déjà un compte ? Se connecter"})})]})]})};function Cr({onClose:l,onStart:c}){return e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"fixed inset-0 bg-black/70 backdrop-blur-md z-50 flex items-center justify-center p-4 sm:p-6 md:p-8",onClick:l,children:e.jsx(s.div,{initial:{scale:.9,opacity:0,y:50},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:50},transition:{type:"spring",stiffness:300,damping:30},onClick:e=>e.stopPropagation(),className:"w-full max-w-4xl bg-gradient-to-br from-[#1E3253] via-[#162238] to-[#101A2E] rounded-2xl p-1 sm:p-2 border-2 border-[#c5a572]/40 shadow-2xl shadow-[#c5a572]/20 overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-br from-[#162238] via-[#1E3253] to-[#234876] rounded-xl p-6 sm:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 sm:mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group p-2 bg-gradient-to-br from-[#c5a572]/20 to-transparent rounded-full",children:[e.jsx(r,{className:"h-8 w-8 sm:h-10 sm:w-10 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(i,{className:"h-5 w-5 sm:h-6 sm:w-6 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#162238] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Démo Interactive"}),e.jsx("p",{className:"text-sm sm:text-base text-[#c5a572]",children:"Voyez Francis en action"})]})]}),e.jsx(s.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onClick:l,className:"p-2 rounded-full text-gray-400 hover:text-white hover:bg-white/10 transition-all","aria-label":"Fermer la démo",children:e.jsx(t,{className:"w-6 h-6 sm:w-7 sm:w-7"})})]}),e.jsx("div",{className:"bg-[#101A2E]/70 backdrop-blur-sm rounded-xl p-4 sm:p-6 mb-6 sm:mb-8 max-h-[55vh] sm:max-h-[60vh] overflow-y-auto custom-scrollbar border border-[#c5a572]/20 shadow-inner",children:e.jsxs("div",{className:"space-y-5 sm:space-y-6",children:[e.jsxs(s.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"flex gap-3 sm:gap-4 items-start",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group flex-shrink-0 mt-1",children:[e.jsx(r,{className:"h-7 w-7 text-[#c5a572]"}),e.jsx(i,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#101A2E] rounded-full p-0.5"})]}),e.jsxs("div",{className:"flex-1 bg-white/5 p-3 sm:p-4 rounded-xl rounded-tl-none border border-white/10 shadow-md",children:[e.jsx("p",{className:"text-white text-base sm:text-lg mb-2",children:"Salut Paul ! On optimise ton impôt sur le revenu 2025 ? Dis-moi si j'ai bon :"}),e.jsxs("div",{className:"bg-black/20 rounded-lg p-3 sm:p-4 space-y-1.5 border border-white/10 text-sm sm:text-base",children:[e.jsx("p",{className:"text-[#c5a572] font-medium",children:"• Revenu net imposable 2024 : 50 000 €"}),e.jsx("p",{className:"text-[#c5a572] font-medium",children:"• Tu es marié, avec 1 enfant à charge"}),e.jsx("p",{className:"text-[#c5a572] font-medium",children:"• Tu veux payer moins d'impôt et préparer ta retraite"})]}),e.jsx("p",{className:"text-white text-base sm:text-lg mt-2",children:"C'est bien ça ?"})]})]}),e.jsxs(s.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.7},className:"flex gap-3 sm:gap-4 items-start justify-end",children:[e.jsx("div",{className:"flex-1 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] p-3 sm:p-4 rounded-xl rounded-br-none text-[#162238] shadow-lg",children:e.jsx("p",{className:"text-base sm:text-lg font-semibold",children:"Oui, c'est ça !"})}),e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:w-9 rounded-full bg-[#c5a572]/20 flex items-center justify-center flex-shrink-0 border border-[#c5a572]/30 mt-1",children:e.jsx(n,{className:"w-4 h-4 sm:w-5 sm:w-5 text-[#e8cfa0]"})})]}),e.jsxs(s.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:1.2},className:"flex gap-3 sm:gap-4 items-start",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group flex-shrink-0 mt-1",children:[e.jsx(r,{className:"h-7 w-7 text-[#c5a572]"}),e.jsx(i,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#101A2E] rounded-full p-0.5"})]}),e.jsxs("div",{className:"flex-1 bg-white/5 p-3 sm:p-4 rounded-xl rounded-tl-none border border-white/10 shadow-md",children:[e.jsx("p",{className:"text-white text-base sm:text-lg mb-2",children:"Top ! Voici 3 leviers efficaces pour ton profil 👇"}),e.jsxs("div",{className:"space-y-3 sm:space-y-4 text-sm sm:text-base",children:[e.jsxs("div",{className:"bg-black/20 rounded-lg p-3 sm:p-4 border border-white/10",children:[e.jsx("p",{className:"text-[#c5a572] font-semibold mb-1",children:"1. Plan Épargne Retraite (PER)"}),e.jsx("p",{className:"text-gray-300",children:"💡 Tu peux verser jusqu'à 5 000 € en 2025 (c'est ton plafond déductible)."}),e.jsx("p",{className:"text-gray-300",children:"📉 Ce montant est retiré de ton revenu imposable → il passe de 50 000 € à 45 000 €"}),e.jsx("p",{className:"text-gray-200 font-medium",children:"📊 Résultat : 550 € d'impôt en moins"})]}),e.jsxs("div",{className:"bg-black/20 rounded-lg p-3 sm:p-4 border border-white/10",children:[e.jsx("p",{className:"text-[#c5a572] font-semibold mb-1",children:"2. Location meublée (LMNP)"}),e.jsx("p",{className:"text-gray-300",children:"🏘️ Tu achètes un petit bien à louer meublé"}),e.jsx("p",{className:"text-gray-300",children:"🧾 En meublé réel, tu peux amortir le bien + charges"}),e.jsx("p",{className:"text-gray-200 font-medium",children:"✅ Résultat : souvent 0 € d'impôt pendant plusieurs années sur les loyers"})]}),e.jsxs("div",{className:"bg-black/20 rounded-lg p-3 sm:p-4 border border-white/10",children:[e.jsx("p",{className:"text-[#c5a572] font-semibold mb-1",children:"3. Don à une association"}),e.jsx("p",{className:"text-gray-300",children:"❤️ Tu donnes 1 000 € à une ONG"}),e.jsx("p",{className:"text-gray-300",children:"💶 Tu récupères 660 € en crédit d'impôt"}),e.jsx("p",{className:"text-gray-200 text-sm",children:"(ou 750 € si c'est une association d'aide aux plus démunis)"})]})]})]})]}),e.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:1.8},className:"text-center pt-4",children:e.jsx("p",{className:"text-gray-400 text-sm sm:text-base italic",children:"Et la conversation continue pour affiner votre stratégie..."})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 sm:gap-6",children:[e.jsxs(s.button,{whileHover:{scale:1.03,boxShadow:"0px 10px 25px rgba(197, 165, 114, 0.3)"},whileTap:{scale:.98},onClick:c,className:"w-full sm:w-auto px-8 py-3.5 sm:px-10 sm:py-4 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-xl shadow-lg hover:shadow-[#c5a572]/40 transition-all duration-300 flex items-center justify-center gap-2.5 text-base sm:text-lg border-2 border-transparent hover:border-[#e8cfa0]/50",children:[e.jsx(a,{className:"w-5 h-5 sm:w-6 sm:w-6"}),"Commencer maintenant !",e.jsx(o,{className:"w-5 h-5 sm:w-6 sm:w-6"})]}),e.jsx(s.button,{whileHover:{scale:1.03,backgroundColor:"rgba(255, 255, 255, 0.08)"},whileTap:{scale:.98},onClick:l,className:"w-full sm:w-auto px-8 py-3.5 sm:px-10 sm:py-4 bg-white/5 text-gray-300 font-medium rounded-xl shadow-md hover:text-white transition-all duration-300 flex items-center justify-center gap-2.5 text-base sm:text-lg border-2 border-white/10 hover:border-white/20 backdrop-blur-sm",children:"Retour"})]})]})})})}const Ar={MONTHLY:{price:9.99,currency:"EUR",interval:"month",stripePriceId:"price_monthly",features:["Accès illimité à Francis 24/7","Analyse personnalisée de votre situation fiscale","Recommandations adaptées à votre profil","Suivi en temps réel de vos optimisations","Mises à jour quotidiennes de la fiscalité","Sans engagement - Annulez à tout moment"]},ANNUAL:{price:99.99,currency:"EUR",interval:"year",stripePriceId:"price_annual",features:["Accès illimité à Francis 24/7","Analyse personnalisée de votre situation fiscale","Recommandations adaptées à votre profil","Suivi en temps réel de vos optimisations","Mises à jour quotidiennes de la fiscalité","Sans engagement - Annulez à tout moment","Économisez 17% par rapport au tarif mensuel"]}};var Pr={};class Or{constructor(){this.baseUrl=Pr.REACT_APP_API_URL||"http://localhost:3000"}static getInstance(){return Or.instance||(Or.instance=new Or),Or.instance}async createCheckoutSession(e){try{const t=await fetch(`${this.baseUrl}/api/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:Ar[e].stripePriceId,successUrl:`${window.location.origin}/success`,cancelUrl:`${window.location.origin}/pricing`})});if(!t.ok)throw new Error("Erreur lors de la création de la session de paiement");const{url:s}=await t.json();return s}catch(t){throw console.error("Erreur Stripe:",t),t}}async createPortalSession(){try{const e=await fetch(`${this.baseUrl}/api/create-portal-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({returnUrl:`${window.location.origin}/account`})});if(!e.ok)throw new Error("Erreur lors de la création de la session du portail");const{url:t}=await e.json();return t}catch(e){throw console.error("Erreur Stripe:",e),e}}}function Ir(){const[t,u]=D.useState(!1),[h,p]=D.useState(!1);(()=>{const[e,t]=D.useState(!1),[s,r]=D.useState(null),i=Or.getInstance()})();const m={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:"easeOut"}}},f={hidden:{opacity:0,scale:.9},visible:e=>({opacity:1,scale:1,transition:{delay:.2*e,duration:.5,ease:"easeOut"}})};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#162238] via-[#1E3253] to-[#234876] text-gray-100 font-sans antialiased",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 bg-[#162238]/95 backdrop-blur-lg border-b border-[#2A3F6C]/50 z-50 shadow-lg",children:e.jsxs("div",{className:"h-20 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(r,{className:"h-10 w-10 text-[#c5a572] transition-transform group-hover:scale-110 duration-300"}),e.jsx(i,{className:"h-7 w-7 text-[#c5a572] absolute -bottom-2 -right-2 bg-[#162238] rounded-full p-0.5 transition-transform group-hover:scale-110 duration-300"})]}),e.jsx("button",{onClick:()=>u("login"),className:"px-6 py-2.5 sm:px-8 sm:py-3 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-xl shadow-lg hover:shadow-[#c5a572]/30 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[#c5a572] focus:ring-offset-2 focus:ring-offset-[#162238] transition-all duration-300 text-sm sm:text-base",children:"Se connecter"})]})}),t&&e.jsx(Er,{mode:t,onClose:()=>u(!1)}),h&&e.jsx(Cr,{onClose:()=>p(!1),onStart:()=>{p(!1),u("signup")}}),e.jsxs("section",{className:"min-h-screen flex flex-col items-center justify-center px-4 pt-32 pb-16 sm:pt-40 sm:pb-20 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-5",style:{backgroundImage:"radial-gradient(circle at 25% 25%, #c5a572 1px, transparent 1px), radial-gradient(circle at 75% 75%, #e8cfa0 1px, transparent 1px)",backgroundSize:"60px 60px"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#162238]/30 via-transparent to-[#234876]/20"}),e.jsxs("div",{className:"max-w-5xl mx-auto text-center relative z-10",children:[e.jsxs(s.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2,ease:"easeOut"},className:"mb-12",children:[e.jsxs(s.h1,{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-gray-100 via-gray-200 to-white mb-8 leading-tight",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.7},children:["Optimisez votre fiscalité avec ",e.jsxs("span",{className:"relative inline-block text-[#c5a572]",children:["Francis",e.jsx(s.span,{className:"absolute -bottom-2.5 left-0 w-full h-1.5 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] rounded-full",initial:{scaleX:0},animate:{scaleX:1},transition:{duration:.7,delay:.8,ease:"circOut"}})]})]}),e.jsx(s.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},className:"text-xl sm:text-2xl text-gray-300 max-w-3xl mx-auto leading-relaxed font-light",children:"L'intelligence artificielle qui vous fait économiser des milliers d'euros sur vos impôts, en toute légalité."})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.5,ease:"easeOut"},className:"flex flex-col sm:flex-row gap-6 justify-center mb-20",children:[e.jsxs(s.button,{onClick:()=>u("signup"),whileHover:{scale:1.03,boxShadow:"0px 12px 30px rgba(197, 165, 114, 0.4)"},whileTap:{scale:.98},className:"px-10 py-4 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-2xl shadow-xl transition-all duration-300 flex items-center justify-center gap-3 text-lg border-2 border-transparent hover:border-[#e8cfa0]/50",children:[e.jsx(a,{className:"w-6 h-6"}),"Commencer maintenant !",e.jsx(o,{className:"w-6 h-6 ml-1 opacity-80 group-hover:opacity-100 transition-opacity"})]}),e.jsxs(s.button,{whileHover:{scale:1.03,backgroundColor:"rgba(255, 255, 255, 0.15)",boxShadow:"0px 8px 20px rgba(255, 255, 255, 0.1)"},onClick:()=>p(!0),className:"px-10 py-4 bg-white/5 text-gray-100 font-semibold rounded-2xl shadow-xl transition-all duration-300 flex items-center justify-center gap-3 text-lg border-2 border-white/20 hover:border-white/40 backdrop-blur-sm group",children:["Voir la démo",e.jsx(o,{className:"w-6 h-6 ml-1 opacity-80 group-hover:opacity-100 transition-opacity group-hover:translate-x-1 duration-200"})]})]}),e.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.8,ease:"easeOut"},className:"flex flex-wrap justify-center items-center gap-x-8 gap-y-4 sm:gap-x-12 opacity-70",children:[{icon:l,text:"100% Sécurisé"},{icon:n,text:"+500 Utilisateurs"},{icon:c,text:"IA de pointe"}].map(((t,r)=>e.jsxs(s.div,{whileHover:{scale:1.05},className:"flex items-center space-x-3 text-gray-300",children:[e.jsx(t.icon,{className:"h-5 w-5 text-[#c5a572]"}),e.jsx("span",{className:"text-base font-medium",children:t.text})]},r)))})]})]}),e.jsx("section",{className:"py-16 sm:py-24 px-4 bg-[#1E3253]/30",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs(s.div,{variants:m,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"text-center mb-14 sm:mb-20",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-extrabold text-white mb-5 sm:mb-6 leading-tight shadow-text",children:"Comment ça marche ?"}),e.jsx("p",{className:"text-lg sm:text-xl text-gray-300 max-w-3xl mx-auto leading-relaxed",children:"Trois étapes simples pour optimiser votre fiscalité avec l'aide de Francis, votre expert IA."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 sm:gap-10 items-stretch",children:[{icon:n,title:"Créez votre compte et profil",description:"Inscrivez-vous rapidement et renseignez vos informations pour un accompagnement sur mesure."},{icon:r,title:"Discutez avec Francis",description:"Posez vos questions, obtenez des recommandations personnalisées et des plans d'action clairs."},{icon:d,title:"Mettez en place les conseils",description:"Passez à l'action facilement et suivez vos optimisations fiscales en temps réel."}].map(((t,r)=>e.jsxs(s.div,{custom:r,variants:f,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},className:"bg-gradient-to-br from-[#1A2942]/70 to-[#223C63]/70 rounded-2xl border border-[#2A3F6C]/60 p-8 flex flex-col items-center shadow-xl hover:shadow-2xl hover:border-[#c5a572]/50 transition-all duration-300 transform hover:-translate-y-1",children:[e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] flex items-center justify-center mb-6 sm:mb-8 shadow-lg border-4 border-[#162238]/50",children:e.jsx(t.icon,{className:"w-10 h-10 sm:w-12 sm:h-12 text-[#162238]"})}),e.jsx("h3",{className:"text-xl sm:text-2xl font-semibold text-white mb-3 text-center",children:t.title}),e.jsx("p",{className:"text-gray-300 text-base sm:text-lg text-center leading-relaxed",children:t.description})]},r)))})]})}),e.jsx("section",{className:"py-16 sm:py-24 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx(s.div,{variants:m,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"text-center mb-14 sm:mb-20",children:e.jsxs("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-extrabold text-white mb-5 sm:mb-6 leading-tight shadow-text",children:["Pourquoi choisir ",e.jsx("span",{className:"text-[#c5a572]",children:"Francis"})," ?"]})}),e.jsx(s.div,{variants:m,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"bg-gradient-to-br from-[#1A2942]/60 to-[#223C63]/60 shadow-xl rounded-2xl px-8 py-10 sm:px-12 sm:py-14 mx-auto max-w-4xl border border-[#2A3F6C]/60",children:e.jsxs("p",{className:"text-lg sm:text-xl text-gray-200 leading-relaxed text-center",children:["Chaque année, des millions de Français remplissent leur déclaration sans savoir qu'ils pourraient ",e.jsx("strong",{className:"font-semibold text-[#c5a572]",children:"payer moins"}),", en toute légalité.",e.jsx("br",{}),e.jsx("br",{}),"Pas par négligence, mais parce que ",e.jsx("strong",{className:"font-semibold text-white",children:"personne ne leur explique"}),". Ni l'administration. Ni les banques. Ni les simulateurs incomplets.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{className:"font-semibold text-[#c5a572]",children:"Francis change la donne."}),e.jsx("br",{}),"Nous avons créé une intelligence artificielle indépendante, conçue pour ",e.jsx("strong",{className:"font-semibold text-white",children:"vous défendre, vous guider, et vous faire économiser."})]})})]})}),e.jsx("section",{className:"py-16 sm:py-24 px-4 bg-[#1E3253]/30",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs(s.div,{variants:m,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"text-center mb-14 sm:mb-20",children:[e.jsxs("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-extrabold text-white mb-5 sm:mb-6 leading-tight shadow-text",children:["Une offre unique, des résultats ",e.jsx("span",{className:"text-[#c5a572]",children:"concrets"})]}),e.jsx("p",{className:"text-lg sm:text-xl text-gray-300 max-w-3xl mx-auto leading-relaxed",children:"Accédez à toutes les fonctionnalités pour optimiser votre fiscalité et prendre le contrôle de vos finances."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 sm:gap-10 items-stretch mb-12 sm:mb-16",children:[{title:"Offre Mensuelle",price:"9,99€",period:"par mois",features:["Accès illimité 24/7","Analyse personnalisée","Recommandations adaptées","Suivi en temps réel","Mises à jour quotidiennes","Sans engagement"],popular:!1,originalPrice:null},{title:"Offre Annuelle",price:"99,99€",period:"par an",features:["Tous les avantages mensuels","Économisez 17%","Support prioritaire","Accès anticipé aux nouveautés"],popular:!0,originalPrice:"119,88€"}].map(((t,r)=>e.jsxs(s.div,{custom:r,variants:f,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},className:`bg-gradient-to-br from-[#1A2942]/80 to-[#223C63]/80 rounded-2xl border ${t.popular?"border-[#c5a572]/80 shadow-2xl":"border-[#2A3F6C]/60 shadow-xl"} p-8 flex flex-col relative overflow-hidden hover:border-[#c5a572]/70 transition-all duration-300 transform hover:scale-[1.02]`,children:[t.popular&&e.jsx("div",{className:"absolute top-0 right-0 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] px-5 py-1.5 text-sm font-semibold tracking-wider uppercase transform rotate-45 translate-x-1/3 translate-y-1/3 origin-top-right shadow-md",children:"Populaire"}),e.jsx("h3",{className:"text-2xl sm:text-3xl font-bold mb-2 text-center "+(t.popular?"text-[#c5a572]":"text-white"),children:t.title}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("span",{className:"text-4xl sm:text-5xl font-extrabold "+(t.popular?"text-[#c5a572]":"text-white"),children:t.price}),e.jsx("span",{className:"text-base text-gray-400 ml-1",children:t.period}),t.originalPrice&&e.jsx("p",{className:"text-sm text-gray-500 line-through mt-1",children:t.originalPrice})]}),e.jsx("ul",{className:"space-y-3 mb-8 text-gray-300 flex-grow",children:t.features.map(((s,r)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(d,{className:"w-5 h-5 text-[#c5a572] mr-3 mt-1 flex-shrink-0 "+(t.popular?"text-[#c5a572]":"text-gray-400")}),e.jsx("span",{children:s})]},r)))}),e.jsx(s.button,{onClick:()=>u("signup"),whileHover:{scale:1.03,boxShadow:"0px 8px 20px "+(t.popular?"rgba(197, 165, 114, 0.3)":"rgba(197, 165, 114, 0.2)")},whileTap:{scale:.98},className:"w-full mt-auto px-8 py-3.5 font-semibold rounded-lg shadow-md transition-all duration-300 text-base sm:text-lg border-2 "+(t.popular?"bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] border-transparent hover:border-[#e8cfa0]/50":"bg-white/10 text-gray-100 border-transparent hover:bg-white/20 hover:border-white/30"),children:"Choisir cette offre"})]},r)))}),e.jsx(s.div,{variants:m,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"text-center text-gray-400 text-sm",children:"Paiement sécurisé. Annulation facile à tout moment."})]})}),e.jsx("section",{className:"py-16 sm:py-24 px-4",children:e.jsx("div",{className:"max-w-4xl mx-auto text-center",children:e.jsxs(s.div,{variants:m,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"bg-gradient-to-br from-[#c5a572]/90 to-[#e8cfa0]/90 rounded-2xl p-10 sm:p-16 shadow-2xl border border-[#c5a572]/50",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-extrabold text-[#162238] mb-6 sm:mb-8 leading-tight shadow-text-dark",children:"Prêt à optimiser votre fiscalité ?"}),e.jsx("p",{className:"text-lg sm:text-xl text-[#1E3253]/80 mb-8 sm:mb-10 max-w-2xl mx-auto leading-relaxed",children:"Rejoignez des centaines d'utilisateurs qui font déjà confiance à Francis pour gérer leurs finances intelligemment."}),e.jsxs(s.button,{onClick:()=>u("signup"),whileHover:{scale:1.03,boxShadow:"0px 10px 25px rgba(22, 34, 56, 0.3)"},whileTap:{scale:.98},className:"px-10 py-4 sm:px-12 sm:py-5 bg-[#162238] text-white font-semibold rounded-lg shadow-xl transition-all duration-300 flex items-center justify-center gap-3 text-base sm:text-lg mx-auto border-2 border-transparent hover:border-white/30",children:["Créer mon compte",e.jsx(o,{className:"w-5 h-5 sm:w-6 sm:h-6 opacity-80 group-hover:opacity-100 transition-opacity"})]})]})})}),e.jsx("footer",{className:"py-8 text-center",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["© ",(new Date).getFullYear()," Francis. Tous droits réservés."]})})]})}function Rr({detectedProfile:t,profileData:r}){const i=e=>({dirigeant_IS:w,salarie:y,independant:v,investisseur_immobilier:x,expatrie:b,retraite:g}[e]||y),n=e=>({dirigeant_IS:"Dirigeant IS",salarie:"Salarié",independant:"Indépendant",investisseur_immobilier:"Investisseur Immobilier",expatrie:"Expatrié",retraite:"Retraité"}[e]||e),a=t.priorite_affichage[0],o=i(a);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#1E3253] to-[#2A3F6C] p-6 rounded-xl border border-[#c5a572]/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] rounded-lg",children:e.jsx(o,{className:"w-8 h-8 text-[#162238]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:n(a)}),e.jsx("p",{className:"text-[#c5a572]",children:"Profil fiscal principal détecté"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-3xl font-bold text-[#c5a572]",children:[t.score_total[a],"%"]}),e.jsx("p",{className:"text-sm text-gray-300",children:"compatibilité"})]})]}),e.jsx("div",{className:"bg-[#101A2E]/50 p-4 rounded-lg",children:e.jsx("p",{className:"text-gray-300 text-sm",children:(l=a,{dirigeant_IS:"Dirigeant de société soumise à l'impôt sur les sociétés (SASU, SARL, SAS)",salarie:"Salarié en CDI/CDD ou fonctionnaire avec revenus d'activité",independant:"Travailleur indépendant, auto-entrepreneur ou profession libérale",investisseur_immobilier:"Investisseur avec patrimoine immobilier locatif significatif",expatrie:"Résident fiscal à l'étranger avec revenus de source française",retraite:"Retraité percevant une pension principale ou des revenus de retraite"}[l]||"")})})]}),e.jsxs("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"font-semibold text-white mb-4 flex items-center",children:[e.jsx(u,{className:"w-5 h-5 text-[#c5a572] mr-2"}),"Analyse de Profil"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Confiance de détection"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-32 bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] h-3 rounded-full transition-all duration-300",style:{width:`${t.confiance_detection}%`}})}),e.jsxs("span",{className:"text-[#c5a572] font-bold",children:[t.confiance_detection,"%"]})]})]}),t.variables_determinantes.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-300 mb-2",children:"Variables clés identifiées :"}),e.jsx("div",{className:"space-y-1",children:t.variables_determinantes.map(((t,s)=>e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-400",children:[e.jsx(h,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{children:t})]},s)))})]})]})]}),t.profils_mineurs.length>0&&e.jsxs("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#2A3F6C]/30",children:[e.jsx("h4",{className:"font-semibold text-white mb-4",children:"Profils secondaires détectés"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.profils_mineurs.map((s=>{const r=i(s),a=t.score_total[s];return e.jsxs("div",{className:"flex items-center space-x-3 bg-[#162238]/60 p-3 rounded-lg",children:[e.jsx(r,{className:"w-6 h-6 text-[#c5a572]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-200",children:n(s)}),e.jsxs("div",{className:"text-sm text-gray-400",children:[a,"% compatibilité"]})]})]},s)}))})]}),e.jsxs("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"font-semibold text-white mb-4 flex items-center",children:[e.jsx(p,{className:"w-5 h-5 text-[#c5a572] mr-2"}),"Caractéristiques de votre profil"]}),e.jsx("div",{className:"space-y-3",children:(e=>({dirigeant_IS:["Optimisation rémunération/dividendes","Charges sociales dirigeant","Impôt sur les sociétés","Arbitrage fiscal complexe","Transmission d'entreprise"],salarie:["Tranche marginale d'imposition","Épargne salariale disponible","PER et optimisation retraite","Frais professionnels","Revenus complémentaires"],independant:["Régime fiscal BIC/BNC","Charges sociales TNS","Déductions professionnelles","Épargne retraite Madelin","Optimisation statut juridique"],investisseur_immobilier:["Revenus fonciers et déficits","Régimes micro/réel","Exposition IFI potentielle","SCI et optimisation","Stratégie patrimoniale"],expatrie:["Conventions fiscales internationales","Revenus de source française","Exit tax et plus-values","Retour fiscal en France","Double imposition"],retraite:["Optimisation pensions","Abattements seniors","Transmission patrimoine","Revenus complémentaires","IFI si applicable"]}[e]||[]))(a).map(((t,r)=>e.jsxs(s.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*r},className:"flex items-start space-x-3 p-3 bg-[#162238]/40 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-[#c5a572] rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{className:"text-gray-200 text-sm",children:t})]},r)))})]}),e.jsxs("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"font-semibold text-white mb-4 flex items-center",children:[e.jsx(m,{className:"w-5 h-5 text-[#c5a572] mr-2"}),"Données de profil analysées"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:Object.entries(r).map((([t,s])=>!s||Array.isArray(s)&&0===s.length?null:e.jsxs("div",{className:"flex justify-between items-center p-2 bg-[#162238]/40 rounded",children:[e.jsx("span",{className:"text-gray-400 capitalize",children:t.replace(/_/g," ")}),e.jsx("span",{className:"text-gray-200 font-medium",children:Array.isArray(s)?s.join(", "):String(s)})]},t)))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-[#c5a572]/20 to-[#e8cfa0]/20 p-6 rounded-xl border border-[#c5a572]/30",children:[e.jsxs("h4",{className:"text-xl font-semibold text-white mb-3 flex items-center",children:[e.jsx(f,{className:"w-6 h-6 text-[#c5a572] mr-2"}),"Profil détecté avec succès !"]}),e.jsxs("p",{className:"text-gray-300 mb-4",children:["Francis a analysé vos données et identifié votre profil fiscal avec une confiance de ",t.confiance_detection,"%. Vous pouvez maintenant accéder aux stratégies d'optimisation personnalisées."]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[e.jsx("strong",{children:"Profil principal :"})," ",n(a)," (",t.score_total[a],"% de compatibilité)"]})]})]});var l}const $r={situation:"",revenus:"",patrimoine:"",objectifs:[],tolerance_risque:"",horizon_investissement:"",nombre_enfants:0,ages_enfants:"",type_revenus:[],autres_revenus:"",situation_professionnelle:"",statut_fiscal:"",regime_imposition:"",investissements_existants:[],projets_immobiliers:"",besoins_retraite:"",situation_familiale:"",localisation:"",zone_fiscale:"",secteur_activite:"",revenus_passifs:"",dettes:"",objectifs_financiers:[],contraintes_fiscales:[],composition_patrimoine:[],is_active:!1,date_naissance:"",personnes_charge:"",type_contrat:"",societes_detenues:"",tmi:"",endettement:""};function Lr(){var n;const[a,o]=D.useState(!0),[l,c]=D.useState(""),[d,u]=D.useState(!1),m=D.useRef(null),[$,L]=D.useState([{role:"assistant",content:"Bonjour ! Je suis Francis, votre assistant expert en fiscalité française, développé par Fiscal.ia. 🤖\n\nFort de ma connaissance approfondie des textes officiels (Code Général des Impôts, BOFIP), je suis à votre disposition pour :\n• Optimiser vos impôts et déclarations\n• Analyser vos documents fiscaux (avis d'imposition, etc.)\n• Répondre à toutes vos questions sur la fiscalité française\n\nComment puis-je vous aider aujourd'hui ? Vous pouvez me poser une question directement, ou choisir un parcours d'accompagnement si vous le souhaitez."}]),[U,F]=D.useState("chat"),[M,z]=D.useState($r),[B,J]=D.useState(!1),[G,V]=D.useState(!1),[H,K]=D.useState(null),[W,Y]=D.useState(null),[Q,X]=D.useState(null),[Z,ee]=D.useState("libre"),[te,se]=D.useState(null),[re,ie]=D.useState(null),[ne,ae]=D.useState(!1),[oe,le]=D.useState([]),[ce,de]=D.useState(null),[ue,he]=D.useState(!1),[pe,me]=D.useState([]),[fe,ge]=D.useState(!1),be=q(),xe=e=>{if(!e)return"Profil non défini";return{salarie:"Salarié / Fonctionnaire",dirigeant_IS:"Dirigeant de société",independant:"Indépendant",investisseur_immobilier:"Investisseur Immobilier",expatrie:"Expatrié / Non-résident",retraite:"Retraité"}[e]||e};D.useEffect((()=>{var e;null==(e=m.current)||e.scrollIntoView({behavior:"smooth"})}),[$]);const ve=()=>{const e=["situation_familiale","nombre_enfants"],t=e.filter((e=>{const t=M[e];return"nombre_enfants"===e?null!=t:null!=t&&""!==t})).length;return 0===e.length?100:Math.round(t/e.length*100)};D.useEffect((()=>{(async()=>{const{data:{session:e}}=await Sr.auth.getSession();(null==e?void 0:e.user)?(se(e.user.id),ie(e.user.email||null),await ye(e.user.id)):be("/")})()}),[be]);const ye=async e=>{try{const{data:t,error:s}=await Sr.from("user_profiles").select("*").eq("user_id",e).single();if(s&&"PGRST116"!==s.code)throw s;if(t){z(t);const e=ve();J(e>80)}else z($r),J(!1)}catch(t){console.error("Erreur lors du chargement du profil:",t),z($r),J(!1)}},we=e=>{var t,s,r,i,n,a,o,l,c,d,u,h,p;let m={dirigeant_IS:0,salarie:0,independant:0,investisseur_immobilier:0,expatrie:0,retraite:0},f=[];(null==(t=e.situation_professionnelle)?void 0:t.includes("dirigeant"))?(m.dirigeant_IS+=70,f.push("Dirigeant de société")):(null==(s=e.situation_professionnelle)?void 0:s.includes("salarie"))||(null==(r=e.situation_professionnelle)?void 0:r.includes("fonctionnaire"))?(m.salarie+=70,f.push("Statut salarié")):(null==(i=e.situation_professionnelle)?void 0:i.includes("autoentrepreneur"))||(null==(n=e.situation_professionnelle)?void 0:n.includes("profession_liberale"))?(m.independant+=70,f.push("Travailleur indépendant")):(null==(a=e.situation_professionnelle)?void 0:a.includes("retraite"))&&(m.retraite+=70,f.push("Situation de retraité")),((null==(o=e.type_revenus)?void 0:o.includes("immobilier_locatif"))||(null==(l=e.type_revenus)?void 0:l.includes("scpi"))||(null==(c=e.type_revenus)?void 0:c.includes("lmnp")))&&(m.investisseur_immobilier+=50,f.push("Revenus immobiliers")),(null==(d=e.type_revenus)?void 0:d.includes("dividendes"))&&(m.dirigeant_IS+=30,f.push("Perception de dividendes")),e.localisation&&"france"!==e.localisation&&(m.expatrie+=60,f.push("Résidence fiscale à l'étranger")),((null==(u=e.patrimoine)?void 0:u.includes("multi_proprietaire"))||(null==(h=e.patrimoine)?void 0:h.includes("patrimoine_important"))||(null==(p=e.patrimoine)?void 0:p.includes("ifi_concerne")))&&(m.investisseur_immobilier+=40,f.push("Patrimoine immobilier important"));const g=Object.entries(m).reduce(((e,t)=>e[1]>t[1]?e:t))[0],b=Math.min(95,Math.max(65,m[g]+Math.floor(15*Math.random())));return{primary:g,all:Object.entries(m).filter((([e,t])=>t>30)).sort((([,e],[,t])=>t-e)).map((([e,t])=>e)),scores:m,confidence:b,factors:f}},_e=async(e,t)=>{var s,r;e&&e.preventDefault();const i=t||l;if(!i.trim()||!te)return;u(!0);const n=i;t||c(""),L((e=>[...e,{role:"user",content:n}]));try{const e="/api",t=(null==(r=null==(s=await Sr.auth.getSession())?void 0:s.data.session)||r.access_token,{question:n,userProfile:M});console.log("📡 Envoi des données à l'API /ask:",t);const i=await fetch(`${e}/api/test-francis`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:n})});if(!i.ok){const e=await i.json().catch((()=>({detail:"Erreur inconnue du serveur"})));throw console.error("❌ Erreur API /ask:",e),new Error(`Erreur ${i.status}: ${e.detail||i.statusText}`)}const a=await i.json();console.log("🤖 Réponse de l'API /ask:",a),L((e=>[...e,{role:"assistant",content:a.answer}]))}catch(a){console.error("Erreur lors de la soumission de la question:",a),L((e=>[...e,{role:"assistant",content:a instanceof Error?`Désolé, une erreur est survenue : ${a.message}`:"Oups ! Je rencontre une difficulté technique. Veuillez réessayer."}]))}finally{u(!1)}};D.useEffect((()=>{console.warn("VITE_TRUELAYER_CLIENT_ID non configuré. La connexion bancaire sera désactivée.")}),[]);return e.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-[#101A2E] via-[#162238] to-[#1E3253] text-gray-200 font-sans",children:[e.jsx(_,{children:a&&e.jsxs(s.aside,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{duration:.3,ease:"easeInOut"},className:"w-72 bg-[#0D1523]/80 backdrop-blur-xl p-6 flex flex-col border-r border-[#2A3F6C]/20 shadow-2xl fixed inset-y-0 left-0 z-40",children:[e.jsx("div",{className:"flex items-center space-x-3.5 mb-10 px-2",children:e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(r,{className:"h-10 w-10 text-[#c5a572] transition-transform group-hover:scale-110 duration-300"}),e.jsx(i,{className:"h-7 w-7 text-[#c5a572] absolute -bottom-2 -right-2 bg-[#0D1523] rounded-full p-0.5 transition-transform group-hover:scale-110 duration-300"})]})}),e.jsx("nav",{className:"flex-grow space-y-1.5",children:[{id:"chat",label:"Chat avec Francis",icon:r},{id:"profile",label:"Mon Profil Fiscal",icon:j},{id:"analytics",label:"Analyse & Rapports",icon:p},{id:"settings",label:"Paramètres",icon:k}].map((t=>e.jsxs("button",{onClick:()=>F(t.id),className:"w-full flex items-center space-x-3.5 px-3 py-3 rounded-lg transition-all duration-200 group hover:bg-[#c5a572]/15 focus:outline-none focus:ring-2 focus:ring-[#c5a572] focus:ring-offset-2 focus:ring-offset-[#0D1523] "+(U===t.id?"bg-[#c5a572]/20 text-[#e8cfa0] shadow-inner":"text-gray-400 hover:text-gray-100"),children:[e.jsx(t.icon,{className:"w-5 h-5 transition-colors duration-200 "+(U===t.id?"text-[#e8cfa0]":"text-gray-500 group-hover:text-[#c5a572]")}),e.jsx("span",{className:"font-medium text-sm",children:t.label})]},t.id)))}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-[#2A3F6C]/20",children:[re&&e.jsxs("div",{className:"mb-3 p-3 bg-[#162238]/60 rounded-lg text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Connecté en tant que"}),e.jsx("p",{className:"text-sm font-medium text-gray-200 truncate",children:re})]}),e.jsxs("button",{onClick:async()=>{await Sr.auth.signOut(),be("/")},className:"w-full flex items-center space-x-3.5 px-3 py-3 rounded-lg text-gray-400 hover:bg-red-600/15 hover:text-red-400 transition-colors duration-200 group focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-[#0D1523]",children:[e.jsx(N,{className:"w-5 h-5 text-gray-500 group-hover:text-red-400 transition-colors"}),e.jsx("span",{className:"font-medium text-sm",children:"Déconnexion"})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden transition-all duration-300 ease-easeInOut "+(a?"md:ml-72":"ml-0"),children:[e.jsxs("header",{className:"h-20 bg-[#162238]/80 backdrop-blur-xl flex items-center justify-between px-6 sm:px-8 border-b border-[#2A3F6C]/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>o(!a),className:"p-2.5 rounded-xl text-gray-400 hover:text-white hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-[#c5a572] transition-all duration-200 md:hidden",children:a?e.jsx(t,{className:"h-6 w-6"}):e.jsx(S,{className:"h-6 w-6"})}),!a&&e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx("img",{src:"/fiscalia-logo.svg",alt:"Fiscal.ia",className:"h-12 w-12 transition-transform group-hover:scale-110 duration-300"}),e.jsx("span",{className:"ml-3 text-2xl font-bold text-white",children:"Fiscal.ia"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 px-4 py-2 bg-[#1E3253]/50 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Francis en ligne"})]}),e.jsx(T,{className:"h-5 w-5 text-gray-400 hover:text-[#c5a572] cursor-pointer transition-colors"}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] flex items-center justify-center text-[#162238] font-semibold text-sm shadow-lg border-2 border-[#162238]/20",children:re?re.substring(0,1).toUpperCase():"U"})]})]}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-[#101A2E] p-6 sm:p-8",children:e.jsxs(_,{mode:"wait",children:["chat"===U&&e.jsxs(s.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"h-full max-h-[calc(100vh-10rem)] flex flex-col bg-white/5 backdrop-blur-lg rounded-2xl shadow-2xl border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 scrollbar-thin scrollbar-thumb-[#2A3F6C]/70 scrollbar-track-transparent scrollbar-thumb-rounded-full",children:[$.map(((t,i)=>e.jsx(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.05*i},className:"flex "+("user"===t.role?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-[85%] sm:max-w-[70%] p-4 rounded-2xl shadow-lg text-sm leading-relaxed backdrop-blur-sm "+("user"===t.role?"bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] text-[#162238] rounded-br-md shadow-[#c5a572]/20":"bg-[#1E3253]/80 text-gray-100 rounded-bl-md border border-white/10"),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1.5",children:["assistant"===t.role&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(r,{className:"w-3.5 h-3.5 text-[#162238]"})}),e.jsx("span",{className:"text-xs font-semibold "+("user"===t.role?"text-[#162238]/90":"text-[#e8cfa0]"),children:"user"===t.role?re||"Vous":"Francis"})]}),e.jsx("div",{className:"whitespace-pre-wrap break-words "+("user"===t.role?"text-[#162238]":"text-gray-200"),children:t.content})]})},i))),e.jsx("div",{ref:m})]}),!d&&$.length>2&&"assistant"===$[$.length-1].role&&e.jsx("div",{className:"px-4 sm:px-6 py-2.5 border-t border-[#2A3F6C]/20",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:["Comment optimiser ma déclaration d'impôts ?","Quelles sont les stratégies de défiscalisation pour 2024 ?","Je suis auto-entrepreneur, comment gérer ma TVA ?","Quels avantages fiscaux pour un investissement locatif Pinel ?"].slice(0,3).map(((t,s)=>e.jsx("button",{onClick:()=>_e(void 0,t),className:"px-3 py-1.5 bg-[#1E3253]/60 hover:bg-[#2A3F6C]/60 text-xs text-gray-300 hover:text-white rounded-full transition-colors shadow-sm",children:t},s)))})}),e.jsxs("div",{className:"p-4 sm:p-6 border-t border-white/10 bg-[#162238]/40 backdrop-blur-lg",children:[e.jsxs("form",{onSubmit:_e,className:"flex items-center space-x-3",children:[e.jsx("label",{htmlFor:"file-upload-chat",className:"p-3 rounded-xl text-gray-400 hover:text-[#c5a572] hover:bg-white/10 transition-all duration-200 cursor-pointer "+(d||ue?"opacity-50 cursor-not-allowed":""),children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx("input",{type:"file",id:"file-upload-chat",className:"hidden",accept:".pdf,.jpg,.jpeg,.png,.txt,.md",onChange:e=>(async e=>{var t,s;if(!e)return;if(!te)return void L((e=>[...e,{role:"assistant",content:"Veuillez vous connecter pour uploader des documents."}]));he(!0);const r={name:e.name,type:e.type,status:"processing"};me((e=>[...e,r]));try{const r=new FormData;r.append("file",e);const i=null==(s=null==(t=await Sr.auth.getSession())?void 0:t.data.session)?void 0:s.access_token,n="/api",a=await fetch(`${n}/upload/document`,{method:"POST",headers:{Authorization:`Bearer ${i}`},body:r});if(!a.ok){const e=await a.json().catch((()=>({detail:"Erreur lors de l'upload"})));throw new Error(e.detail||`Erreur ${a.status}`)}const o=await a.json();me((t=>t.map((t=>t.name===e.name?{...t,status:"success",data:o}:t)))),L((t=>[...t,{role:"assistant",content:o.message||`Document "${e.name}" traité avec succès.`}]))}catch(i){console.error("Erreur Upload:",i),me((t=>t.map((t=>t.name===e.name?{...t,status:"error"}:t)))),L((e=>[...e,{role:"assistant",content:i instanceof Error?`Erreur d'upload: ${i.message}`:"Erreur inconnue lors de l'upload."}]))}finally{he(!1)}})(e.target.files?e.target.files[0]:void 0),disabled:d||ue}),e.jsx("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"Posez votre question à Francis...",className:"flex-1 rounded-xl bg-white/5 border border-white/20 text-gray-100 placeholder-gray-400 focus:border-[#c5a572] focus:ring-2 focus:ring-[#c5a572]/50 px-4 py-3 text-sm transition-all duration-200 shadow-inner backdrop-blur-sm",disabled:d||ue}),e.jsx("button",{type:"submit",disabled:d||!l.trim()||ue,className:"p-3 bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] text-[#162238] rounded-xl hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-transparent focus:ring-[#c5a572] transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:scale-100 shadow-lg hover:shadow-[#c5a572]/30",children:d?e.jsx(C,{className:"w-5 h-5 animate-spin"}):e.jsx(A,{className:"w-5 h-5"})})]}),ue&&e.jsxs("div",{className:"text-xs text-center text-[#c5a572] pt-2",children:["Téléchargement de ",null==(n=pe.find((e=>"processing"===e.status)))?void 0:n.name,"..."]})]})]},"chat"),"home"===U&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("h2",{className:"text-3xl font-semibold text-white mb-8",children:"Tableau de Bord"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.jsxs("div",{className:"bg-[#1E3253]/50 backdrop-blur-sm rounded-xl border border-[#2A3F6C]/40 p-6 shadow-lg hover:shadow-[#c5a572]/10 transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gradient-to-br from-[#c5a572] to-[#e8cfa0]",children:e.jsx(j,{className:"w-6 h-6 text-[#162238]"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Profil Fiscal"})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Complétez votre profil pour des conseils plus précis."}),e.jsx("div",{className:"w-full bg-[#101A2E]/50 rounded-full h-2.5 mb-1",children:e.jsx("div",{className:"bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] h-2.5 rounded-full transition-all duration-500 ease-out",style:{width:`${ve()}%`}})}),e.jsxs("p",{className:"text-right text-xs text-[#c5a572]",children:[ve(),"% complet"]})]})})]},"home"),"profile"===U&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("h2",{className:"text-3xl font-semibold text-white mb-6",children:"Mon Profil Fiscal Adaptatif"}),e.jsxs("div",{className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-6 sm:p-8 shadow-xl mb-8",children:[e.jsxs("h3",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(P,{className:"w-6 h-6 mr-3 text-[#c5a572]"}),"Connexion Bancaire Sécurisée (via TrueLayer)"]}),oe.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-green-400 font-medium mb-2",children:"Comptes connectés :"}),e.jsx("ul",{className:"list-disc list-inside text-gray-300",children:oe.map((t=>e.jsx("li",{children:t},t)))})]}),ce&&e.jsx("div",{className:"mb-4 p-3 bg-green-500/10 border border-green-500/20 rounded-lg text-sm",children:e.jsx("p",{className:"text-green-400",children:"Données bancaires prêtes pour analyse par Francis."})}),e.jsx("button",{onClick:async()=>{L((e=>[...e,{role:"assistant",content:"La fonctionnalité de connexion bancaire n'est pas disponible pour le moment. Veuillez vérifier la configuration."}]))},disabled:ne||!window.TrueLayer||!0,className:"w-full px-6 py-3 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-lg shadow-lg hover:shadow-[#c5a572]/40 hover:scale-105 transition-all duration-300 flex items-center justify-center space-x-3 disabled:opacity-60 disabled:cursor-not-allowed",children:ne?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{children:"Connexion en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-6 h-6"}),e.jsx("span",{children:oe.length>0?"Connecter un autre compte":"Connecter mes comptes bancaires"})]})}),e.jsx("p",{className:"text-xs text-red-400 mt-2 text-center",children:"Configuration TrueLayer manquante (VITE_TRUELAYER_CLIENT_ID)."}),e.jsx("p",{className:"text-xs text-gray-500 mt-3 text-center",children:"Francis utilise TrueLayer pour accéder à vos données bancaires en toute sécurité. Nous ne stockons jamais vos identifiants bancaires."})]}),Q&&e.jsx("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{className:"w-6 h-6 text-green-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold",children:"Profil fiscal sauvegardé !"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[e.jsx("strong",{children:xe(Q.priorite_affichage[0])})," détecté avec ",Q.confiance_detection,"% de confiance"]})]})]})}),e.jsx("div",{className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-6 sm:p-8 shadow-xl",children:H?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] rounded-full mb-4",children:e.jsx(h,{className:"w-8 h-8 text-[#162238]"})}),e.jsxs("h3",{className:"text-2xl font-semibold text-white mb-3",children:["Profil ",e.jsx("span",{className:"text-[#c5a572]",children:xe(H)})," - Questionnaire Détaillé"]}),e.jsx("p",{className:"text-gray-300",children:"Questionnaire complet pour un conseil fiscal ultra-personnalisé"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),te){u(!0);try{const e=we(M),t={priorite_affichage:[e.primary],profils_actifs:e.all,score_total:e.scores,confiance_detection:e.confidence,variables_determinantes:e.factors};await(async e=>{if(te)try{console.log("💾 Sauvegarde du profil utilisateur:",e);const{error:t}=await Sr.from("user_profiles").upsert({...e,user_id:te,updated_at:(new Date).toISOString()});if(t)throw console.error("❌ Erreur Supabase:",t),t;console.log("✅ Profil sauvegardé avec succès"),z(e);const s=ve();J(s>80)}catch(t){console.error("Erreur lors de la sauvegarde du profil:",t)}})(M),X(t),Y(M),L((t=>[...t,{role:"assistant",content:`🎯 **Analyse de profil terminée !**\n\n**Profil principal détecté :** ${xe(e.primary)}\n**Niveau de confiance :** ${e.confidence}%\n\nBasé sur vos réponses, je peux maintenant vous donner des conseils fiscaux ultra-personnalisés ! N'hésitez pas à me poser des questions spécifiques.`}])),F("chat")}catch(t){console.error("Erreur lors de l'analyse du profil:",t),L((e=>[...e,{role:"assistant",content:"Une erreur est survenue lors de l'analyse de votre profil. Vos données ont été sauvegardées, veuillez réessayer."}]))}finally{u(!1)}}},className:"space-y-8",children:[e.jsxs("div",{className:"bg-[#162238]/50 rounded-lg p-6 border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"text-xl font-bold text-white mb-6 flex items-center",children:[e.jsx(O,{className:"w-6 h-6 mr-3 text-[#c5a572]"}),"👤 Informations personnelles"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Date de naissance :"}),e.jsx("input",{type:"date",value:M.date_naissance||"",onChange:e=>z({...M,date_naissance:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"👨‍👩‍👧‍👦 Situation familiale :"}),e.jsxs("select",{value:M.situation_familiale||"",onChange:e=>z({...M,situation_familiale:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"-- Sélectionnez --"}),e.jsx("option",{value:"celibataire",children:"Célibataire"}),e.jsx("option",{value:"marie",children:"Marié(e)"}),e.jsx("option",{value:"pacse",children:"Pacsé(e)"}),e.jsx("option",{value:"divorce",children:"Divorcé(e)"}),e.jsx("option",{value:"veuf",children:"Veuf(ve)"}),e.jsx("option",{value:"concubinage",children:"Concubinage"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"🧒 Nombre d'enfants à charge :"}),e.jsxs("select",{value:M.nombre_enfants||0,onChange:e=>z({...M,nombre_enfants:parseInt(e.target.value)}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",children:[e.jsx("option",{value:0,children:"0 enfant"}),e.jsx("option",{value:1,children:"1 enfant"}),e.jsx("option",{value:2,children:"2 enfants"}),e.jsx("option",{value:3,children:"3 enfants"}),e.jsx("option",{value:4,children:"4 enfants"}),e.jsx("option",{value:5,children:"5 enfants ou plus"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"👶 Âges des enfants :"}),e.jsx("input",{type:"text",placeholder:"Ex: 5 ans, 12 ans, 17 ans",value:M.ages_enfants||"",onChange:e=>z({...M,ages_enfants:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"👴 Personnes à charge supplémentaires :"}),e.jsx("input",{type:"text",placeholder:"Enfants majeurs, ascendants...",value:M.personnes_charge||"",onChange:e=>z({...M,personnes_charge:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"🌍 Zone de résidence fiscale :"}),e.jsxs("select",{value:M.localisation||"",onChange:e=>z({...M,localisation:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"-- Sélectionnez --"}),e.jsx("option",{value:"france_metropole",children:"France métropolitaine"}),e.jsx("option",{value:"dom_tom",children:"DOM-TOM"}),e.jsx("option",{value:"monaco",children:"Monaco"}),e.jsx("option",{value:"portugal",children:"Portugal"}),e.jsx("option",{value:"belgique",children:"Belgique"}),e.jsx("option",{value:"suisse",children:"Suisse"}),e.jsx("option",{value:"luxembourg",children:"Luxembourg"}),e.jsx("option",{value:"autre_ue",children:"Autre UE"}),e.jsx("option",{value:"hors_ue",children:"Hors UE"})]})]})]})]}),e.jsxs("div",{className:"bg-[#162238]/50 rounded-lg p-6 border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"text-xl font-bold text-white mb-6 flex items-center",children:[e.jsx(I,{className:"w-6 h-6 mr-3 text-[#c5a572]"}),"💼 Statut professionnel et fiscal"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Type de contrat :"}),e.jsxs("select",{value:M.type_contrat||"",onChange:e=>z({...M,type_contrat:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",children:[e.jsx("option",{value:"",children:"-- Sélectionnez --"}),e.jsx("option",{value:"cdi",children:"CDI"}),e.jsx("option",{value:"cdd",children:"CDD"}),e.jsx("option",{value:"tns",children:"TNS"}),e.jsx("option",{value:"gerant_majoritaire",children:"Gérant majoritaire"}),e.jsx("option",{value:"gerant_minoritaire",children:"Gérant minoritaire"}),e.jsx("option",{value:"president_sas",children:"Président SAS"}),e.jsx("option",{value:"auto_entrepreneur",children:"Auto-entrepreneur"}),e.jsx("option",{value:"profession_liberale",children:"Profession libérale"}),e.jsx("option",{value:"fonctionnaire",children:"Fonctionnaire"}),e.jsx("option",{value:"retraite",children:"Retraité"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Secteur d'activité :"}),e.jsx("input",{type:"text",placeholder:"Ex: Conseil, Tech, Immobilier...",value:M.secteur_activite||"",onChange:e=>z({...M,secteur_activite:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Sociétés détenues :"}),e.jsx("input",{type:"text",placeholder:"Ex: SASU conseil, SCI immobilière...",value:M.societes_detenues||"",onChange:e=>z({...M,societes_detenues:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Régime fiscal appliqué :"}),e.jsxs("select",{value:M.regime_imposition||"",onChange:e=>z({...M,regime_imposition:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",children:[e.jsx("option",{value:"",children:"-- Sélectionnez --"}),e.jsx("option",{value:"micro_bic",children:"Micro-BIC"}),e.jsx("option",{value:"micro_bnc",children:"Micro-BNC"}),e.jsx("option",{value:"reel_simplifie",children:"Réel simplifié"}),e.jsx("option",{value:"reel_normal",children:"Réel normal"}),e.jsx("option",{value:"is",children:"IS (Impôt sur les sociétés)"}),e.jsx("option",{value:"ir",children:"IR (Impôt sur le revenu)"}),e.jsx("option",{value:"forfait_agricole",children:"Forfait agricole"})]})]})]})]}),e.jsxs("div",{className:"bg-[#162238]/50 rounded-lg p-6 border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"text-xl font-bold text-white mb-6 flex items-center",children:[e.jsx(i,{className:"w-6 h-6 mr-3 text-[#c5a572]"}),"💰 Revenus"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Revenu global imposable :"}),e.jsxs("select",{value:M.revenus||"",onChange:e=>z({...M,revenus:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",required:!0,children:[e.jsx("option",{value:"",children:"-- Sélectionnez --"}),e.jsx("option",{value:"moins_30k",children:"Moins de 30 000€"}),e.jsx("option",{value:"30k_50k",children:"30 000€ - 50 000€"}),e.jsx("option",{value:"50k_80k",children:"50 000€ - 80 000€"}),e.jsx("option",{value:"80k_120k",children:"80 000€ - 120 000€"}),e.jsx("option",{value:"120k_200k",children:"120 000€ - 200 000€"}),e.jsx("option",{value:"200k_500k",children:"200 000€ - 500 000€"}),e.jsx("option",{value:"plus_500k",children:"Plus de 500 000€"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Tranche marginale d'imposition (TMI) :"}),e.jsxs("select",{value:M.tmi||"",onChange:e=>z({...M,tmi:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",children:[e.jsx("option",{value:"",children:"-- Sélectionnez --"}),e.jsx("option",{value:"0",children:"0% (non imposable)"}),e.jsx("option",{value:"11",children:"11%"}),e.jsx("option",{value:"30",children:"30%"}),e.jsx("option",{value:"41",children:"41%"}),e.jsx("option",{value:"45",children:"45%"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Types de revenus perçus :"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{value:"salaires",label:"Salaires"},{value:"bic",label:"BIC"},{value:"bnc",label:"BNC"},{value:"ba",label:"BA (Agricole)"},{value:"revenus_fonciers",label:"Revenus fonciers"},{value:"dividendes",label:"Dividendes"},{value:"interets",label:"Intérêts"},{value:"plus_values",label:"Plus-values"},{value:"revenus_etrangers",label:"Revenus étrangers"},{value:"revenus_passifs",label:"Revenus passifs"},{value:"crypto",label:"Cryptomonnaies"},{value:"rentes",label:"Rentes / Pensions"}].map((t=>{var s;return e.jsxs("label",{className:"flex items-center space-x-2 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:(null==(s=M.type_revenus)?void 0:s.includes(t.value))||!1,onChange:e=>{const s=M.type_revenus||[];e.target.checked?z({...M,type_revenus:[...s,t.value]}):z({...M,type_revenus:s.filter((e=>e!==t.value))})},className:"w-4 h-4 text-[#c5a572] bg-[#101A2E] border border-[#2A3F6C] rounded focus:ring-[#c5a572]"}),e.jsx("span",{className:"text-sm",children:t.label})]},t.value)}))})]})]}),e.jsxs("div",{className:"bg-[#162238]/50 rounded-lg p-6 border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"text-xl font-bold text-white mb-6 flex items-center",children:[e.jsx(x,{className:"w-6 h-6 mr-3 text-[#c5a572]"}),"🏠 Patrimoine"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Estimation patrimoine brut :"}),e.jsxs("select",{value:M.patrimoine||"",onChange:e=>z({...M,patrimoine:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",children:[e.jsx("option",{value:"",children:"-- Sélectionnez --"}),e.jsx("option",{value:"moins_100k",children:"Moins de 100 000€"}),e.jsx("option",{value:"100k_300k",children:"100 000€ - 300 000€"}),e.jsx("option",{value:"300k_500k",children:"300 000€ - 500 000€"}),e.jsx("option",{value:"500k_1M",children:"500 000€ - 1M€"}),e.jsx("option",{value:"1M_3M",children:"1M€ - 3M€"}),e.jsx("option",{value:"3M_5M",children:"3M€ - 5M€"}),e.jsx("option",{value:"plus_5M",children:"Plus de 5M€"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Niveau d'endettement :"}),e.jsxs("select",{value:M.endettement||"",onChange:e=>z({...M,endettement:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",children:[e.jsx("option",{value:"",children:"-- Sélectionnez --"}),e.jsx("option",{value:"faible",children:"Faible (< 20%)"}),e.jsx("option",{value:"moderee",children:"Modérée (20-50%)"}),e.jsx("option",{value:"eleve",children:"Élevé (> 50%)"}),e.jsx("option",{value:"sans_dette",children:"Sans dette"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Composition patrimoniale :"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{value:"residence_principale",label:"Résidence principale"},{value:"residence_secondaire",label:"Résidence secondaire"},{value:"immobilier_locatif_nu",label:"Immobilier locatif nu"},{value:"immobilier_locatif_meuble",label:"Location meublée"},{value:"scpi",label:"SCPI"},{value:"sci",label:"SCI"},{value:"comptes_titres",label:"Comptes titres"},{value:"pea",label:"PEA"},{value:"assurance_vie",label:"Assurance-vie"},{value:"crypto",label:"Cryptomonnaies"},{value:"metaux_precieux",label:"Métaux précieux"},{value:"oeuvres_art",label:"Œuvres d'art"},{value:"epargne_salariale",label:"Épargne salariale"},{value:"holding",label:"Holding"}].map((t=>{var s;return e.jsxs("label",{className:"flex items-center space-x-2 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:(null==(s=M.composition_patrimoine)?void 0:s.includes(t.value))||!1,onChange:e=>{const s=M.composition_patrimoine||[];e.target.checked?z({...M,composition_patrimoine:[...s,t.value]}):z({...M,composition_patrimoine:s.filter((e=>e!==t.value))})},className:"w-4 h-4 text-[#c5a572] bg-[#101A2E] border border-[#2A3F6C] rounded focus:ring-[#c5a572]"}),e.jsx("span",{className:"text-sm",children:t.label})]},t.value)}))})]})]}),e.jsxs("div",{className:"bg-[#162238]/50 rounded-lg p-6 border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"text-xl font-bold text-white mb-6 flex items-center",children:[e.jsx(y,{className:"w-6 h-6 mr-3 text-[#c5a572]"}),"🎯 Objectifs et projets"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Horizon d'investissement :"}),e.jsxs("select",{value:M.horizon_investissement||"",onChange:e=>z({...M,horizon_investissement:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",children:[e.jsx("option",{value:"",children:"-- Sélectionnez --"}),e.jsx("option",{value:"court_terme",children:"Court terme (< 3 ans)"}),e.jsx("option",{value:"moyen_terme",children:"Moyen terme (3-8 ans)"}),e.jsx("option",{value:"long_terme",children:"Long terme (> 8 ans)"}),e.jsx("option",{value:"mixte",children:"Mixte"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Tolérance au risque :"}),e.jsxs("select",{value:M.tolerance_risque||"",onChange:e=>z({...M,tolerance_risque:e.target.value}),className:"w-full p-3 bg-[#101A2E] border border-[#2A3F6C] rounded-lg text-white focus:border-[#c5a572] focus:outline-none",children:[e.jsx("option",{value:"",children:"-- Sélectionnez --"}),e.jsx("option",{value:"faible",children:"Faible (prudent)"}),e.jsx("option",{value:"moderee",children:"Modérée (équilibré)"}),e.jsx("option",{value:"elevee",children:"Élevée (dynamique)"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-white font-semibold mb-3",children:"Objectifs principaux :"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{value:"reduction_impot",label:"Réduction d'impôt"},{value:"preparation_retraite",label:"Préparation retraite"},{value:"transmission",label:"Transmission patrimoine"},{value:"valorisation",label:"Valorisation patrimoine"},{value:"revenus_complementaires",label:"Revenus complémentaires"},{value:"diversification",label:"Diversification"},{value:"optimisation_fiscale",label:"Optimisation fiscale"},{value:"protection_famille",label:"Protection famille"},{value:"mobilite_fiscale",label:"Mobilité fiscale"}].map((t=>{var s;return e.jsxs("label",{className:"flex items-center space-x-2 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:(null==(s=M.objectifs)?void 0:s.includes(t.value))||!1,onChange:e=>{const s=M.objectifs||[];e.target.checked?z({...M,objectifs:[...s,t.value]}):z({...M,objectifs:s.filter((e=>e!==t.value))})},className:"w-4 h-4 text-[#c5a572] bg-[#101A2E] border border-[#2A3F6C] rounded focus:ring-[#c5a572]"}),e.jsx("span",{className:"text-sm",children:t.label})]},t.value)}))})]})]}),e.jsxs("div",{className:"bg-[#162238]/50 rounded-lg p-6 border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"text-xl font-bold text-white mb-6 flex items-center",children:[e.jsx(f,{className:"w-6 h-6 mr-3 text-[#c5a572]"}),"⚠️ Contraintes fiscales spécifiques"]}),e.jsx("div",{className:"space-y-4",children:[{value:"exposition_ifi",label:"Exposition à l'IFI (patrimoine &gt; 1,3M€)"},{value:"exposition_exit_tax",label:"Exposition à l'exit tax"},{value:"revenus_plusieurs_pays",label:"Revenus dans plusieurs pays"},{value:"plafond_niches_atteint",label:"Plafond des niches fiscales atteint"},{value:"patrimoine_transfrontalier",label:"Activité ou patrimoine transfrontalier"},{value:"controles_fiscaux",label:"Historique de contrôles fiscaux / redressements"}].map((t=>{var s;return e.jsxs("label",{className:"flex items-center space-x-3 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:(null==(s=M.contraintes_fiscales)?void 0:s.includes(t.value))||!1,onChange:e=>{const s=M.contraintes_fiscales||[];e.target.checked?z({...M,contraintes_fiscales:[...s,t.value]}):z({...M,contraintes_fiscales:s.filter((e=>e!==t.value))})},className:"w-4 h-4 text-[#c5a572] bg-[#101A2E] border border-[#2A3F6C] rounded focus:ring-[#c5a572]"}),e.jsx("span",{className:"text-sm",dangerouslySetInnerHTML:{__html:t.label}})]},t.value)}))})]}),e.jsxs("div",{className:"flex space-x-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>{K(null),z($r)},className:"px-6 py-3 bg-[#162238] border border-[#2A3F6C] text-gray-300 rounded-lg hover:bg-[#2A3F6C] hover:text-white transition-colors",children:"← Retour"}),e.jsx("button",{type:"submit",disabled:d,className:"flex-1 px-8 py-4 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-lg shadow-lg hover:shadow-[#c5a572]/40 hover:scale-105 transition-all duration-300 flex items-center justify-center space-x-3 disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{children:"Analyse approfondie en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-6 h-6"}),e.jsx("span",{children:"Analyser mon profil fiscal complet"}),e.jsx(R,{className:"w-5 h-5"})]})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] rounded-full mb-6",children:e.jsx(y,{className:"w-10 h-10 text-[#162238]"})}),e.jsx("h3",{className:"text-2xl font-semibold text-white mb-3",children:"Quel est votre profil principal ?"}),e.jsx("p",{className:"text-gray-300 max-w-2xl mx-auto",children:"Choisissez en 1 clic, puis quelques infos rapides pour personnaliser !"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:[{id:"salarie",icon:y,title:"Salarié / Fonctionnaire",description:"CDI, CDD, fonction publique",color:"from-blue-500 to-blue-600"},{id:"dirigeant_IS",icon:w,title:"Dirigeant de société",description:"SASU, SARL, SAS...",color:"from-purple-500 to-purple-600"},{id:"independant",icon:v,title:"Indépendant",description:"Auto-entrepreneur, libéral",color:"from-green-500 to-green-600"},{id:"investisseur_immobilier",icon:x,title:"Investisseur Immobilier",description:"Locatif, SCPI, LMNP...",color:"from-orange-500 to-orange-600"},{id:"expatrie",icon:b,title:"Expatrié / Non-résident",description:"Résidence à l'étranger",color:"from-teal-500 to-teal-600"},{id:"retraite",icon:g,title:"Retraité",description:"Pension, rente...",color:"from-gray-500 to-gray-600"}].map((t=>e.jsxs("button",{onClick:()=>{K(t.id),z({...M,situation_professionnelle:t.id})},className:`p-6 rounded-xl bg-gradient-to-br ${t.color} hover:scale-105 transition-all duration-300 text-left group shadow-lg hover:shadow-xl`,children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-3",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-lg",children:e.jsx(t.icon,{className:"w-6 h-6 text-white"})}),e.jsx("h4",{className:"text-white font-bold text-lg group-hover:scale-105 transition-transform",children:t.title})]}),e.jsx("p",{className:"text-white/80 text-sm",children:t.description})]},t.id)))}),e.jsxs("div",{className:"text-center pt-4 border-t border-[#2A3F6C]/30",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-3",children:"Situation plus complexe ?"}),e.jsx("button",{onClick:()=>{L((e=>[...e,{role:"assistant",content:'📝 **Pas de problème !** Décrivez-moi votre situation en quelques mots et je m\'adapterai automatiquement.\n\nPar exemple :\n• "Je suis salarié + propriétaire de 3 appartements locatifs"\n• "Dirigeant SASU + investisseur crypto"\n• "Retraité expatrié au Portugal avec des SCPI"\n\nJe détecterai automatiquement tous vos profils !'}])),F("chat")},className:"px-6 py-3 bg-[#162238] border border-[#2A3F6C] text-gray-300 rounded-lg hover:bg-[#2A3F6C] hover:text-white transition-colors",children:"💬 Décrire ma situation à Francis"})]})]})}),Q&&e.jsx(Rr,{detectedProfile:Q,profileData:W||{}})]},"profile"),"analytics"===U&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("h2",{className:"text-3xl font-semibold text-white mb-6",children:"Analyse & Rapports"}),e.jsx("div",{className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-6 sm:p-8 shadow-xl",children:e.jsx("p",{className:"text-gray-300",children:"Les fonctionnalités d'analyse et de rapports seront disponibles ici prochainement."})})]},"analytics"),"settings"===U&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("h2",{className:"text-3xl font-semibold text-white mb-6",children:"Paramètres"}),e.jsx("div",{className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-6 sm:p-8 shadow-xl",children:e.jsx("p",{className:"text-gray-300",children:"Options de configuration du compte et des préférences."})})]},"settings")]})})]})]})}function Ur({open:t,onClose:s}){return t?e.jsx("div",{style:{position:"fixed",zIndex:1e3,left:0,top:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.5)"},onClick:s,children:e.jsxs("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",background:"#1a2942",color:"#fff",borderRadius:12,maxWidth:600,width:"90vw",maxHeight:"90vh",overflowY:"auto",padding:24,fontSize:12,boxShadow:"0 8px 32px #0008"},onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:s,style:{position:"absolute",right:12,top:12,background:"none",border:"none",color:"#c5a572",fontWeight:"bold",fontSize:18,cursor:"pointer"},children:"×"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"inherit",fontSize:11,color:"#e8cfa0",marginTop:24},children:"MENTIONS LÉGALES ET CONDITIONS GÉNÉRALES D'UTILISATION (CGU)\n\nDERNIÈRE MISE À JOUR : 27 MAI 2025\n\nRésumé express\n• Vos données sont protégées, chiffrées, stockées selon les standards RGPD, jamais revendues et supprimables sur simple demande.\n• Abonnement clair, résiliable à tout moment, prix garanti à vie pour les 100 premiers inscrits.\n• Support humain et contact facile : fiscalia.group@gmail.com\n\n⸻\n\n1. Identification de l'Éditeur\n\nNom du site : Fiscal.IA\nÉditeur : FISCAL.IA SAS au capital de 100 €\n• SIREN : 943 531 152\n• SIRET : 943 531 152 00016\n• Siège social : 17 Chemin du Prieuré, 79260 La Crèche, France\n• Directeur de la publication : Monsieur Garcia Aitor\n\nHébergeur :\nNetlify, Inc.\n44 Montgomery Street, Suite 300, San Francisco, CA 94104, USA\nTél. : +1 415-691-1573\nEmail : support@netlify.com\n\nContact général : fiscalia.group@gmail.com\n\n⸻\n\n2. Définitions\n\nDans les présentes CGU, les termes suivants ont la signification ci-après :\n• « Site » : le portail accessible à l'URL https://www.fiscal.ia et ses sous-domaines.\n• « Utilisateur » : toute personne physique majeure accédant au Site.\n• « Données Utilisateur » : toutes informations collectées lors de l'utilisation du Site.\n• « Services » : l'ensemble des fonctionnalités proposées par Fiscal.IA, notamment l'assistant fiscal et financier.\n\n⸻\n\n3. Objet\n\nLe présent document définit les modalités et conditions dans lesquelles FISCAL.IA met à disposition des Utilisateurs les Services du Site. L'utilisation du Site implique l'acceptation sans réserve des présentes CGU.\n\n⸻\n\n4. Accès et conditions d'utilisation\n1. Accès\n• L'accès au Site est réservé aux personnes physiques majeures (18 ans révolus) et capables juridiquement.\n2. Création de compte\n• Certaines fonctionnalités exigent un compte. L'Utilisateur est responsable de la confidentialité de ses identifiants et de toutes les activités réalisées via son compte.\n3. Usage licite\n• L'Utilisateur s'engage à utiliser le Site conformément aux lois en vigueur et aux présentes CGU. Tout usage frauduleux ou abusif pourra entraîner la suspension ou la suppression du compte.\n4. Responsabilité de l'Utilisateur\n• Il appartient à l'Utilisateur de vérifier la conformité des suggestions IA auprès d'experts compétents avant tout usage.\n\n⸻\n\n5. Propriété intellectuelle\n\nTous les éléments (textes, logos, marques, visuels, logiciels, bases de données) présents sur le Site sont la propriété exclusive de FISCAL.IA ou de ses partenaires. Toute reproduction, représentation ou exploitation non autorisée est interdite et constitue une contrefaçon.\n\n⸻\n\n6. Données personnelles et RGPD\n1. Responsable de traitement : FISCAL.IA SAS\n2. Finalités\n• Gestion des abonnements, personnalisation des services, amélioration et sécurité du Site.\n3. Catégories de données\n• Identification (email, nom d'utilisateur), fiscales (revenus, dépenses), financières (épargne, budget), techniques (adresse IP, logs).\n4. Base légale\n• Exécution du contrat (art. 6.1.b RGPD) et intérêt légitime (art. 6.1.f RGPD).\n5. Durées de conservation\n• Données fiscales et financières : durée de l'abonnement + 5 ans.\n• Données de compte : jusqu'à suppression.\n• Données techniques : 1 an.\n6. Transferts hors UE\n• Conformes via clauses contractuelles types.\n7. Droits des Utilisateurs\n• Accès, rectification, suppression, limitation, portabilité, opposition.\n• Exercice par email à fiscalia.group@gmail.com ou courrier au siège.\n8. Cookies\n• Cookie strictement nécessaires, analytiques et fonctionnels.\n• Consentement géré via bannière.\n• Paramétrage possible à tout moment dans votre navigateur.\n9. Délégué à la protection des données (DPO)\n• Contact : fiscalia.group@gmail.com\n\n⸻\n\n7. Clauses de responsabilité\n1. Absence de conseil personnalisé\n• Les suggestions IA sont fournies \"en l'état\" sans garantie. Elles ne constituent pas un conseil fiscal ou financier personnalisé.\n2. Limitation de responsabilité\n• FISCAL.IA décline toute responsabilité en cas de dommages directs ou indirects résultant de l'utilisation du Site ou de l'impossibilité d'y accéder.\n3. Force majeure\n• Événements échappant au contrôle de FISCAL.IA (incendie, inondation, cyberattaque, grève) exonèrent partiellement ou totalement la responsabilité de l'Éditeur.\n4. Indemnisation\n• L'Utilisateur s'engage à indemniser FISCAL.IA contre toute réclamation ou dommage résultant de son usage non conforme du Site.\n\n⸻\n\n8. Conditions tarifaires et abonnement\n1. Tarif\n• Abonnement mensuel : 9,99 € TTC.\n• Prix garanti à vie pour les 100 premiers inscrits (bêta privée avant 15/05/2025).\n2. Facturation et paiement\n• Paiement automatique par carte bancaire via un prestataire sécurisé.\n3. Renouvellement et résiliation\n• Renouvellement automatique chaque mois.\n• Résiliation possible à tout moment via l'espace \"Mon Compte\" ou par email.\n• Résiliation effective en fin de période en cours, sans remboursement prorata.\n4. Droit de rétractation\n• 14 jours selon l'article L.221-18 du Code de la consommation, sans frais, par email à fiscalia.group@gmail.com.\n\n⸻\n\n9. Loi applicable et juridiction\n\nLes présentes CGU sont régies par le droit français. Tout litige relatif à leur interprétation ou exécution sera de la compétence exclusive des tribunaux de Niort, France.\n\n⸻\n\n10. Modification des CGU\n\nFISCAL.IA se réserve le droit de modifier à tout moment les présentes CGU. Les modifications seront publiées sur cette page et notifiées par email. L'utilisation continue du Site après publication vaut acceptation des nouvelles CGU.\n\n⸻\n\nPour toute question ou réclamation, contactez-nous à fiscalia.group@gmail.com."})]})}):null}function Dr(){const[t,s]=D.useState(null),[r,i]=D.useState(!0),[n,a]=D.useState(!1);return D.useEffect((()=>{Sr.auth.getSession().then((({data:{session:e}})=>{s((null==e?void 0:e.user)??null),i(!1)}));const{data:{subscription:e}}=Sr.auth.onAuthStateChange(((e,t)=>{s((null==t?void 0:t.user)??null)}));return()=>e.unsubscribe()}),[]),r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876] flex items-center justify-center",children:e.jsx("div",{className:"text-white text-xl",children:"Chargement..."})}):e.jsxs(e.Fragment,{children:[e.jsx(M,{children:e.jsxs(z,{children:[e.jsx(B,{path:"/",element:e.jsx(Ir,{})}),e.jsx(B,{path:"/dashboard",element:t?e.jsx(Lr,{}):e.jsx(J,{to:"/",replace:!0})}),e.jsx(B,{path:"*",element:e.jsx(J,{to:"/",replace:!0})})]})}),e.jsx("footer",{style:{position:"fixed",left:0,right:0,bottom:0,zIndex:100,textAlign:"center",fontSize:10,color:"#c5a572",background:"rgba(26,41,66,0.85)",padding:4,letterSpacing:.5},children:e.jsx("button",{style:{background:"none",border:"none",color:"#c5a572",textDecoration:"underline",cursor:"pointer",fontSize:10},onClick:()=>a(!0),children:"Mentions légales et CGU"})}),e.jsx(Ur,{open:n,onClose:()=>a(!1)})]})}G.createRoot(document.getElementById("root")).render(e.jsx(F.StrictMode,{children:e.jsx(Dr,{})}));
//# sourceMappingURL=main-BWAXY4Br.js.map
