const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-BaWd0N-J.js","assets/vendor-UD6CX1rU.js"])))=>i.map(i=>d[i]);
import{j as e,X as t,m as s,M as i,E as r,U as a,C as n,A as o,S as l,a as c,b as d,F as u,c as h,B as m,d as p,P as f,T as g,e as x,f as v,g as b,h as y,i as w,k as _,G as j,H as N,Z as k,l as S,n as C,o as T,L as E,p as A,q as P,r as I,s as O,t as R,u as $,v as L,w as U,x as D,y as F,z as q}from"./ui-DXC-Sdmd.js";import{a as M,g as z,c as B,r as J,b as G}from"./vendor-UD6CX1rU.js";import{u as V,B as H,R as K,a as W,N as Q}from"./router-RMwWabV4.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Y={},X=M;Y.createRoot=X.createRoot,Y.hydrateRoot=X.hydrateRoot;const Z={},ee=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));i=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in Z)return;Z[e]=!0;const t=e.endsWith(".css"),i=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${i}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,s&&r.setAttribute("nonce",s),document.head.appendChild(r),t?new Promise(((t,s)=>{r.addEventListener("load",t),r.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return i.then((t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)}))};class te extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class se extends te{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ie extends te{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class re extends te{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ae,ne;(ne=ae||(ae={})).Any="any",ne.ApNortheast1="ap-northeast-1",ne.ApNortheast2="ap-northeast-2",ne.ApSouth1="ap-south-1",ne.ApSoutheast1="ap-southeast-1",ne.ApSoutheast2="ap-southeast-2",ne.CaCentral1="ca-central-1",ne.EuCentral1="eu-central-1",ne.EuWest1="eu-west-1",ne.EuWest2="eu-west-2",ne.EuWest3="eu-west-3",ne.SaEast1="sa-east-1",ne.UsEast1="us-east-1",ne.UsWest1="us-west-1",ne.UsWest2="us-west-2";var oe=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};class le{constructor(e,{headers:t={},customFetch:s,region:i=ae.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ee((async()=>{const{default:e}=await Promise.resolve().then((()=>we));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return oe(this,void 0,void 0,(function*(){try{const{headers:i,method:r,body:a}=t;let n,o={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(o["x-region"]=l),a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&("undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",n=a):"string"==typeof a?(o["Content-Type"]="text/plain",n=a):"undefined"!=typeof FormData&&a instanceof FormData?n=a:(o["Content-Type"]="application/json",n=JSON.stringify(a)));const c=yield this.fetch(`${this.url}/${e}`,{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:n}).catch((e=>{throw new se(e)})),d=c.headers.get("x-relay-error");if(d&&"true"===d)throw new ie(c);if(!c.ok)throw new re(c);let u,h=(null!==(s=c.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return u="application/json"===h?yield c.json():"application/octet-stream"===h?yield c.blob():"text/event-stream"===h?c:"multipart/form-data"===h?yield c.formData():yield c.text(),{data:u,error:null}}catch(i){return{data:null,error:i}}}))}}var ce={},de={},ue={},he={},me={},pe={},fe=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const ge=fe.fetch,xe=fe.fetch.bind(fe),ve=fe.Headers,be=fe.Request,ye=fe.Response,we=Object.freeze(Object.defineProperty({__proto__:null,Headers:ve,Request:be,Response:ye,default:xe,fetch:ge},Symbol.toStringTag,{value:"Module"})),_e=z(we);var je={};Object.defineProperty(je,"__esModule",{value:!0});let Ne=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};je.default=Ne;var ke=B&&B.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(pe,"__esModule",{value:!0});const Se=ke(_e),Ce=ke(je);pe.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=Se.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async e=>{var t,s,i;let r=null,a=null,n=null,o=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(a="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const i=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");i&&c&&c.length>1&&(n=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(a)&&(a.length>1?(r={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,n=null,o=406,l="Not Acceptable"):a=1===a.length?a[0]:null)}else{const t=await e.text();try{r=JSON.parse(t),Array.isArray(r)&&404===e.status&&(a=[],r=null,o=200,l="OK")}catch(c){404===e.status&&""===t?(o=204,l="No Content"):r={message:t}}if(r&&this.isMaybeSingle&&(null===(i=null==r?void 0:r.details)||void 0===i?void 0:i.includes("0 rows"))&&(r=null,o=200,l="OK"),r&&this.shouldThrowOnError)throw new Ce.default(r)}return{error:r,data:a,count:n,status:o,statusText:l}}));return this.shouldThrowOnError||(s=s.catch((e=>{var t,s,i;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(i=null==e?void 0:e.code)&&void 0!==i?i:""}`},data:null,count:null,status:0,statusText:""}}))),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var Te=B&&B.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(me,"__esModule",{value:!0});const Ee=Te(pe);let Ae=class extends Ee.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:r=i}={}){const a=r?`${r}.order`:"order",n=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${n?`${n},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const r=void 0===i?"offset":`${i}.offset`,a=void 0===i?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(a,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:r=!1,format:a="text"}={}){var n;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,r?"wal":null].filter(Boolean).join("|"),l=null!==(n=this.headers.Accept)&&void 0!==n?n:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};me.default=Ae;var Pe=B&&B.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(he,"__esModule",{value:!0});const Ie=Pe(me);let Oe=class extends Ie.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let r="";"plain"===i?r="pl":"phrase"===i?r="ph":"websearch"===i&&(r="w");const a=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${r}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};he.default=Oe;var Re=B&&B.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ue,"__esModule",{value:!0});const $e=Re(he);ue.default=class{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let r=!1;const a=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!r?"":('"'===e&&(r=!r),e))).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer=`count=${s}`),new $e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new $e.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:r=!0}={}){const a=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),r||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new $e.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new $e.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new $e.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var Le={},Ue={};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.version=void 0,Ue.version="0.0.0-automated",Object.defineProperty(Le,"__esModule",{value:!0}),Le.DEFAULT_HEADERS=void 0;const De=Ue;Le.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${De.version}`};var Fe=B&&B.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(de,"__esModule",{value:!0});const qe=Fe(ue),Me=Fe(he),ze=Le;de.default=class e{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},ze.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new qe.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:r}={}){let a;const n=new URL(`${this.url}/rpc/${e}`);let o;s||i?(a=s?"HEAD":"GET",Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`])).forEach((([e,t])=>{n.searchParams.append(e,t)}))):(a="POST",o=t);const l=Object.assign({},this.headers);return r&&(l.Prefer=`count=${r}`),new Me.default({method:a,url:n,headers:l,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}};var Be=B&&B.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ce,"__esModule",{value:!0}),ce.PostgrestError=ce.PostgrestBuilder=ce.PostgrestTransformBuilder=ce.PostgrestFilterBuilder=ce.PostgrestQueryBuilder=ce.PostgrestClient=void 0;const Je=Be(de);ce.PostgrestClient=Je.default;const Ge=Be(ue);ce.PostgrestQueryBuilder=Ge.default;const Ve=Be(he);ce.PostgrestFilterBuilder=Ve.default;const He=Be(me);ce.PostgrestTransformBuilder=He.default;const Ke=Be(pe);ce.PostgrestBuilder=Ke.default;const We=Be(je);ce.PostgrestError=We.default;var Qe=ce.default={PostgrestClient:Je.default,PostgrestQueryBuilder:Ge.default,PostgrestFilterBuilder:Ve.default,PostgrestTransformBuilder:He.default,PostgrestBuilder:Ke.default,PostgrestError:We.default};const{PostgrestClient:Ye,PostgrestQueryBuilder:Xe,PostgrestFilterBuilder:Ze,PostgrestTransformBuilder:et,PostgrestBuilder:tt,PostgrestError:st}=Qe,it={"X-Client-Info":"realtime-js/2.11.2"};var rt,at,nt,ot,lt,ct,dt,ut,ht,mt,pt;(at=rt||(rt={}))[at.connecting=0]="connecting",at[at.open=1]="open",at[at.closing=2]="closing",at[at.closed=3]="closed",(ot=nt||(nt={})).closed="closed",ot.errored="errored",ot.joined="joined",ot.joining="joining",ot.leaving="leaving",(ct=lt||(lt={})).close="phx_close",ct.error="phx_error",ct.join="phx_join",ct.reply="phx_reply",ct.leave="phx_leave",ct.access_token="access_token",(dt||(dt={})).websocket="websocket",(ht=ut||(ut={})).Connecting="connecting",ht.Open="open",ht.Closing="closing",ht.Closed="closed";class ft{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),r=t.getUint8(2);let a=this.HEADER_LENGTH+2;const n=s.decode(e.slice(a,a+i));a+=i;const o=s.decode(e.slice(a,a+r));a+=r;return{ref:null,topic:n,event:o,payload:JSON.parse(s.decode(e.slice(a,e.byteLength)))}}}class gt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}(pt=mt||(mt={})).abstime="abstime",pt.bool="bool",pt.date="date",pt.daterange="daterange",pt.float4="float4",pt.float8="float8",pt.int2="int2",pt.int4="int4",pt.int4range="int4range",pt.int8="int8",pt.int8range="int8range",pt.json="json",pt.jsonb="jsonb",pt.money="money",pt.numeric="numeric",pt.oid="oid",pt.reltime="reltime",pt.text="text",pt.time="time",pt.timestamp="timestamp",pt.timestamptz="timestamptz",pt.timetz="timetz",pt.tsrange="tsrange",pt.tstzrange="tstzrange";const xt=(e,t,s={})=>{var i;const r=null!==(i=s.skipTypes)&&void 0!==i?i:[];return Object.keys(t).reduce(((s,i)=>(s[i]=vt(i,e,t,r),s)),{})},vt=(e,t,s,i)=>{const r=t.find((t=>t.name===e)),a=null==r?void 0:r.type,n=s[e];return a&&!i.includes(a)?bt(a,n):yt(n)},bt=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return Nt(t,s)}switch(e){case mt.bool:return wt(t);case mt.float4:case mt.float8:case mt.int2:case mt.int4:case mt.int8:case mt.numeric:case mt.oid:return _t(t);case mt.json:case mt.jsonb:return jt(t);case mt.timestamp:return kt(t);case mt.abstime:case mt.date:case mt.daterange:case mt.int4range:case mt.int8range:case mt.money:case mt.reltime:case mt.text:case mt.time:case mt.timestamptz:case mt.timetz:case mt.tsrange:case mt.tstzrange:default:return yt(t)}},yt=e=>e,wt=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},_t=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},jt=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Nt=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,i=e[s];if("{"===e[0]&&"}"===i){let i;const a=e.slice(1,s);try{i=JSON.parse("["+a+"]")}catch(r){i=a?a.split(","):[]}return i.map((e=>bt(t,e)))}return e},kt=e=>"string"==typeof e?e.replace(" ","T"):e,St=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class Ct{constructor(e,t,s={},i=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Tt,Et,At,Pt,It,Ot,Rt,$t;(Et=Tt||(Tt={})).SYNC="sync",Et.JOIN="join",Et.LEAVE="leave";class Lt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},(e=>{const{onJoin:t,onLeave:s,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Lt.syncState(this.state,e,t,s),this.pendingDiffs.forEach((e=>{this.state=Lt.syncDiff(this.state,e,t,s)})),this.pendingDiffs=[],i()})),this.channel._on(s.diff,{},(e=>{const{onJoin:t,onLeave:s,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Lt.syncDiff(this.state,e,t,s),i())})),this.onJoin(((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})})),this.onLeave(((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,s,i){const r=this.cloneDeep(e),a=this.transformState(t),n={},o={};return this.map(r,((e,t)=>{a[e]||(o[e]=t)})),this.map(a,((e,t)=>{const s=r[e];if(s){const i=t.map((e=>e.presence_ref)),r=s.map((e=>e.presence_ref)),a=t.filter((e=>r.indexOf(e.presence_ref)<0)),l=s.filter((e=>i.indexOf(e.presence_ref)<0));a.length>0&&(n[e]=a),l.length>0&&(o[e]=l)}else n[e]=t})),this.syncDiff(r,{joins:n,leaves:o},s,i)}static syncDiff(e,t,s,i){const{joins:r,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(r,((t,i)=>{var r;const a=null!==(r=e[t])&&void 0!==r?r:[];if(e[t]=this.cloneDeep(i),a.length>0){const s=e[t].map((e=>e.presence_ref)),i=a.filter((e=>s.indexOf(e.presence_ref)<0));e[t].unshift(...i)}s(t,a,i)})),this.map(a,((t,s)=>{let r=e[t];if(!r)return;const a=s.map((e=>e.presence_ref));r=r.filter((e=>a.indexOf(e.presence_ref)<0)),e[t]=r,i(t,r,s),0===r.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((s=>t(s,e[s])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,s)=>{const i=e[s];return t[s]="metas"in i?i.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):i,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Pt=At||(At={})).ALL="*",Pt.INSERT="INSERT",Pt.UPDATE="UPDATE",Pt.DELETE="DELETE",(Ot=It||(It={})).BROADCAST="broadcast",Ot.PRESENCE="presence",Ot.POSTGRES_CHANGES="postgres_changes",Ot.SYSTEM="system",($t=Rt||(Rt={})).SUBSCRIBED="SUBSCRIBED",$t.TIMED_OUT="TIMED_OUT",$t.CLOSED="CLOSED",$t.CHANNEL_ERROR="CHANNEL_ERROR";class Ut{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=nt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ct(this,lt.join,this.params,this.timeout),this.rejoinTimer=new gt((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=nt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=nt.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=nt.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=nt.errored,this.rejoinTimer.scheduleTimeout())})),this._on(lt.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new Lt(this),this.broadcastEndpointURL=St(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:r,presence:a,private:n}}=this.params;this._onError((t=>null==e?void 0:e(Rt.CHANNEL_ERROR,t))),this._onClose((()=>null==e?void 0:e(Rt.CLOSED)));const o={},l={broadcast:r,presence:a,postgres_changes:null!==(i=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map((e=>e.filter)))&&void 0!==i?i:[],private:n};this.socket.accessTokenValue&&(o.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const i=this.bindings.postgres_changes,r=null!==(s=null==i?void 0:i.length)&&void 0!==s?s:0,a=[];for(let s=0;s<r;s++){const r=i[s],{filter:{event:n,schema:o,table:l,filter:c}}=r,d=t&&t[s];if(!d||d.event!==n||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),void(null==e||e(Rt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));a.push(Object.assign(Object.assign({},r),{id:d.id}))}return this.bindings.postgres_changes=a,void(e&&e(Rt.SUBSCRIBED))}null==e||e(Rt.SUBSCRIBED)})).receive("error",(t=>{null==e||e(Rt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{null==e||e(Rt.TIMED_OUT)}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(this._canPush()||"broadcast"!==e.type)return new Promise((s=>{var i,r,a;const n=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(r=null===(i=this.params)||void 0===i?void 0:i.config)||void 0===r?void 0:r.broadcast)||void 0===a?void 0:a.ack)||s("ok"),n.receive("ok",(()=>s("ok"))),n.receive("error",(()=>s("error"))),n.receive("timeout",(()=>s("timed out")))}));{const{event:a,payload:n}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:n,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(i=e.body)||void 0===i?void 0:i.cancel()),e.ok?"ok":"error"}catch(r){return"AbortError"===r.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=nt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(lt.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((s=>{const i=new Ct(this,lt.leave,{},e);i.receive("ok",(()=>{t(),s("ok")})).receive("timeout",(()=>{t(),s("timed out")})).receive("error",(()=>{s("error")})),i.send(),this._canPush()||i.trigger("ok",{})}))}async _fetchWithTimeout(e,t,s){const i=new AbortController,r=setTimeout((()=>i.abort()),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(r),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Ct(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,r;const a=e.toLocaleLowerCase(),{close:n,error:o,leave:l,join:c}=lt;if(s&&[n,o,l,c].indexOf(a)>=0&&s!==this._joinRef())return;let d=this._onMessage(a,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(i=this.bindings.postgres_changes)||void 0===i||i.filter((e=>{var t,s,i;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(i=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===i?void 0:i.toLocaleLowerCase())===a})).map((e=>e.callback(d,s))):null===(r=this.bindings[a])||void 0===r||r.filter((e=>{var s,i,r,n,o,l;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){const a=e.id,n=null===(s=e.filter)||void 0===s?void 0:s.event;return a&&(null===(i=t.ids)||void 0===i?void 0:i.includes(a))&&("*"===n||(null==n?void 0:n.toLocaleLowerCase())===(null===(r=t.data)||void 0===r?void 0:r.type.toLocaleLowerCase()))}{const s=null===(o=null===(n=null==e?void 0:e.filter)||void 0===n?void 0:n.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===a})).map((e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:i,type:r,errors:a}=e,n={schema:t,table:s,commit_timestamp:i,eventType:r,new:{},old:{},errors:a};d=Object.assign(Object.assign({},n),this._getPayloadRecords(e))}e.callback(d,s)}))}_isClosed(){return this.state===nt.closed}_isJoined(){return this.state===nt.joined}_isJoining(){return this.state===nt.joining}_isLeaving(){return this.state===nt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),r={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(r):this.bindings[i]=[r],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter((e=>{var i;return!((null===(i=e.type)||void 0===i?void 0:i.toLocaleLowerCase())===s&&Ut.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(lt.close,{},e)}_onError(e){this._on(lt.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=nt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=xt(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=xt(e.columns,e.old_record)),t}}const Dt=()=>{},Ft="undefined"!=typeof WebSocket;class qt{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=it,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Dt,this.conn=null,this.sendBuffer=[],this.serializer=new ft,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ee((async()=>{const{default:e}=await Promise.resolve().then((()=>we));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${dt.websocket}`,this.httpEndpoint=St(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new gt((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});else{if(Ft)return this.conn=new WebSocket(this.endpointURL()),void this.setupConnection();this.conn=new Mt(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),ee((async()=>{const{default:e}=await import("./browser-BaWd0N-J.js").then((e=>e.b));return{default:e}}),__vite__mapDeps([0,1])).then((({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()}))}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case rt.connecting:return ut.Connecting;case rt.open:return ut.Open;case rt.closing:return ut.Closing;default:return ut.Closed}}isConnected(){return this.connectionState()===ut.Open}channel(e,t={config:{}}){const s=new Ut(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:i,ref:r}=e,a=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${s} (${r})`,i),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let e=null;try{e=JSON.parse(atob(t.split(".")[1]))}catch(s){}if(e&&e.exp){if(!(Math.floor(Date.now()/1e3)-e.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`)}this.accessTokenValue=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(lt.access_token,{access_token:t})}))}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t._joinRef()!==e._joinRef()))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:s,payload:i,ref:r}=e;r&&r===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${t} ${s} ${r&&"("+r+")"||""}`,i),this.channels.filter((e=>e._isMember(t))).forEach((e=>e._trigger(s,i,r))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(lt.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class Mt{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=rt.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class zt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Bt(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Jt extends zt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Gt extends zt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Vt=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};const Ht=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ee((async()=>{const{default:e}=await Promise.resolve().then((()=>we));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},Kt=e=>{if(Array.isArray(e))return e.map((e=>Kt(e)));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach((([e,s])=>{const i=e.replace(/([-_][a-z])/gi,(e=>e.toUpperCase().replace(/[-_]/g,"")));t[i]=Kt(s)})),t};var Wt=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};const Qt=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Yt=(e,t,s)=>Wt(void 0,void 0,void 0,(function*(){const i=yield Vt(void 0,void 0,void 0,(function*(){return"undefined"==typeof Response?(yield ee((()=>Promise.resolve().then((()=>we))),void 0)).Response:Response}));e instanceof i&&!(null==s?void 0:s.noResolveJson)?e.json().then((s=>{t(new Jt(Qt(s),e.status||500))})).catch((e=>{t(new Gt(Qt(e),e))})):t(new Gt(Qt(e),e))}));function Xt(e,t,s,i,r,a){return Wt(this,void 0,void 0,(function*(){return new Promise(((n,o)=>{e(s,((e,t,s,i)=>{const r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?r:(r.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),i&&(r.body=JSON.stringify(i)),Object.assign(Object.assign({},r),s))})(t,i,r,a)).then((e=>{if(!e.ok)throw e;return(null==i?void 0:i.noResolveJson)?e:e.json()})).then((e=>n(e))).catch((e=>Yt(e,o,i)))}))}))}function Zt(e,t,s,i){return Wt(this,void 0,void 0,(function*(){return Xt(e,"GET",t,s,i)}))}function es(e,t,s,i,r){return Wt(this,void 0,void 0,(function*(){return Xt(e,"POST",t,i,r,s)}))}function ts(e,t,s,i,r){return Wt(this,void 0,void 0,(function*(){return Xt(e,"DELETE",t,i,r,s)}))}var ss=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};const is={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},rs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class as{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Ht(i)}uploadOrUpdate(e,t,s,i){return ss(this,void 0,void 0,(function*(){try{let r;const a=Object.assign(Object.assign({},rs),i);let n=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(a.upsert)});const o=a.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(r=new FormData,r.append("cacheControl",a.cacheControl),o&&r.append("metadata",this.encodeMetadata(o)),r.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(r=s,r.append("cacheControl",a.cacheControl),o&&r.append("metadata",this.encodeMetadata(o))):(r=s,n["cache-control"]=`max-age=${a.cacheControl}`,n["content-type"]=a.contentType,o&&(n["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==i?void 0:i.headers)&&(n=Object.assign(Object.assign({},n),i.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:r,headers:n},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{})),u=yield d.json();if(d.ok)return{data:{path:l,id:u.Id,fullPath:u.Key},error:null};return{data:null,error:u}}catch(r){if(Bt(r))return{data:null,error:r};throw r}}))}upload(e,t,s){return ss(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,s)}))}uploadToSignedUrl(e,t,s,i){return ss(this,void 0,void 0,(function*(){const r=this._removeEmptyFolders(e),a=this._getFinalPath(r),n=new URL(this.url+`/object/upload/sign/${a}`);n.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:rs.upsert},i),a=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType);const o=yield this.fetch(n.toString(),{method:"PUT",body:e,headers:a}),l=yield o.json();if(o.ok)return{data:{path:r,fullPath:l.Key},error:null};return{data:null,error:l}}catch(o){if(Bt(o))return{data:null,error:o};throw o}}))}createSignedUploadUrl(e,t){return ss(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(i["x-upsert"]="true");const r=yield es(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),a=new URL(this.url+r.url),n=a.searchParams.get("token");if(!n)throw new zt("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:n},error:null}}catch(s){if(Bt(s))return{data:null,error:s};throw s}}))}update(e,t,s){return ss(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,s)}))}move(e,t,s){return ss(this,void 0,void 0,(function*(){try{return{data:yield es(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(Bt(i))return{data:null,error:i};throw i}}))}copy(e,t,s){return ss(this,void 0,void 0,(function*(){try{return{data:{path:(yield es(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(Bt(i))return{data:null,error:i};throw i}}))}createSignedUrl(e,t,s){return ss(this,void 0,void 0,(function*(){try{let i=this._getFinalPath(e),r=yield es(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const a=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${a}`)},{data:r,error:null}}catch(i){if(Bt(i))return{data:null,error:i};throw i}}))}createSignedUrls(e,t,s){return ss(this,void 0,void 0,(function*(){try{const i=yield es(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),r=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:i.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${r}`):null}))),error:null}}catch(i){if(Bt(i))return{data:null,error:i};throw i}}))}download(e,t){return ss(this,void 0,void 0,(function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),r=i?`?${i}`:"";try{const t=this._getFinalPath(e),i=yield Zt(this.fetch,`${this.url}/${s}/${t}${r}`,{headers:this.headers,noResolveJson:!0});return{data:yield i.blob(),error:null}}catch(a){if(Bt(a))return{data:null,error:a};throw a}}))}info(e){return ss(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{const e=yield Zt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Kt(e),error:null}}catch(s){if(Bt(s))return{data:null,error:s};throw s}}))}exists(e){return ss(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,i){return Wt(this,void 0,void 0,(function*(){return Xt(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),i)}))}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(Bt(s)&&s instanceof Gt){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}}))}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],r=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==r&&i.push(r);const a=void 0!==(null==t?void 0:t.transform)?"render/image":"object",n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==n&&i.push(n);let o=i.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${o}`)}}}remove(e){return ss(this,void 0,void 0,(function*(){try{return{data:yield ts(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Bt(t))return{data:null,error:t};throw t}}))}list(e,t,s){return ss(this,void 0,void 0,(function*(){try{const i=Object.assign(Object.assign(Object.assign({},is),t),{prefix:e||""});return{data:yield es(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(Bt(i))return{data:null,error:i};throw i}}))}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const ns={"X-Client-Info":"storage-js/2.7.1"};var os=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};class ls{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},ns),t),this.fetch=Ht(s)}listBuckets(){return os(this,void 0,void 0,(function*(){try{return{data:yield Zt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Bt(e))return{data:null,error:e};throw e}}))}getBucket(e){return os(this,void 0,void 0,(function*(){try{return{data:yield Zt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Bt(t))return{data:null,error:t};throw t}}))}createBucket(e,t={public:!1}){return os(this,void 0,void 0,(function*(){try{return{data:yield es(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Bt(s))return{data:null,error:s};throw s}}))}updateBucket(e,t){return os(this,void 0,void 0,(function*(){try{const s=yield function(e,t,s,i,r){return Wt(this,void 0,void 0,(function*(){return Xt(e,"PUT",t,i,r,s)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:s,error:null}}catch(s){if(Bt(s))return{data:null,error:s};throw s}}))}emptyBucket(e){return os(this,void 0,void 0,(function*(){try{return{data:yield es(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Bt(t))return{data:null,error:t};throw t}}))}deleteBucket(e){return os(this,void 0,void 0,(function*(){try{return{data:yield ts(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Bt(t))return{data:null,error:t};throw t}}))}}class cs extends ls{constructor(e,t={},s){super(e,t,s)}from(e){return new as(this.url,this.headers,e,this.fetch)}}let ds="";ds="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const us={headers:{"X-Client-Info":`supabase-js-${ds}/2.49.8`}},hs={schema:"public"},ms={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ps={};var fs=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};const gs=(e,t,s)=>{const i=(e=>{let t;return t=e||("undefined"==typeof fetch?xe:fetch),(...e)=>t(...e)})(s),r="undefined"==typeof Headers?ve:Headers;return(s,a)=>fs(void 0,void 0,void 0,(function*(){var n;const o=null!==(n=yield t())&&void 0!==n?n:e;let l=new r(null==a?void 0:a.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),i(s,Object.assign(Object.assign({},a),{headers:l}))}))};var xs=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};const vs="2.69.1",bs=3e4,ys=9e4,ws={"X-Client-Info":`gotrue-js/${vs}`},_s="X-Supabase-Api-Version",js={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Ns=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class ks extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Ss(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Cs extends ks{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class Ts extends ks{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Es extends ks{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class As extends Es{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Ps extends Es{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Is extends Es{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Os extends Es{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Rs extends Es{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class $s extends Es{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ls(e){return Ss(e)&&"AuthRetryableFetchError"===e.name}class Us extends Es{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Ds extends Es{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Fs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),qs=" \t\n\r=".split(""),Ms=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<qs.length;t+=1)e[qs[t].charCodeAt(0)]=-2;for(let t=0;t<Fs.length;t+=1)e[Fs[t].charCodeAt(0)]=t;return e})();function zs(e,t,s){const i=Ms[e];if(!(i>-1)){if(-2===i)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|i,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Bs(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},i={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},a=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,i,s)};for(let n=0;n<e.length;n+=1)zs(e.charCodeAt(n),r,a);return t.join("")}function Js(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Gs(e){const t=[],s={queue:0,queuedBits:0},i=e=>{t.push(e)};for(let r=0;r<e.length;r+=1)zs(e.charCodeAt(r),s,i);return new Uint8Array(t)}function Vs(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let i=e.charCodeAt(s);if(i>55295&&i<=56319){const t=1024*(i-55296)&65535;i=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}Js(i,t)}}(e,(e=>t.push(e))),new Uint8Array(t)}const Hs=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Ks={tested:!1,writable:!1},Ws=()=>{if(!Hs())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(Ks.tested)return Ks.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Ks.tested=!0,Ks.writable=!0}catch(t){Ks.tested=!0,Ks.writable=!1}return Ks.writable};const Qs=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ee((async()=>{const{default:e}=await Promise.resolve().then((()=>we));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},Ys=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},Xs=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(i){return s}},Zs=async(e,t)=>{await e.removeItem(t)};class ei{constructor(){this.promise=new ei.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function ti(e){const t=e.split(".");if(3!==t.length)throw new Ds("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!Ns.test(t[s]))throw new Ds("JWT not in base64url format");return{header:JSON.parse(Bs(t[0])),payload:JSON.parse(Bs(t[1])),signature:Gs(t[2]),raw:{header:t[0],payload:t[1]}}}function si(e){return("0"+e.toString(16)).substr(-2)}async function ii(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map((e=>String.fromCharCode(e))).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ri(e,t,s=!1){const i=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let i=0;i<56;i++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,si).join("")}();let r=i;s&&(r+="/PASSWORD_RECOVERY"),await Ys(e,`${t}-code-verifier`,r);const a=await ii(i);return[a,i===a?"plain":"s256"]}ei.promiseConstructor=Promise;const ai=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const ni=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),oi=[502,503,504];async function li(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new $s(ni(e),0);if(oi.includes(e.status))throw new $s(ni(e),e.status);let i,r;try{i=await e.json()}catch(n){throw new Ts(ni(n),n)}const a=function(e){const t=e.headers.get(_s);if(!t)return null;if(!t.match(ai))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(n){return null}}(e);if(a&&a.getTime()>=js.timestamp&&"object"==typeof i&&i&&"string"==typeof i.code?r=i.code:"object"==typeof i&&i&&"string"==typeof i.error_code&&(r=i.error_code),r){if("weak_password"===r)throw new Us(ni(i),e.status,(null===(t=i.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===r)throw new As}else if("object"==typeof i&&i&&"object"==typeof i.weak_password&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new Us(ni(i),e.status,i.weak_password.reasons);throw new Cs(ni(i),e.status||500,r)}async function ci(e,t,s,i){var r;const a=Object.assign({},null==i?void 0:i.headers);a[_s]||(a[_s]=js.name),(null==i?void 0:i.jwt)&&(a.Authorization=`Bearer ${i.jwt}`);const n=null!==(r=null==i?void 0:i.query)&&void 0!==r?r:{};(null==i?void 0:i.redirectTo)&&(n.redirect_to=i.redirectTo);const o=Object.keys(n).length?"?"+new URLSearchParams(n).toString():"",l=await async function(e,t,s,i,r,a){const n=((e,t,s,i)=>{const r={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),r.body=JSON.stringify(i),Object.assign(Object.assign({},r),s))})(t,i,r,a);let o;try{o=await e(s,Object.assign({},n))}catch(l){throw console.error(l),new $s(ni(l),0)}o.ok||await li(o);if(null==i?void 0:i.noResolveJson)return o;try{return await o.json()}catch(l){await li(l)}}(e,t,s+o,{headers:a,noResolveJson:null==i?void 0:i.noResolveJson},{},null==i?void 0:i.body);return(null==i?void 0:i.xform)?null==i?void 0:i.xform(l):{data:Object.assign({},l),error:null}}function di(e){var t;let s=null;var i;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(i=e.expires_in,Math.round(Date.now()/1e3)+i)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ui(e){const t=di(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function hi(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function mi(e){return{data:e,error:null}}function pi(e){const{action_link:t,email_otp:s,hashed_token:i,redirect_to:r,verification_type:a}=e,n=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(s[i[r]]=e[i[r]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:i,redirect_to:r,verification_type:a},user:Object.assign({},n)},error:null}}function fi(e){return e}class gi{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Qs(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await ci(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Ss(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await ci(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:hi})}catch(s){if(Ss(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(s[i[r]]=e[i[r]])}return s}(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=null==s?void 0:s.newEmail,delete i.newEmail),await ci(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:pi,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Ss(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await ci(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:hi})}catch(t){if(Ss(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,r,a,n,o;try{const l={nextPage:null,lastPage:0,total:0},c=await ci(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(r=null===(i=null==e?void 0:e.perPage)||void 0===i?void 0:i.toString())&&void 0!==r?r:""},xform:fi});if(c.error)throw c.error;const d=await c.json(),u=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,h=null!==(o=null===(n=c.headers.get("link"))||void 0===n?void 0:n.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t})),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Ss(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await ci(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:hi})}catch(t){if(Ss(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await ci(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:hi})}catch(s){if(Ss(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await ci(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:hi})}catch(s){if(Ss(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await ci(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(Ss(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await ci(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Ss(t))return{data:null,error:t};throw t}}}const xi={getItem:e=>Ws()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{Ws()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{Ws()&&globalThis.localStorage.removeItem(e)}};function vi(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const bi=!!(globalThis&&Ws()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class yi extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class wi extends yi{}async function _i(e,t,s){bi&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const i=new globalThis.AbortController;return t>0&&setTimeout((()=>{i.abort(),bi&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)}),t),await Promise.resolve().then((()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},(async i=>{if(!i){if(0===t)throw bi&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new wi(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(bi)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}bi&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,i.name);try{return await s()}finally{bi&&console.log("@supabase/gotrue-js: navigatorLock: released",e,i.name)}}))))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const ji={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ws,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ni(e,t,s){return await s()}class ki{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ki.nextInstanceID,ki.nextInstanceID+=1,this.instanceID>0&&Hs()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},ji),e);if(this.logDebugMessages=!!i.debug,"function"==typeof i.debug&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new gi({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Qs(i.fetch),this.lock=i.lock||Ni,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Hs()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=_i:this.lock=Ni,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:Ws()?this.storage=xi:(this.memoryStorage={},this.storage=vi(this.memoryStorage)):(this.memoryStorage={},this.storage=vi(this.memoryStorage)),Hs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",(async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${vs}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach(((e,s)=>{t[s]=e}))}catch(i){}return s.searchParams.forEach(((e,s)=>{t[s]=e})),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),Hs()&&this.detectSessionInUrl&&"none"!==s){const{data:i,error:r}=await this._getSessionFromURL(t,s);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),function(e){return Ss(e)&&"AuthImplicitGrantRedirectError"===e.name}(r)){const t=null===(e=r.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:r}}return await this._removeSession(),{error:r}}const{session:a,redirectType:n}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",n),await this._saveSession(a),setTimeout((async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Ss(t)?{error:t}:{error:new Ts("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const r=await ci(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(i=null==e?void 0:e.options)||void 0===i?void 0:i.captchaToken}},xform:di}),{data:a,error:n}=r;if(n||!a)return{data:{user:null,session:null},error:n};const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(Ss(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,s,i;try{let r;if("email"in e){const{email:s,password:i,options:a}=e;let n=null,o=null;"pkce"===this.flowType&&([n,o]=await ri(this.storage,this.storageKey)),r=await ci(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==a?void 0:a.emailRedirectTo,body:{email:s,password:i,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:n,code_challenge_method:o},xform:di})}else{if(!("phone"in e))throw new Is("You must provide either an email or phone number and a password");{const{phone:t,password:a,options:n}=e;r=await ci(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:a,data:null!==(s=null==n?void 0:n.data)&&void 0!==s?s:{},channel:null!==(i=null==n?void 0:n.channel)&&void 0!==i?i:"sms",gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:di})}}const{data:a,error:n}=r;if(n||!a)return{data:{user:null,session:null},error:n};const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(Ss(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:i,options:r}=e;t=await ci(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:ui})}else{if(!("phone"in e))throw new Is("You must provide either an email or phone number and a password");{const{phone:s,password:i,options:r}=e;t=await ci(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},xform:ui})}}const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i}):{data:{user:null,session:null},error:new Ps}}catch(t){if(Ss(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,r;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(i=e.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:null===(r=e.options)||void 0===r?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(e)))}async _exchangeCodeForSession(e){const t=await Xs(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(null!=t?t:"").split("/");try{const{data:t,error:r}=await ci(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:di});if(await Zs(this.storage,`${this.storageKey}-code-verifier`),r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=i?i:null}),error:r}):{data:{user:null,session:null,redirectType:null},error:new Ps}}catch(r){if(Ss(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:r,nonce:a}=e,n=await ci(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:r,nonce:a,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:di}),{data:o,error:l}=n;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new Ps}}catch(t){if(Ss(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,r,a;try{if("email"in e){const{email:i,options:r}=e;let a=null,n=null;"pkce"===this.flowType&&([a,n]=await ri(this.storage,this.storageKey));const{error:o}=await ci(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:null!==(t=null==r?void 0:r.data)&&void 0!==t?t:{},create_user:null===(s=null==r?void 0:r.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},code_challenge:a,code_challenge_method:n},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:n,error:o}=await ci(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(i=null==s?void 0:s.data)&&void 0!==i?i:{},create_user:null===(r=null==s?void 0:s.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(a=null==s?void 0:s.channel)&&void 0!==a?a:"sms"}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o}}throw new Is("You must provide either an email or phone number.")}catch(n){if(Ss(n))return{data:{user:null,session:null},error:n};throw n}}async verifyOtp(e){var t,s;try{let i,r;"options"in e&&(i=null===(t=e.options)||void 0===t?void 0:t.redirectTo,r=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:a,error:n}=await ci(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:i,xform:di});if(n)throw n;if(!a)throw new Error("An error occurred on token verification.");const o=a.session,l=a.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(i){if(Ss(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{let r=null,a=null;return"pkce"===this.flowType&&([r,a]=await ri(this.storage,this.storageKey)),await ci(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(i=null==e?void 0:e.options)||void 0===i?void 0:i.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:a}),headers:this.headers,xform:mi})}catch(r){if(Ss(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new As;const{error:i}=await ci(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}}))}catch(e){if(Ss(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:r}=e,{error:a}=await ci(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}},redirectTo:null==r?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:s,type:i,options:r}=e,{data:a,error:n}=await ci(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:n}}throw new Is("You must provide either an email or phone number and a type")}catch(t){if(Ss(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,(async()=>this._useSession((async e=>e))))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Xs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<ys;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,i)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,i))})}return{data:{session:e},error:null}}const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,(async()=>await this._getUser()))}async _getUser(e){try{return e?await ci(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:hi}):await this._useSession((async e=>{var t,s,i;const{data:r,error:a}=e;if(a)throw a;return(null===(t=r.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await ci(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(i=null===(s=r.session)||void 0===s?void 0:s.access_token)&&void 0!==i?i:void 0,xform:hi}):{data:{user:null},error:new As}}))}catch(t){if(Ss(t))return function(e){return Ss(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await Zs(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(e,t)))}async _updateUser(e,t={}){try{return await this._useSession((async s=>{const{data:i,error:r}=s;if(r)throw r;if(!i.session)throw new As;const a=i.session;let n=null,o=null;"pkce"===this.flowType&&null!=e.email&&([n,o]=await ri(this.storage,this.storageKey));const{data:l,error:c}=await ci(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:n,code_challenge_method:o}),jwt:a.access_token,xform:hi});if(c)throw c;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}}))}catch(s){if(Ss(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(e)))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new As;const t=Date.now()/1e3;let s=t,i=!0,r=null;const{payload:a}=ti(e.access_token);if(a.exp&&(s=a.exp,i=s<=t),i){const{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};r=t}else{const{data:i,error:a}=await this._getUser(e.access_token);if(a)throw a;r={access_token:e.access_token,refresh_token:e.refresh_token,user:i.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(Ss(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(e)))}async _refreshSession(e){try{return await this._useSession((async t=>{var s;if(!e){const{data:i,error:r}=t;if(r)throw r;e=null!==(s=i.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new As;const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(Ss(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Hs())throw new Os("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Os(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Rs("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Os("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Rs("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const i=new URL(window.location.href);return i.searchParams.delete("code"),window.history.replaceState(window.history.state,"",i.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:r,refresh_token:a,expires_in:n,expires_at:o,token_type:l}=e;if(!(r&&n&&a&&l))throw new Os("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(n);let u=c+d;o&&(u=parseInt(o));const h=u-c;1e3*h<=bs&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const m=u-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,c);const{data:p,error:f}=await this._getUser(r);if(f)throw f;const g={provider_token:s,provider_refresh_token:i,access_token:r,expires_in:d,expires_at:u,refresh_token:a,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(s){if(Ss(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Xs(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(e)))}async _signOut({scope:e}={scope:"global"}){return await this._useSession((async t=>{var s;const{data:i,error:r}=t;if(r)return{error:r};const a=null===(s=i.session)||void 0===s?void 0:s.access_token;if(a){const{error:t}=await this.admin.signOut(a,e);if(t&&(!function(e){return Ss(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await Zs(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(t)}))})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession((async t=>{var s,i;try{const{data:{session:i},error:r}=t;if(r)throw r;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(r){await(null===(i=this.stateChangeEmitters.get(e))||void 0===i?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}}))}async resetPasswordForEmail(e,t={}){let s=null,i=null;"pkce"===this.flowType&&([s,i]=await ri(this.storage,this.storageKey,!0));try{return await ci(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(Ss(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Ss(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession((async t=>{var s,i,r,a,n;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(i=e.options)||void 0===i?void 0:i.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:!0});return await ci(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(n=null===(a=o.session)||void 0===a?void 0:a.access_token)&&void 0!==n?n:void 0})}));if(i)throw i;return Hs()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(Ss(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession((async t=>{var s,i;const{data:r,error:a}=t;if(a)throw a;return await ci(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(i=null===(s=r.session)||void 0===s?void 0:s.access_token)&&void 0!==i?i:void 0})}))}catch(t){if(Ss(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise((t=>{setTimeout((()=>t(null)),e)}))}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await ci(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:di})),i=(e,t)=>{const s=200*Math.pow(2,e);return t&&Ls(t)&&Date.now()+s-r<bs},new Promise(((e,t)=>{(async()=>{for(let a=0;a<1/0;a++)try{const t=await s(a);if(!i(a,null,t))return void e(t)}catch(r){if(!i(a,r))return void t(r)}})()})))}catch(r){if(this._debug(t,"error",r),Ss(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}var s,i}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Hs()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Xs(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s))return this._debug(t,"session is not valid"),void(null!==s&&await this._removeSession());const i=1e3*(null!==(e=s.expires_at)&&void 0!==e?e:1/0)-Date.now()<ys;if(this._debug(t,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),Ls(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return this._debug(t,"error",s),void console.error(s)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new As;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new ei;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new As;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const i={session:t.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(r){if(this._debug(i,"error",r),Ss(r)){const e={session:null,error:r};return Ls(r)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(r),r}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],r=Array.from(this.stateChangeEmitters.values()).map((async s=>{try{await s.callback(e,t)}catch(r){i.push(r)}}));if(await Promise.all(r),i.length>0){for(let e=0;e<i.length;e+=1)console.error(i[e]);throw i[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ys(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Zs(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Hs()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),bs);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const t=Date.now();try{return await this._useSession((async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const i=Math.floor((1e3*s.expires_at-t)/bs);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),i<=3&&await this._callRefreshToken(s.refresh_token)}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof yi))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Hs()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await ri(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});i.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);i.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession((async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await ci(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(Ss(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession((async t=>{var s,i;const{data:r,error:a}=t;if(a)return{data:null,error:a};const n=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await ci(this.fetch,"POST",`${this.url}/factors`,{body:n,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(i=null==o?void 0:o.totp)||void 0===i?void 0:i.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}))}catch(t){if(Ss(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:i,error:r}=t;if(r)return{data:null,error:r};const{data:a,error:n}=await ci(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token});return n?{data:null,error:n}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:n})}))}catch(t){if(Ss(t))return{data:null,error:t};throw t}}))}async _challenge(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:i,error:r}=t;return r?{data:null,error:r}:await ci(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(Ss(t))return{data:null,error:t};throw t}}))}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],i=s.filter((e=>"totp"===e.factor_type&&"verified"===e.status)),r=s.filter((e=>"phone"===e.factor_type&&"verified"===e.status));return{data:{all:s,totp:i,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async e=>{var t,s;const{data:{session:i},error:r}=e;if(r)return{data:null,error:r};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=ti(i.access_token);let n=null;a.aal&&(n=a.aal);let o=n;(null!==(s=null===(t=i.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==s?s:[]).length>0&&(o="aal2");return{data:{currentLevel:n,nextLevel:o,currentAuthenticationMethods:a.amr||[]},error:null}}))))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find((t=>t.kid===e));if(s)return s;if(s=this.jwks.keys.find((t=>t.kid===e)),s&&this.jwks_cached_at+6e5>Date.now())return s;const{data:i,error:r}=await ci(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(r)throw r;if(!i.keys||0===i.keys.length)throw new Ds("JWKS is empty");if(this.jwks=i,this.jwks_cached_at=Date.now(),s=i.keys.find((t=>t.kid===e)),!s)throw new Ds("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:i,payload:r,signature:a,raw:{header:n,payload:o}}=ti(s);if(function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(r.exp),!i.kid||"HS256"===i.alg||!("crypto"in globalThis)||!("subtle"in globalThis.crypto)){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:r,header:i,signature:a},error:null}}const l=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(i.alg),c=await this.fetchJwk(i.kid,t),d=await crypto.subtle.importKey("jwk",c,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,d,a,Vs(`${n}.${o}`))))throw new Ds("Invalid JWT signature");return{data:{claims:r,header:i,signature:a},error:null}}catch(s){if(Ss(s))return{data:null,error:s};throw s}}}ki.nextInstanceID=0;const Si=ki;class Ci extends Si{constructor(e){super(e)}}var Ti=function(e,t,s,i){return new(s||(s=Promise))((function(r,a){function n(e){try{l(i.next(e))}catch(t){a(t)}}function o(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))};class Ei{constructor(e,t,s){var i,r,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const n=(o=e).endsWith("/")?o:o+"/";var o;const l=new URL(n);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d=function(e,t){var s,i;const{db:r,auth:a,realtime:n,global:o}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},l),r),auth:Object.assign(Object.assign({},c),a),realtime:Object.assign(Object.assign({},d),n),global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},null!==(s=null==u?void 0:u.headers)&&void 0!==s?s:{}),null!==(i=null==o?void 0:o.headers)&&void 0!==i?i:{})}),accessToken:()=>xs(this,void 0,void 0,(function*(){return""}))};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:hs,realtime:ps,auth:Object.assign(Object.assign({},ms),{storageKey:c}),global:us});this.storageKey=null!==(i=d.auth.storageKey)&&void 0!==i?i:"",this.headers=null!==(r=d.global.headers)&&void 0!==r?r:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(a=d.auth)&&void 0!==a?a:{},this.headers,d.global.fetch),this.fetch=gs(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Ye(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new le(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new cs(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ti(this,void 0,void 0,(function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:r,flowType:a,lock:n,debug:o},l,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ci({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),l),storageKey:r,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:a,lock:n,debug:o,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new qt(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}const Ai=new Ei("https://lqxfjjtjxktjgpekugtf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxeGZqanRqeGt0amdwZWt1Z3RmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3OTgyMDMsImV4cCI6MjA2MzM3NDIwM30.-E66kbBxRAVcJcPdhhUJWq5BZB-2GRpiBEaGtiWLVrA",Pi);var Pi;const Ii=({onClose:s,mode:i})=>{const[r,a]=J.useState("signup"!==i),[n,o]=J.useState(""),[l,c]=J.useState(""),[d,u]=J.useState(""),[h,m]=J.useState(null),[p,f]=J.useState(!1),g=V();J.useEffect((()=>{"signup"===i&&a(!1),"login"===i&&a(!0)}),[i]);return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative bg-gradient-to-br from-[#1a2942] to-[#234876] rounded-2xl p-8 w-full max-w-md mx-4 shadow-2xl border border-[#c5a572]/20",children:[e.jsx("button",{onClick:s,className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors",children:e.jsx(t,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:r?"Connexion":"Inscription"}),e.jsx("p",{className:"text-gray-300",children:r?"Bienvenue ! Connectez-vous à votre compte.":"Créez votre compte Francis"})]}),h&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-500 text-sm",children:h}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),m(null),f(!0);try{if(!r&&l!==d)throw new Error("Les mots de passe ne correspondent pas");if(r){const{data:e,error:t}=await Ai.auth.signInWithPassword({email:n,password:l});if(t)throw t;e.user&&(g("/dashboard"),s())}else{const{data:e,error:t}=await Ai.auth.signUp({email:n,password:l});if(t)throw t;e.user&&(g("/dashboard"),s())}}catch(t){m(t.message)}finally{f(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-1",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:n,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 bg-[#1a2942]/50 border border-[#c5a572]/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-[#c5a572] focus:ring-1 focus:ring-[#c5a572]",placeholder:"votre@email.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Mot de passe"}),e.jsx("input",{type:"password",id:"password",value:l,onChange:e=>c(e.target.value),className:"w-full px-4 py-2 bg-[#1a2942]/50 border border-[#c5a572]/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-[#c5a572] focus:ring-1 focus:ring-[#c5a572]",placeholder:"••••••••",required:!0})]}),!r&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300 mb-1",children:"Confirmer le mot de passe"}),e.jsx("input",{type:"password",id:"confirmPassword",value:d,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 bg-[#1a2942]/50 border border-[#c5a572]/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-[#c5a572] focus:ring-1 focus:ring-[#c5a572]",placeholder:"••••••••",required:!0})]}),e.jsx("button",{type:"submit",disabled:p,className:"w-full bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#1a2942] font-bold py-3 px-4 rounded-lg hover:shadow-lg hover:shadow-[#c5a572]/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Chargement...":r?"Se connecter":"S'inscrire"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>a(!r),className:"text-[#c5a572] hover:text-[#e8cfa0] transition-colors",children:r?"Pas encore de compte ? S'inscrire":"Déjà un compte ? Se connecter"})})]})]})};function Oi({onClose:l,onStart:c}){return e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(s.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"w-full max-w-4xl bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876] rounded-2xl p-8 border-2 border-[#c5a572]/30 relative shadow-2xl shadow-[#c5a572]/10",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors",children:e.jsx(t,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(i,{className:"h-8 w-8 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(r,{className:"h-6 w-6 text-[#c5a572] absolute -bottom-2 -right-2 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Francis"}),e.jsx("p",{className:"text-sm text-[#c5a572]",children:"Assistant fiscal IA"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"})]})]}),e.jsx("div",{className:"bg-[#1a2942]/80 backdrop-blur-sm rounded-lg p-6 mb-4 max-h-[60vh] overflow-y-auto custom-scrollbar border border-[#c5a572]/20",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex gap-4",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(i,{className:"h-7 w-7 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(r,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-lg mb-2",children:"Salut Paul ! On optimise ton impôt sur le revenu 2025 ? Dis-moi si j'ai bon :"}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 space-y-2 border border-[#c5a572]/20",children:[e.jsx("p",{className:"text-[#c5a572] font-medium",children:"• Revenu net imposable 2024 : 50 000 €"}),e.jsx("p",{className:"text-[#c5a572] font-medium",children:"• Tu es marié, avec 1 enfant à charge"}),e.jsx("p",{className:"text-[#c5a572] font-medium",children:"• Tu veux payer moins d'impôt et préparer ta retraite"})]}),e.jsx("p",{className:"text-white text-lg mt-2",children:"C'est bien ça ?"})]})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center flex-shrink-0 border border-blue-500/30",children:e.jsx(a,{className:"w-5 h-5 text-blue-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-white text-lg",children:"Oui, c'est ça !"})})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:1},className:"flex gap-4",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(i,{className:"h-7 w-7 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(r,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-lg mb-2",children:"Top ! Voici 3 leviers efficaces pour ton profil 👇"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-[#c5a572]/20",children:[e.jsx("p",{className:"text-[#c5a572] font-medium mb-1",children:"1. Plan Épargne Retraite (PER)"}),e.jsx("p",{children:"💡 Tu peux verser jusqu'à 5 000 € en 2025 (c'est ton plafond déductible)."}),e.jsx("p",{children:"📉 Ce montant est retiré de ton revenu imposable → il passe de 50 000 € à 45 000 €"}),e.jsx("p",{children:"📊 Résultat : 550 € d'impôt en moins"})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-[#c5a572]/20",children:[e.jsx("p",{className:"text-[#c5a572] font-medium mb-1",children:"2. Location meublée (LMNP)"}),e.jsx("p",{children:"🏘️ Tu achètes un petit bien à louer meublé"}),e.jsx("p",{children:"🧾 En meublé réel, tu peux amortir le bien + charges"}),e.jsx("p",{children:"✅ Résultat : souvent 0 € d'impôt pendant plusieurs années sur les loyers"})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-[#c5a572]/20",children:[e.jsx("p",{className:"text-[#c5a572] font-medium mb-1",children:"3. Don à une association"}),e.jsx("p",{children:"❤️ Tu donnes 1 000 € à une ONG"}),e.jsx("p",{children:"💶 Tu récupères 660 € en crédit d'impôt"}),e.jsx("p",{className:"text-sm text-gray-300",children:"(ou 750 € si c'est une association d'aide aux plus démunis)"})]})]})]})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:1.5},className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center flex-shrink-0 border border-blue-500/30",children:e.jsx(a,{className:"w-5 h-5 text-blue-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-white text-lg",children:"Et si je mets seulement 3 000 € sur le PER ?"})})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:2},className:"flex gap-4",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(i,{className:"h-7 w-7 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(r,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-lg mb-2",children:"Alors ton économie tombe à 330 € (3 000 € × 11 %)"}),e.jsx("p",{children:"➕ Avec ton don de 1 000 €, ça fait 990 € d'impôt en moins"}),e.jsx("p",{children:"➕ Et si tu fais de la location meublée, tu peux carrément ne plus rien payer sur les loyers"})]})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:2.5},className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center flex-shrink-0 border border-blue-500/30",children:e.jsx(a,{className:"w-5 h-5 text-blue-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-white text-lg",children:"OK c'est clair. On continue ?"})})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:3},className:"flex gap-4",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(i,{className:"h-7 w-7 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(r,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("p",{className:"text-white text-lg mb-2",children:["Yes ! Crée ton compte, et je t'analyse tout ça à partir de tes vrais chiffres.",e.jsx("br",{}),"Tu auras un plan fiscal personnalisé, prêt à appliquer."]})})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(s.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:c,className:"px-8 py-4 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#1a2942] font-bold rounded-xl hover:shadow-lg hover:shadow-[#c5a572]/20 transition-all transform flex items-center gap-2 text-lg",children:[e.jsx(n,{className:"w-6 h-6"}),"Commencer gratuitement",e.jsx(o,{className:"w-6 h-6"})]})})]})})}const Ri={MONTHLY:{price:9.99,currency:"EUR",interval:"month",stripePriceId:"price_monthly",features:["Accès illimité à Francis 24/7","Analyse personnalisée de votre situation fiscale","Recommandations adaptées à votre profil","Suivi en temps réel de vos optimisations","Mises à jour quotidiennes de la fiscalité","Sans engagement - Annulez à tout moment"]},ANNUAL:{price:99.99,currency:"EUR",interval:"year",stripePriceId:"price_annual",features:["Accès illimité à Francis 24/7","Analyse personnalisée de votre situation fiscale","Recommandations adaptées à votre profil","Suivi en temps réel de vos optimisations","Mises à jour quotidiennes de la fiscalité","Sans engagement - Annulez à tout moment","Économisez 17% par rapport au tarif mensuel"]}};var $i={};class Li{constructor(){this.baseUrl=$i.REACT_APP_API_URL||"http://localhost:3000"}static getInstance(){return Li.instance||(Li.instance=new Li),Li.instance}async createCheckoutSession(e){try{const t=await fetch(`${this.baseUrl}/api/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:Ri[e].stripePriceId,successUrl:`${window.location.origin}/success`,cancelUrl:`${window.location.origin}/pricing`})});if(!t.ok)throw new Error("Erreur lors de la création de la session de paiement");const{url:s}=await t.json();return s}catch(t){throw console.error("Erreur Stripe:",t),t}}async createPortalSession(){try{const e=await fetch(`${this.baseUrl}/api/create-portal-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({returnUrl:`${window.location.origin}/account`})});if(!e.ok)throw new Error("Erreur lors de la création de la session du portail");const{url:t}=await e.json();return t}catch(e){throw console.error("Erreur Stripe:",e),e}}}function Ui(){const[t,u]=J.useState(!1),[h,m]=J.useState(!1);(()=>{const[e,t]=J.useState(!1),[s,i]=J.useState(null),r=Li.getInstance()})();const p={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,ease:"easeOut"}}},f={hidden:{opacity:0,scale:.9},visible:e=>({opacity:1,scale:1,transition:{delay:.2*e,duration:.5,ease:"easeOut"}})};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#162238] via-[#1E3253] to-[#234876] text-gray-100 font-sans antialiased",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 bg-[#162238]/95 backdrop-blur-lg border-b border-[#2A3F6C]/50 z-50 shadow-lg",children:e.jsxs("div",{className:"h-20 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(i,{className:"h-10 w-10 text-[#c5a572] transition-transform group-hover:scale-110 duration-300"}),e.jsx(r,{className:"h-7 w-7 text-[#c5a572] absolute -bottom-2 -right-2 bg-[#162238] rounded-full p-0.5 transition-transform group-hover:scale-110 duration-300"})]}),e.jsx("button",{onClick:()=>u("login"),className:"px-6 py-2.5 sm:px-8 sm:py-3 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-xl shadow-lg hover:shadow-[#c5a572]/30 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[#c5a572] focus:ring-offset-2 focus:ring-offset-[#162238] transition-all duration-300 text-sm sm:text-base",children:"Se connecter"})]})}),t&&e.jsx(Ii,{mode:t,onClose:()=>u(!1)}),h&&e.jsx(Oi,{onClose:()=>m(!1),onStart:()=>{m(!1),u("signup")}}),e.jsxs("section",{className:"min-h-screen flex flex-col items-center justify-center px-4 pt-32 pb-16 sm:pt-40 sm:pb-20 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-5",style:{backgroundImage:"radial-gradient(circle at 25% 25%, #c5a572 1px, transparent 1px), radial-gradient(circle at 75% 75%, #e8cfa0 1px, transparent 1px)",backgroundSize:"60px 60px"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#162238]/30 via-transparent to-[#234876]/20"}),e.jsxs("div",{className:"max-w-5xl mx-auto text-center relative z-10",children:[e.jsxs(s.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2,ease:"easeOut"},className:"mb-12",children:[e.jsxs(s.h1,{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-gray-100 via-gray-200 to-white mb-8 leading-tight",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.7},children:["Optimisez votre fiscalité avec ",e.jsxs("span",{className:"relative inline-block text-[#c5a572]",children:["Francis",e.jsx(s.span,{className:"absolute -bottom-2.5 left-0 w-full h-1.5 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] rounded-full",initial:{scaleX:0},animate:{scaleX:1},transition:{duration:.7,delay:.8,ease:"circOut"}})]})]}),e.jsx(s.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},className:"text-xl sm:text-2xl text-gray-300 max-w-3xl mx-auto leading-relaxed font-light",children:"L'intelligence artificielle qui vous fait économiser des milliers d'euros sur vos impôts, en toute légalité."})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.5,ease:"easeOut"},className:"flex flex-col sm:flex-row gap-6 justify-center mb-20",children:[e.jsxs(s.button,{onClick:()=>u("signup"),whileHover:{scale:1.03,boxShadow:"0px 12px 30px rgba(197, 165, 114, 0.4)"},whileTap:{scale:.98},className:"px-10 py-4 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-2xl shadow-xl transition-all duration-300 flex items-center justify-center gap-3 text-lg border-2 border-transparent hover:border-[#e8cfa0]/50",children:[e.jsx(n,{className:"w-6 h-6"}),"Commencer gratuitement",e.jsx(o,{className:"w-6 h-6 ml-1 opacity-80 group-hover:opacity-100 transition-opacity"})]}),e.jsxs(s.button,{whileHover:{scale:1.03,backgroundColor:"rgba(255, 255, 255, 0.15)"},onClick:()=>m(!0),className:"px-10 py-4 bg-white/5 text-gray-100 font-semibold rounded-2xl shadow-xl transition-all duration-300 flex items-center justify-center gap-3 text-lg border-2 border-white/20 hover:border-white/40 backdrop-blur-sm",children:["Voir la démo",e.jsx(o,{className:"w-6 h-6 ml-1 opacity-80 group-hover:opacity-100 transition-opacity"})]})]}),e.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.8,ease:"easeOut"},className:"flex flex-wrap justify-center items-center gap-x-8 gap-y-4 sm:gap-x-12 opacity-70",children:[{icon:l,text:"100% Sécurisé"},{icon:a,text:"+500 Utilisateurs"},{icon:c,text:"IA de pointe"}].map(((t,i)=>e.jsxs(s.div,{whileHover:{scale:1.05},className:"flex items-center space-x-3 text-gray-300",children:[e.jsx(t.icon,{className:"h-5 w-5 text-[#c5a572]"}),e.jsx("span",{className:"text-base font-medium",children:t.text})]},i)))})]})]}),e.jsx("section",{className:"py-16 sm:py-24 px-4 bg-[#1E3253]/30",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs(s.div,{variants:p,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"text-center mb-14 sm:mb-20",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-extrabold text-white mb-5 sm:mb-6 leading-tight shadow-text",children:"Comment ça marche ?"}),e.jsx("p",{className:"text-lg sm:text-xl text-gray-300 max-w-3xl mx-auto leading-relaxed",children:"Trois étapes simples pour optimiser votre fiscalité avec l'aide de Francis, votre expert IA."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 sm:gap-10 items-stretch",children:[{icon:a,title:"Créez votre compte et profil",description:"Inscrivez-vous rapidement et renseignez vos informations pour un accompagnement sur mesure."},{icon:i,title:"Discutez avec Francis",description:"Posez vos questions, obtenez des recommandations personnalisées et des plans d'action clairs."},{icon:d,title:"Mettez en place les conseils",description:"Passez à l'action facilement et suivez vos optimisations fiscales en temps réel."}].map(((t,i)=>e.jsxs(s.div,{custom:i,variants:f,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},className:"bg-gradient-to-br from-[#1A2942]/70 to-[#223C63]/70 rounded-2xl border border-[#2A3F6C]/60 p-8 flex flex-col items-center shadow-xl hover:shadow-2xl hover:border-[#c5a572]/50 transition-all duration-300 transform hover:-translate-y-1",children:[e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] flex items-center justify-center mb-6 sm:mb-8 shadow-lg border-4 border-[#162238]/50",children:e.jsx(t.icon,{className:"w-10 h-10 sm:w-12 sm:h-12 text-[#162238]"})}),e.jsx("h3",{className:"text-xl sm:text-2xl font-semibold text-white mb-3 text-center",children:t.title}),e.jsx("p",{className:"text-gray-300 text-base sm:text-lg text-center leading-relaxed",children:t.description})]},i)))})]})}),e.jsx("section",{className:"py-16 sm:py-24 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx(s.div,{variants:p,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"text-center mb-14 sm:mb-20",children:e.jsxs("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-extrabold text-white mb-5 sm:mb-6 leading-tight shadow-text",children:["Pourquoi choisir ",e.jsx("span",{className:"text-[#c5a572]",children:"Francis"})," ?"]})}),e.jsx(s.div,{variants:p,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"bg-gradient-to-br from-[#1A2942]/60 to-[#223C63]/60 shadow-xl rounded-2xl px-8 py-10 sm:px-12 sm:py-14 mx-auto max-w-4xl border border-[#2A3F6C]/60",children:e.jsxs("p",{className:"text-lg sm:text-xl text-gray-200 leading-relaxed text-center",children:["Chaque année, des millions de Français remplissent leur déclaration sans savoir qu'ils pourraient ",e.jsx("strong",{className:"font-semibold text-[#c5a572]",children:"payer moins"}),", en toute légalité.",e.jsx("br",{}),e.jsx("br",{}),"Pas par négligence, mais parce que ",e.jsx("strong",{className:"font-semibold text-white",children:"personne ne leur explique"}),". Ni l'administration. Ni les banques. Ni les simulateurs incomplets.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{className:"font-semibold text-[#c5a572]",children:"Francis change la donne."}),e.jsx("br",{}),"Nous avons créé une intelligence artificielle indépendante, conçue pour ",e.jsx("strong",{className:"font-semibold text-white",children:"vous défendre, vous guider, et vous faire économiser."})]})})]})}),e.jsx("section",{className:"py-16 sm:py-24 px-4 bg-[#1E3253]/30",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs(s.div,{variants:p,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"text-center mb-14 sm:mb-20",children:[e.jsxs("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-extrabold text-white mb-5 sm:mb-6 leading-tight shadow-text",children:["Une offre unique, des résultats ",e.jsx("span",{className:"text-[#c5a572]",children:"concrets"})]}),e.jsx("p",{className:"text-lg sm:text-xl text-gray-300 max-w-3xl mx-auto leading-relaxed",children:"Accédez à toutes les fonctionnalités pour optimiser votre fiscalité et prendre le contrôle de vos finances."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 sm:gap-10 items-stretch mb-12 sm:mb-16",children:[{title:"Offre Mensuelle",price:"9,99€",period:"par mois",features:["Accès illimité 24/7","Analyse personnalisée","Recommandations adaptées","Suivi en temps réel","Mises à jour quotidiennes","Sans engagement"],popular:!1,originalPrice:null},{title:"Offre Annuelle",price:"99,99€",period:"par an",features:["Tous les avantages mensuels","Économisez 17%","Support prioritaire","Accès anticipé aux nouveautés"],popular:!0,originalPrice:"119,88€"}].map(((t,i)=>e.jsxs(s.div,{custom:i,variants:f,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.2},className:`bg-gradient-to-br from-[#1A2942]/80 to-[#223C63]/80 rounded-2xl border ${t.popular?"border-[#c5a572]/80 shadow-2xl":"border-[#2A3F6C]/60 shadow-xl"} p-8 flex flex-col relative overflow-hidden hover:border-[#c5a572]/70 transition-all duration-300 transform hover:scale-[1.02]`,children:[t.popular&&e.jsx("div",{className:"absolute top-0 right-0 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] px-5 py-1.5 text-sm font-semibold tracking-wider uppercase transform rotate-45 translate-x-1/3 translate-y-1/3 origin-top-right shadow-md",children:"Populaire"}),e.jsx("h3",{className:"text-2xl sm:text-3xl font-bold mb-2 text-center "+(t.popular?"text-[#c5a572]":"text-white"),children:t.title}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("span",{className:"text-4xl sm:text-5xl font-extrabold "+(t.popular?"text-[#c5a572]":"text-white"),children:t.price}),e.jsx("span",{className:"text-base text-gray-400 ml-1",children:t.period}),t.originalPrice&&e.jsx("p",{className:"text-sm text-gray-500 line-through mt-1",children:t.originalPrice})]}),e.jsx("ul",{className:"space-y-3 mb-8 text-gray-300 flex-grow",children:t.features.map(((s,i)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(d,{className:"w-5 h-5 text-[#c5a572] mr-3 mt-1 flex-shrink-0 "+(t.popular?"text-[#c5a572]":"text-gray-400")}),e.jsx("span",{children:s})]},i)))}),e.jsx(s.button,{onClick:()=>u("signup"),whileHover:{scale:1.03,boxShadow:"0px 8px 20px "+(t.popular?"rgba(197, 165, 114, 0.3)":"rgba(197, 165, 114, 0.2)")},whileTap:{scale:.98},className:"w-full mt-auto px-8 py-3.5 font-semibold rounded-lg shadow-md transition-all duration-300 text-base sm:text-lg border-2 "+(t.popular?"bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] border-transparent hover:border-[#e8cfa0]/50":"bg-white/10 text-gray-100 border-transparent hover:bg-white/20 hover:border-white/30"),children:"Choisir cette offre"})]},i)))}),e.jsx(s.div,{variants:p,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"text-center text-gray-400 text-sm",children:"Paiement sécurisé. Annulation facile à tout moment."})]})}),e.jsx("section",{className:"py-16 sm:py-24 px-4",children:e.jsx("div",{className:"max-w-4xl mx-auto text-center",children:e.jsxs(s.div,{variants:p,initial:"hidden",whileInView:"visible",viewport:{once:!0,amount:.3},className:"bg-gradient-to-br from-[#c5a572]/90 to-[#e8cfa0]/90 rounded-2xl p-10 sm:p-16 shadow-2xl border border-[#c5a572]/50",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-extrabold text-[#162238] mb-6 sm:mb-8 leading-tight shadow-text-dark",children:"Prêt à optimiser votre fiscalité ?"}),e.jsx("p",{className:"text-lg sm:text-xl text-[#1E3253]/80 mb-8 sm:mb-10 max-w-2xl mx-auto leading-relaxed",children:"Rejoignez des centaines d'utilisateurs qui font déjà confiance à Francis pour gérer leurs finances intelligemment."}),e.jsxs(s.button,{onClick:()=>u("signup"),whileHover:{scale:1.03,boxShadow:"0px 10px 25px rgba(22, 34, 56, 0.3)"},whileTap:{scale:.98},className:"px-10 py-4 sm:px-12 sm:py-5 bg-[#162238] text-white font-semibold rounded-lg shadow-xl transition-all duration-300 flex items-center justify-center gap-3 text-base sm:text-lg mx-auto border-2 border-transparent hover:border-white/30",children:["Créer mon compte",e.jsx(o,{className:"w-5 h-5 sm:w-6 sm:h-6 opacity-80 group-hover:opacity-100 transition-opacity"})]})]})})}),e.jsx("footer",{className:"py-8 text-center",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["© ",(new Date).getFullYear()," Francis. Tous droits réservés."]})})]})}function Di(){const[t,i]=J.useState([]),[r,n]=J.useState(null),[o,l]=J.useState(!0),[d,x]=J.useState("all"),[v,b]=J.useState(!1);J.useEffect((()=>{y()}),[]);const y=async()=>{try{l(!0);const{data:{session:e}}=await Ai.auth.getSession();if(!(null==e?void 0:e.user))return;const{data:t}=await Ai.from("user_profiles").select("*").eq("user_id",e.user.id).single();if(t){n(t);const{data:s}=await Ai.from("user_profiles").select("\n            *,\n            users:user_id (email)\n          ").neq("user_id",e.user.id).eq("is_active",!0).limit(20);if(s){const e=w(t,s);i(e)}}}catch(e){console.error("Erreur lors du chargement des découvertes:",e)}finally{l(!1)}},w=(e,t)=>t.map((t=>{var s,i;const r=[];let a=0;t.situation_familiale===e.situation_familiale&&(r.push("Situation familiale similaire"),a+=25),t.localisation===e.localisation&&(r.push("Même région"),a+=20),t.secteur_activite===e.secteur_activite&&(r.push("Même secteur d'activité"),a+=15),t.regime_imposition===e.regime_imposition&&(r.push("Même régime d'imposition"),a+=20);const n=(null==(s=t.objectifs_financiers)?void 0:s.filter((t=>{var s;return null==(s=e.objectifs_financiers)?void 0:s.includes(t)})))||[];return n.length>0&&(r.push(`${n.length} objectif(s) commun(s)`),a+=10*n.length),{id:t.id,email:(null==(i=t.users)?void 0:i.email)||"Utilisateur anonyme",profile:t,similarityScore:a,matchingCriteria:r}})).filter((e=>e.similarityScore>10)).sort(((e,t)=>t.similarityScore-e.similarityScore)).slice(0,12),_=(e=>{switch(d){case"high-match":return e.filter((e=>e.similarityScore>=50));case"same-region":return e.filter((e=>e.matchingCriteria.some((e=>e.includes("région")))));case"same-sector":return e.filter((e=>e.matchingCriteria.some((e=>e.includes("secteur")))));default:return e}})(t),j=e=>e>=70?"Excellent match":e>=50?"Bon match":e>=30?"Match modéré":"Match faible";return o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-[#c5a572] text-lg",children:"Chargement des suggestions..."})}):e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gradient-to-br from-[#c5a572] to-[#e8cfa0]",children:e.jsx(c,{className:"w-6 h-6 text-[#162238]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-semibold text-white",children:"Découverte de Profils"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Connectez-vous avec des utilisateurs partageant des profils fiscaux similaires"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>b(!v),className:"flex items-center space-x-2 px-4 py-2 bg-[#1E3253]/60 border border-[#2A3F6C]/40 rounded-lg text-gray-300 hover:bg-[#1E3253]/80 transition-colors",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtres"})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[_.length," suggestion(s)"]})]})]}),v&&e.jsx(s.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"bg-[#1E3253]/40 rounded-lg p-4 border border-[#2A3F6C]/30",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:[{id:"all",label:"Tous"},{id:"high-match",label:"Correspondance élevée"},{id:"same-region",label:"Même région"},{id:"same-sector",label:"Même secteur"}].map((t=>e.jsx("button",{onClick:()=>x(t.id),className:"px-3 py-1.5 rounded-lg text-sm transition-colors "+(d===t.id?"bg-[#c5a572] text-[#162238] font-medium":"bg-[#101A2E]/50 text-gray-400 hover:text-gray-200"),children:t.label},t.id)))})}),_.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:_.map(((t,i)=>{return e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1*i},className:"bg-[#1E3253]/60 backdrop-blur-sm rounded-xl border border-[#2A3F6C]/40 p-6 hover:shadow-lg hover:shadow-[#c5a572]/10 transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] flex items-center justify-center text-[#162238] font-semibold text-lg",children:t.email.substring(0,1).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium",children:t.email.split("@")[0]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Membre depuis ",new Date(t.profile.created_at).getFullYear()]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold "+(r=t.similarityScore,r>=70?"text-green-400":r>=50?"text-yellow-400":r>=30?"text-orange-400":"text-gray-400"),children:[t.similarityScore,"%"]}),e.jsx("div",{className:"text-xs text-gray-400",children:j(t.similarityScore)})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[t.profile.localisation&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-300",children:[e.jsx(h,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:t.profile.localisation})]}),t.profile.secteur_activite&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-300",children:[e.jsx(m,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:t.profile.secteur_activite})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-300 mb-2",children:"Points communs :"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.matchingCriteria.slice(0,3).map(((t,s)=>e.jsx("span",{className:"inline-block px-2 py-1 bg-[#c5a572]/20 text-[#c5a572] text-xs rounded-full",children:t},s))),t.matchingCriteria.length>3&&e.jsxs("span",{className:"inline-block px-2 py-1 bg-gray-600/20 text-gray-400 text-xs rounded-full",children:["+",t.matchingCriteria.length-3]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center space-x-2 px-3 py-2 bg-[#c5a572]/20 text-[#c5a572] rounded-lg hover:bg-[#c5a572]/30 transition-colors text-sm",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:"Message"})]}),e.jsx("button",{className:"flex items-center justify-center px-3 py-2 bg-[#101A2E]/50 text-gray-400 rounded-lg hover:text-gray-200 transition-colors",children:e.jsx(f,{className:"w-4 h-4"})})]})]},t.id);var r}))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(a,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-300 mb-2",children:"Aucune suggestion trouvée"}),e.jsx("p",{className:"text-gray-500",children:"Complétez votre profil pour recevoir des suggestions personnalisées"})]}),t.length>0&&e.jsxs("div",{className:"bg-[#1E3253]/40 rounded-lg p-6 border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center space-x-2",children:[e.jsx(g,{className:"w-5 h-5 text-[#c5a572]"}),e.jsx("span",{children:"Statistiques de découverte"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[#c5a572]",children:t.filter((e=>e.similarityScore>=50)).length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Correspondances élevées"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-[#c5a572]",children:[Math.round(t.reduce(((e,t)=>e+t.similarityScore),0)/t.length)||0,"%"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Score moyen"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[#c5a572]",children:t.filter((e=>e.matchingCriteria.length>=3)).length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Profils très similaires"})]})]})]})]})}function Fi({onProfileUpdate:t,initialData:i={}}){const[r,a]=J.useState(0),[n,o]=J.useState(i),[l,c]=J.useState({profils_actifs:[],priorite_affichage:[],profils_mineurs:[],score_total:{dirigeant_IS:0,salarie:0,independant:0,investisseur_immobilier:0,expatrie:0,retraite:0},confiance_detection:0,variables_determinantes:[]}),[d,u]=J.useState([]),[h,p]=J.useState(!1),[f,g]=J.useState(!1),E=e=>{const t={dirigeant_IS:0,salarie:0,independant:0,investisseur_immobilier:0,expatrie:0,retraite:0},s=[];e.activite_principale&&((e.activite_principale.includes("dirigeant")||e.activite_principale.includes("gérant"))&&(t.dirigeant_IS+=40,s.push("Activité dirigeant déclarée")),(e.activite_principale.includes("salarié")||e.activite_principale.includes("CDI")||e.activite_principale.includes("CDD"))&&(t.salarie+=40,s.push("Statut salarié identifié")),(e.activite_principale.includes("auto-entrepreneur")||e.activite_principale.includes("indépendant")||e.activite_principale.includes("freelance"))&&(t.independant+=40,s.push("Activité indépendante confirmée")),(e.activite_principale.includes("retraite")||e.activite_principale.includes("retraité"))&&(t.retraite+=40,s.push("Statut retraité déclaré"))),e.statuts_juridiques&&e.statuts_juridiques.length>0&&((e.statuts_juridiques.includes("SASU")||e.statuts_juridiques.includes("SARL")||e.statuts_juridiques.includes("SAS"))&&(t.dirigeant_IS+=35,s.push(`Structure ${e.statuts_juridiques.join("/")} détectée`)),e.statuts_juridiques.includes("SCI")&&(t.investisseur_immobilier+=25,t.dirigeant_IS+=10,s.push("SCI dans le patrimoine")),(e.statuts_juridiques.includes("EURL")||e.statuts_juridiques.includes("EI"))&&(t.independant+=30,s.push("Structure unipersonnelle"))),e.ca_societe&&e.ca_societe>0&&(t.dirigeant_IS+=30,e.ca_societe>5e5&&(t.dirigeant_IS+=10,s.push("CA société significatif"))),e.revenu_brut_annuel&&e.revenu_brut_annuel>0&&(t.salarie+=30,e.revenu_brut_annuel>8e4&&(t.salarie+=5,s.push("Salaire cadre supérieur"))),e.ca_annuel&&e.ca_annuel>0&&(t.independant+=30,s.push("CA indépendant déclaré")),e.revenus_passifs&&e.revenus_passifs.length>0&&((e.revenus_passifs.includes("immobilier")||e.revenus_passifs.includes("LMNP")||e.revenus_passifs.includes("SCPI"))&&(t.investisseur_immobilier+=25,s.push("Revenus immobiliers confirmés")),e.revenus_passifs.includes("dividendes")&&(t.dirigeant_IS+=20,t.investisseur_immobilier+=10,s.push("Perception de dividendes")),e.revenus_passifs.includes("plus-values")&&(t.investisseur_immobilier+=15,t.dirigeant_IS+=10,s.push("Activité de plus-values"))),e.nb_biens&&e.nb_biens>0&&(t.investisseur_immobilier+=20,e.nb_biens>=3&&(t.investisseur_immobilier+=10,s.push(`Portefeuille ${e.nb_biens} biens`))),e.revenus_fonciers_bruts&&e.revenus_fonciers_bruts>0&&(t.investisseur_immobilier+=20,e.revenus_fonciers_bruts>5e4&&(t.investisseur_immobilier+=10,s.push("Revenus fonciers élevés"))),e.juridiction_fiscale&&"France"!==e.juridiction_fiscale&&(t.expatrie+=50,s.push(`Résidence fiscale ${e.juridiction_fiscale}`)),e.pays_residence&&"France"!==e.pays_residence&&(t.expatrie+=30,s.push(`Résidence ${e.pays_residence}`)),e.age&&(e.age>=62?(t.retraite+=25,e.pension_brute&&e.pension_brute>0&&(t.retraite+=15,s.push("Pension active confirmée"))):e.age>=50?(t.dirigeant_IS+=10,t.investisseur_immobilier+=15):e.age<=35&&(t.salarie+=10,t.independant+=5)),e.nb_salaries&&e.nb_salaries>0&&(t.dirigeant_IS+=15,s.push(`${e.nb_salaries} salariés dans l'entreprise`)),e.patrimoine_total_estime&&e.patrimoine_total_estime>1e6&&(t.investisseur_immobilier+=15,t.dirigeant_IS+=10,s.push("Patrimoine significatif"));[t.dirigeant_IS>20,t.salarie>20,t.independant>20,t.investisseur_immobilier>20].filter(Boolean).length>=2&&s.push("Profil multi-activités identifié");const i=Math.max(...Object.values(t));i>100&&Object.keys(t).forEach((e=>{t[e]=Math.min(100,t[e])}));const r=Object.entries(t).filter((([e,t])=>t>=25)).map((([e,t])=>e)).sort(((e,s)=>t[s]-t[e])),a=r.slice(0,1),n=r.slice(1).filter((e=>t[e]>=30)),o=i-(Object.values(t).sort(((e,t)=>t-e))[1]||0),l=Math.min(100,i/100*50+o/100*30+Math.min(5*s.length,20));return{profils_actifs:r,priorite_affichage:a,profils_mineurs:n,score_total:t,confiance_detection:Math.round(l),variables_determinantes:s}};J.useEffect((()=>{if(Object.keys(n).length>0){const e=E(n);c(e);const t=(e=>{const t=[];return e.confiance_detection<70&&t.push({id:"profil_base_renforcement",type:"fundamental",title:"Affinage du Profil Principal",description:"Questions ciblées pour confirmer votre profil fiscal",fields:[{id:"activite_principale_precise",label:"Décrivez précisément votre activité principale actuelle",type:"select",required:!0,options:["Dirigeant SASU/SARL (gérant majoritaire)","Dirigeant SASU/SARL (gérant minoritaire)","Salarié CDI (secteur privé)","Salarié CDI (secteur public/fonctionnaire)","Auto-entrepreneur/Micro-entreprise","Profession libérale (BNC)","Retraité avec pension principale","Expatrié travaillant à l'étranger","Investisseur immobilier à temps plein","Multi-activités (préciser en commentaire)"]},{id:"revenus_annuels_range",label:"Fourchette de revenus annuels totaux",type:"select",required:!0,options:["Moins de 30 000€","30 000€ - 50 000€","50 000€ - 80 000€","80 000€ - 120 000€","120 000€ - 200 000€","200 000€ - 500 000€","Plus de 500 000€"]},{id:"structures_juridiques_detenues",label:"Structures juridiques que vous détenez/dirigez",type:"checkbox",options:["SASU","SARL/EURL","SAS","SCI","Holding","Auto-entreprise","Profession libérale","Aucune structure propre"]}]}),"dirigeant_IS"===e.priorite_affichage[0]&&t.push({id:"dirigeant_ultra_profiling",type:"specialized",title:"Profil Dirigeant - Détection Ultra-Précise",description:"Caractérisation fine de votre situation de dirigeant",fields:[{id:"structure_juridique_precise",label:"Structure juridique exacte de votre société",type:"select",options:["SASU (président)","SARL gérant majoritaire","SARL gérant minoritaire","SAS président","EURL gérant","SNC gérant"]},{id:"capital_social_detenu",label:"Pourcentage du capital social détenu",type:"select",options:["Moins de 50%","50% à 66%","67% à 99%","100%"]},{id:"remuneration_vs_dividendes",label:"Répartition actuelle rémunération/dividendes",type:"select",options:["100% rémunération, 0% dividendes","80% rémunération, 20% dividendes","60% rémunération, 40% dividendes","40% rémunération, 60% dividendes","20% rémunération, 80% dividendes","0% rémunération, 100% dividendes"]},{id:"ca_societe_tranche",label:"Chiffre d'affaires annuel de la société",type:"select",options:["Moins de 100k€","100k€ - 250k€","250k€ - 500k€","500k€ - 1M€","1M€ - 2M€","Plus de 2M€"]},{id:"holding_structure_existante",label:"Structure holding",type:"boolean",sub_question:{condition:!0,fields:[{id:"holding_regime",label:"Régime fiscal de la holding",type:"select",options:["IS","IR/transparence"]}]}}]}),"investisseur_immobilier"===e.priorite_affichage[0]&&t.push({id:"investisseur_immobilier_profiling",type:"specialized",title:"Profil Investisseur Immobilier - Analyse Patrimoniale",description:"Caractérisation de votre stratégie immobilière",fields:[{id:"strategie_immobiliere_principale",label:"Stratégie immobilière principale",type:"select",options:["Locatif nu classique","LMNP/Location meublée","Mix nu + meublé","SCPI/Crowdfunding","Marchand de biens","Rénovation/Revente"]},{id:"nb_biens_detenus",label:"Nombre de biens immobiliers détenus",type:"select",options:["1 bien (+ résidence principale)","2-3 biens","4-6 biens","7-10 biens","Plus de 10 biens"]},{id:"revenus_fonciers_annuels",label:"Revenus fonciers bruts annuels",type:"select",options:["Moins de 15k€","15k€ - 30k€","30k€ - 60k€","60k€ - 100k€","Plus de 100k€"]},{id:"regime_fiscal_foncier",label:"Régime fiscal foncier actuel",type:"select",options:["Micro-foncier","Réel d'imposition","Mix micro/réel selon biens","LMNP micro","LMNP réel"]},{id:"ifi_concerne",label:"Concerné par l'IFI (patrimoine > 1,3M€)",type:"boolean"}]}),"salarie"===e.priorite_affichage[0]&&t.push({id:"salarie_profiling_avance",type:"specialized",title:"Profil Salarié - Optimisation Ciblée",description:"Caractérisation de votre situation salariale",fields:[{id:"statut_salarie_precis",label:"Statut salarié précis",type:"select",options:["Cadre secteur privé","Non-cadre secteur privé","Fonctionnaire titulaire","Fonctionnaire contractuel","Dirigeant assimilé salarié"]},{id:"tranche_revenus_salariaux",label:"Tranche de revenus salariaux bruts",type:"select",options:["Moins de 35k€","35k€ - 50k€","50k€ - 70k€","70k€ - 100k€","Plus de 100k€"]},{id:"epargne_salariale_disponible",label:"Dispositifs d'épargne salariale disponibles",type:"checkbox",options:["PEE (Plan Épargne Entreprise)","PERCO/PERECO","Intéressement","Participation","Abondement employeur","Aucun dispositif"]},{id:"autres_revenus_salarie",label:"Autres sources de revenus",type:"checkbox",options:["Revenus fonciers","Dividendes","Plus-values mobilières","BIC/BNC accessoires","Revenus étrangers","Uniquement salaires"]}]}),t})(e);u(t)}}),[n]);const A=(e,t)=>{o((s=>({...s,[e]:t})))},P=e=>({dirigeant_IS:m,salarie:S,independant:k,investisseur_immobilier:N,expatrie:j,retraite:_}[e]||S),I=e=>({dirigeant_IS:"Dirigeant IS",salarie:"Salarié",independant:"Indépendant",investisseur_immobilier:"Investisseur Immobilier",expatrie:"Expatrié",retraite:"Retraité"}[e]||e),O=t=>e.jsxs("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#2A3F6C]/30 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:t.title}),e.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("specialized"===t.type?"bg-purple-500/20 text-purple-300":"fundamental"===t.type?"bg-blue-500/20 text-blue-300":"bg-green-500/20 text-green-300"),children:"specialized"===t.type?"Spécialisé":"fundamental"===t.type?"Fondamental":"Standard"})]}),e.jsx("p",{className:"text-gray-300 mb-4",children:t.description}),e.jsx("div",{className:"space-y-4",children:t.fields.map((t=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:[t.label,t.required&&e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),"select"===t.type&&e.jsxs("select",{className:"w-full rounded-lg bg-[#162238]/80 border border-[#2A3F6C]/50 text-gray-200 focus:border-[#c5a572] focus:ring-2 focus:ring-[#c5a572]/50 p-3 text-sm",onChange:e=>A(t.id,e.target.value),required:t.required,children:[e.jsx("option",{value:"",children:"Sélectionnez..."}),t.options.map((t=>e.jsx("option",{value:t,children:t},t)))]}),"boolean"===t.type&&e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:t.id,value:"true",className:"w-4 h-4 text-[#c5a572] bg-[#162238] border-[#2A3F6C] focus:ring-[#c5a572]",onChange:()=>A(t.id,!0)}),e.jsx("span",{className:"text-sm text-gray-300",children:"Oui"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:t.id,value:"false",className:"w-4 h-4 text-[#c5a572] bg-[#162238] border-[#2A3F6C] focus:ring-[#c5a572]",onChange:()=>A(t.id,!1)}),e.jsx("span",{className:"text-sm text-gray-300",children:"Non"})]})]}),"checkbox"===t.type&&e.jsx("div",{className:"space-y-2",children:t.options.map((s=>e.jsxs("label",{className:"flex items-center space-x-3 text-sm text-gray-300 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-[#c5a572] bg-[#162238] border-[#2A3F6C] rounded focus:ring-[#c5a572]",onChange:e=>{const i=n[t.id]||[];e.target.checked?A(t.id,[...i,s]):A(t.id,i.filter((e=>e!==s)))}}),e.jsx("span",{children:s})]},s)))})]},t.id)))})]},t.id);return f?e.jsx("div",{className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-6 sm:p-8 shadow-xl",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx(x,{className:"w-20 h-20 text-[#c5a572] mx-auto animate-pulse"}),e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(v,{className:"w-8 h-8 text-[#e8cfa0] animate-spin"})})]}),e.jsx("h3",{className:"text-2xl font-semibold text-white mb-4",children:"Analyse ultra-précise de votre profil..."}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-400 max-w-lg mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-[#c5a572] rounded-full animate-pulse"}),e.jsx("span",{children:"Analyse des 47 variables fiscales collectées"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-[#c5a572] rounded-full animate-pulse delay-100"}),e.jsx("span",{children:"Scoring multi-profil sophistiqué"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-[#c5a572] rounded-full animate-pulse delay-200"}),e.jsx("span",{children:"Calcul de confiance et variables déterminantes"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-[#c5a572] rounded-full animate-pulse delay-300"}),e.jsx("span",{children:"Finalisation du profil fiscal"})]})]})]})}):h?e.jsxs("div",{className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-6 sm:p-8 shadow-xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(b,{className:"w-8 h-8 text-[#162238]"})}),e.jsx("h3",{className:"text-2xl font-semibold text-white mb-2",children:"Profil Fiscal Détecté avec Précision"}),e.jsx("p",{className:"text-gray-400",children:"Francis a analysé vos données et identifié votre profil"})]}),e.jsx("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#c5a572]/30 mb-6",children:l.priorite_affichage.map((t=>{const s=P(t),i=l.score_total[t];return e.jsxs("div",{className:"text-center",children:[e.jsx(s,{className:"w-12 h-12 text-[#c5a572] mx-auto mb-3"}),e.jsx("h4",{className:"text-xl font-bold text-white mb-2",children:I(t)}),e.jsxs("div",{className:"text-3xl font-bold text-[#c5a572] mb-1",children:[i,"%"]}),e.jsx("div",{className:"text-sm text-gray-400 mb-4",children:"de compatibilité"}),e.jsxs("div",{className:"text-sm text-gray-300",children:["Confiance de détection : ",e.jsxs("span",{className:"text-[#c5a572] font-semibold",children:[l.confiance_detection,"%"]})]})]},t)}))}),e.jsxs("div",{className:"bg-[#101A2E]/50 p-4 rounded-lg border border-[#2A3F6C]/30 mb-6",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-300 mb-3",children:"Variables clés analysées :"}),e.jsx("div",{className:"space-y-2",children:l.variables_determinantes.map(((t,s)=>e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-400",children:[e.jsx(b,{className:"w-3 h-3 text-green-400"}),e.jsx("span",{children:t})]},s)))})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-6 py-3 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-lg shadow-lg hover:shadow-[#c5a572]/40 hover:scale-105 transition-all duration-300 mr-4",children:"Affiner le profil"}),e.jsx("button",{onClick:()=>{const e=E(n);t(n,e)},className:"px-6 py-3 bg-[#2A3F6C] text-white font-semibold rounded-lg border border-[#c5a572]/30 hover:bg-[#3A4F7C] transition-all duration-300",children:"Valider le profil"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#2A3F6C]/30 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(C,{className:"w-5 h-5 text-[#c5a572] mr-2"}),"Détection de Profil en Cours"]}),l.profils_actifs.length>0?e.jsxs("div",{className:"space-y-4",children:[l.priorite_affichage.map((t=>{const s=P(t),i=l.score_total[t];return e.jsx("div",{className:"bg-[#1E3253]/60 p-4 rounded-lg border border-[#c5a572]/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(s,{className:"w-6 h-6 text-[#c5a572]"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white",children:I(t)}),e.jsx("p",{className:"text-sm text-gray-300",children:"Profil principal détecté"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-[#c5a572] font-bold",children:[i,"%"]}),e.jsx("div",{className:"text-xs text-gray-400",children:"compatibilité"})]})]})},t)})),e.jsx("div",{className:"bg-[#162238]/60 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Confiance de détection"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-24 bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] h-2 rounded-full transition-all duration-300",style:{width:`${l.confiance_detection}%`}})}),e.jsxs("span",{className:"text-[#c5a572] font-semibold",children:[l.confiance_detection,"%"]})]})]})}),l.variables_determinantes.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-300",children:"Variables déterminantes :"}),e.jsx("div",{className:"space-y-1",children:l.variables_determinantes.slice(0,3).map(((t,s)=>e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-400",children:[e.jsx(b,{className:"w-3 h-3 text-green-400"}),e.jsx("span",{children:t})]},s)))})]}),l.profils_mineurs.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-300",children:"Profils secondaires :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.profils_mineurs.map((t=>{const s=P(t),i=l.score_total[t];return e.jsxs("div",{className:"flex items-center space-x-2 bg-[#162238]/60 px-3 py-1 rounded-full border border-[#2A3F6C]/40",children:[e.jsx(s,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:I(t)}),e.jsxs("span",{className:"text-xs text-[#c5a572]",children:[i,"%"]})]},t)}))})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(T,{className:"w-8 h-8 text-yellow-500 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-300",children:"Remplissez quelques informations pour démarrer la détection"})]})]}),e.jsx(y,{children:d.map(((t,i)=>e.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*i},children:O(t)},t.id)))}),d.length>0&&!h&&e.jsxs("div",{className:"text-center pt-6",children:[e.jsxs("button",{onClick:()=>{g(!0),setTimeout((()=>{const e=E(n);c(e),t(n,e),g(!1),p(!0)}),2e3)},disabled:l.confiance_detection<50,className:"px-8 py-4 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-lg shadow-lg hover:shadow-[#c5a572]/40 hover:scale-105 transition-all duration-300 flex items-center space-x-3 mx-auto disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(v,{className:"w-6 h-6"}),e.jsx("span",{children:"Finaliser la détection"}),e.jsx(w,{className:"w-5 h-5"})]}),l.confiance_detection<50&&e.jsx("p",{className:"text-sm text-yellow-500 mt-2",children:"Répondez à plus de questions pour améliorer la détection"})]})]})}function qi({onComplete:t}){var i;const[r,a]=J.useState(0),[n,l]=J.useState({}),c=[{id:"activite_principale",title:"Quelle est votre activité principale ?",type:"single-choice",icon:S,options:[{value:"salarie_cdi",label:"Salarié en CDI",trigger:["salarie"]},{value:"fonctionnaire",label:"Fonctionnaire",trigger:["salarie"]},{value:"dirigeant_sasu",label:"Dirigeant SASU",trigger:["dirigeant_IS"]},{value:"dirigeant_sarl",label:"Dirigeant SARL",trigger:["dirigeant_IS"]},{value:"autoentrepreneur",label:"Auto-entrepreneur",trigger:["independant"]},{value:"profession_liberale",label:"Profession libérale",trigger:["independant"]},{value:"retraite",label:"Retraité",trigger:["retraite"]},{value:"sans_activite",label:"Sans activité",trigger:[]}]},{id:"revenus_complementaires",title:"Avez-vous des revenus complémentaires ?",type:"multiple-choice",icon:g,options:[{value:"immobilier_locatif",label:"Immobilier locatif",trigger:["investisseur_immobilier"]},{value:"dividendes",label:"Dividendes",trigger:["dirigeant_IS"]},{value:"plus_values",label:"Plus-values mobilières",trigger:["investisseur"]},{value:"crypto",label:"Cryptomonnaies",trigger:["investisseur"]},{value:"scpi",label:"SCPI",trigger:["investisseur_immobilier"]},{value:"lmnp",label:"Location meublée (LMNP)",trigger:["investisseur_immobilier"]},{value:"aucun",label:"Aucun revenu complémentaire",trigger:[]}]},{id:"statuts_juridiques",title:"Détenez-vous des structures juridiques ?",type:"multiple-choice",icon:m,options:[{value:"SASU",label:"SASU",trigger:["dirigeant_IS"]},{value:"SARL",label:"SARL",trigger:["dirigeant_IS"]},{value:"SCI",label:"SCI",trigger:["investisseur_immobilier"]},{value:"holding",label:"Holding",trigger:["dirigeant_IS"]},{value:"EURL",label:"EURL",trigger:["independant"]},{value:"aucune",label:"Aucune structure",trigger:[]}]},{id:"residence_fiscale",title:"Où résidez-vous fiscalement ?",type:"single-choice",icon:j,options:[{value:"france",label:"France métropolitaine",trigger:[]},{value:"dom_tom",label:"DOM-TOM",trigger:["expatrie"]},{value:"portugal",label:"Portugal",trigger:["expatrie"]},{value:"belgique",label:"Belgique",trigger:["expatrie"]},{value:"suisse",label:"Suisse",trigger:["expatrie"]},{value:"luxembourg",label:"Luxembourg",trigger:["expatrie"]},{value:"autre_ue",label:"Autre UE",trigger:["expatrie"]},{value:"hors_ue",label:"Hors UE",trigger:["expatrie"]}]},{id:"patrimoine_situation",title:"Quelle est votre situation patrimoniale ?",type:"single-choice",icon:N,options:[{value:"primo_accedant",label:"Primo-accédant",trigger:[]},{value:"proprietaire_rp",label:"Propriétaire résidence principale",trigger:[]},{value:"multi_proprietaire",label:"Multi-propriétaire",trigger:["investisseur_immobilier"]},{value:"patrimoine_important",label:"Patrimoine > 1M€",trigger:["investisseur_immobilier"]},{value:"ifi_concerne",label:"Concerné par l'IFI",trigger:["investisseur_immobilier"]},{value:"locataire",label:"Locataire",trigger:[]}]}],d=c[r],u=e=>{const s={...n,[d.id]:e};if(l(s),r<c.length-1)setTimeout((()=>a(r+1)),300);else{const e=h(s);t(e)}},h=e=>{var t,s,i;const r={...e};return e.activite_principale&&e.activite_principale.includes("dirigeant")&&(r.statuts_juridiques=r.statuts_juridiques||[],e.activite_principale.includes("sasu")?r.statuts_juridiques.push("SASU"):e.activite_principale.includes("sarl")&&r.statuts_juridiques.push("SARL")),e.residence_fiscale&&"france"!==e.residence_fiscale&&(r.pays_residence=e.residence_fiscale),((null==(t=e.patrimoine_situation)?void 0:t.includes("multi"))||(null==(s=e.patrimoine_situation)?void 0:s.includes("ifi"))||(null==(i=e.revenus_complementaires)?void 0:i.includes("immobilier")))&&(r.patrimoine_immobilier=!0),r},p=d.icon;return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:["Question ",r+1," sur ",c.length]}),e.jsxs("span",{className:"text-sm text-[#c5a572]",children:[Math.round((r+1)/c.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-[#162238] rounded-full h-2",children:e.jsx(s.div,{className:"bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] h-2 rounded-full",initial:{width:0},animate:{width:(r+1)/c.length*100+"%"},transition:{duration:.5}})})]}),e.jsxs(s.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-8 shadow-xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] rounded-full mb-4",children:e.jsx(p,{className:"w-8 h-8 text-[#162238]"})}),e.jsx("h2",{className:"text-2xl font-semibold text-white mb-2",children:d.title}),e.jsx("p",{className:"text-gray-400",children:"Cette information nous aide à personnaliser vos conseils fiscaux"})]}),e.jsx("div",{className:"space-y-3",children:d.options.map(((t,i)=>e.jsx(s.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*i},onClick:()=>{if("single-choice"===d.type)u(t.value);else{const e=n[d.id]||[];let s;s="aucun"===t.value||"aucune"===t.value?[t.value]:e.includes(t.value)?e.filter((e=>e!==t.value&&"aucun"!==e&&"aucune"!==e)):[...e.filter((e=>"aucun"!==e&&"aucune"!==e)),t.value],l((e=>({...e,[d.id]:s})))}},className:"w-full p-4 text-left rounded-lg border transition-all duration-200 hover:scale-[1.02] "+("multiple-choice"===d.type&&(n[d.id]||[]).includes(t.value)?"bg-[#c5a572]/20 border-[#c5a572] text-white":"bg-[#101A2E]/50 border-[#2A3F6C]/50 text-gray-300 hover:border-[#c5a572]/50 hover:bg-[#162238]/60"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:t.label}),"single-choice"===d.type&&e.jsx(o,{className:"w-5 h-5 text-[#c5a572] opacity-70"}),"multiple-choice"===d.type&&(n[d.id]||[]).includes(t.value)&&e.jsx("div",{className:"w-5 h-5 bg-[#c5a572] rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})},t.value)))}),"multiple-choice"===d.type&&(null==(i=n[d.id])?void 0:i.length)>0&&e.jsx(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 text-center",children:e.jsxs("button",{onClick:()=>u(n[d.id]),className:"px-6 py-3 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-lg shadow-lg hover:shadow-[#c5a572]/40 hover:scale-105 transition-all duration-300 flex items-center space-x-2 mx-auto",children:[e.jsx("span",{children:"Continuer"}),e.jsx(o,{className:"w-5 h-5"})]})})]},r),r>0&&e.jsx(s.button,{initial:{opacity:0},animate:{opacity:1},onClick:()=>a(r-1),className:"mt-4 text-gray-400 hover:text-white transition-colors text-sm flex items-center",children:"← Question précédente"})]})}function Mi({detectedProfile:t,profileData:i}){const r=e=>({dirigeant_IS:m,salarie:S,independant:k,investisseur_immobilier:N,expatrie:j,retraite:_}[e]||S),a=e=>({dirigeant_IS:"Dirigeant IS",salarie:"Salarié",independant:"Indépendant",investisseur_immobilier:"Investisseur Immobilier",expatrie:"Expatrié",retraite:"Retraité"}[e]||e),n=t.priorite_affichage[0],o=r(n);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#1E3253] to-[#2A3F6C] p-6 rounded-xl border border-[#c5a572]/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] rounded-lg",children:e.jsx(o,{className:"w-8 h-8 text-[#162238]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:a(n)}),e.jsx("p",{className:"text-[#c5a572]",children:"Profil fiscal principal détecté"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-3xl font-bold text-[#c5a572]",children:[t.score_total[n],"%"]}),e.jsx("p",{className:"text-sm text-gray-300",children:"compatibilité"})]})]}),e.jsx("div",{className:"bg-[#101A2E]/50 p-4 rounded-lg",children:e.jsx("p",{className:"text-gray-300 text-sm",children:(l=n,{dirigeant_IS:"Dirigeant de société soumise à l'impôt sur les sociétés (SASU, SARL, SAS)",salarie:"Salarié en CDI/CDD ou fonctionnaire avec revenus d'activité",independant:"Travailleur indépendant, auto-entrepreneur ou profession libérale",investisseur_immobilier:"Investisseur avec patrimoine immobilier locatif significatif",expatrie:"Résident fiscal à l'étranger avec revenus de source française",retraite:"Retraité percevant une pension principale ou des revenus de retraite"}[l]||"")})})]}),e.jsxs("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"font-semibold text-white mb-4 flex items-center",children:[e.jsx(x,{className:"w-5 h-5 text-[#c5a572] mr-2"}),"Analyse de Profil"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"Confiance de détection"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-32 bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] h-3 rounded-full transition-all duration-300",style:{width:`${t.confiance_detection}%`}})}),e.jsxs("span",{className:"text-[#c5a572] font-bold",children:[t.confiance_detection,"%"]})]})]}),t.variables_determinantes.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-300 mb-2",children:"Variables clés identifiées :"}),e.jsx("div",{className:"space-y-1",children:t.variables_determinantes.map(((t,s)=>e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-400",children:[e.jsx(b,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{children:t})]},s)))})]})]})]}),t.profils_mineurs.length>0&&e.jsxs("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#2A3F6C]/30",children:[e.jsx("h4",{className:"font-semibold text-white mb-4",children:"Profils secondaires détectés"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.profils_mineurs.map((s=>{const i=r(s),n=t.score_total[s];return e.jsxs("div",{className:"flex items-center space-x-3 bg-[#162238]/60 p-3 rounded-lg",children:[e.jsx(i,{className:"w-6 h-6 text-[#c5a572]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-200",children:a(s)}),e.jsxs("div",{className:"text-sm text-gray-400",children:[n,"% compatibilité"]})]})]},s)}))})]}),e.jsxs("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"font-semibold text-white mb-4 flex items-center",children:[e.jsx(g,{className:"w-5 h-5 text-[#c5a572] mr-2"}),"Caractéristiques de votre profil"]}),e.jsx("div",{className:"space-y-3",children:(e=>({dirigeant_IS:["Optimisation rémunération/dividendes","Charges sociales dirigeant","Impôt sur les sociétés","Arbitrage fiscal complexe","Transmission d'entreprise"],salarie:["Tranche marginale d'imposition","Épargne salariale disponible","PER et optimisation retraite","Frais professionnels","Revenus complémentaires"],independant:["Régime fiscal BIC/BNC","Charges sociales TNS","Déductions professionnelles","Épargne retraite Madelin","Optimisation statut juridique"],investisseur_immobilier:["Revenus fonciers et déficits","Régimes micro/réel","Exposition IFI potentielle","SCI et optimisation","Stratégie patrimoniale"],expatrie:["Conventions fiscales internationales","Revenus de source française","Exit tax et plus-values","Retour fiscal en France","Double imposition"],retraite:["Optimisation pensions","Abattements seniors","Transmission patrimoine","Revenus complémentaires","IFI si applicable"]}[e]||[]))(n).map(((t,i)=>e.jsxs(s.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*i},className:"flex items-start space-x-3 p-3 bg-[#162238]/40 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-[#c5a572] rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{className:"text-gray-200 text-sm",children:t})]},i)))})]}),e.jsxs("div",{className:"bg-[#101A2E]/50 p-6 rounded-lg border border-[#2A3F6C]/30",children:[e.jsxs("h4",{className:"font-semibold text-white mb-4 flex items-center",children:[e.jsx(E,{className:"w-5 h-5 text-[#c5a572] mr-2"}),"Données de profil analysées"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:Object.entries(i).map((([t,s])=>!s||Array.isArray(s)&&0===s.length?null:e.jsxs("div",{className:"flex justify-between items-center p-2 bg-[#162238]/40 rounded",children:[e.jsx("span",{className:"text-gray-400 capitalize",children:t.replace(/_/g," ")}),e.jsx("span",{className:"text-gray-200 font-medium",children:Array.isArray(s)?s.join(", "):String(s)})]},t)))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-[#c5a572]/20 to-[#e8cfa0]/20 p-6 rounded-xl border border-[#c5a572]/30",children:[e.jsxs("h4",{className:"text-xl font-semibold text-white mb-3 flex items-center",children:[e.jsx(T,{className:"w-6 h-6 text-[#c5a572] mr-2"}),"Profil détecté avec succès !"]}),e.jsxs("p",{className:"text-gray-300 mb-4",children:["Francis a analysé vos données et identifié votre profil fiscal avec une confiance de ",t.confiance_detection,"%. Vous pouvez maintenant accéder aux stratégies d'optimisation personnalisées."]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[e.jsx("strong",{children:"Profil principal :"})," ",a(n)," (",t.score_total[n],"% de compatibilité)"]})]})]});var l}const zi={situation:"",revenus:"",patrimoine:"",objectifs:[],tolerance_risque:"",horizon_investissement:"",nombre_enfants:0,ages_enfants:"",type_revenus:[],autres_revenus:"",situation_professionnelle:"",statut_fiscal:"",regime_imposition:"",investissements_existants:[],projets_immobiliers:"",besoins_retraite:"",situation_familiale:"",localisation:"",zone_fiscale:"",secteur_activite:"",revenus_passifs:"",dettes:"",objectifs_financiers:[],contraintes_fiscales:[],composition_patrimoine:[],is_active:!1};function Bi(){var n;const[o,l]=J.useState(!0),[c,d]=J.useState(""),[u,h]=J.useState(!1),m=J.useRef(null),[p,f]=J.useState([{role:"assistant",content:"Bonjour ! Je suis Francis, votre assistant expert en fiscalité française, développé par Fiscal.ia. 🤖\n\nFort de ma connaissance approfondie des textes officiels (Code Général des Impôts, BOFIP), je suis à votre disposition pour :\n• Optimiser vos impôts et déclarations\n• Analyser vos documents fiscaux (avis d'imposition, etc.)\n• Répondre à toutes vos questions sur la fiscalité française\n\nComment puis-je vous aider aujourd'hui ? Vous pouvez me poser une question directement, ou choisir un parcours d'accompagnement si vous le souhaitez."}]),[x,v]=J.useState("chat"),[_,j]=J.useState(zi),[N,k]=J.useState(!1),[C,T]=J.useState(!1),[E,M]=J.useState(null),[z,B]=J.useState(null),[G,H]=J.useState("libre"),[K,W]=J.useState(null),[Q,Y]=J.useState(null),[X,Z]=J.useState(!1),[ee,te]=J.useState([]),[se,ie]=J.useState(null),[re,ae]=J.useState(!1),[ne,oe]=J.useState([]),[le,ce]=J.useState(!1),de=V();J.useEffect((()=>{var e;null==(e=m.current)||e.scrollIntoView({behavior:"smooth"})}),[p]);const ue=()=>{const e=["situation_familiale","nombre_enfants"],t=e.filter((e=>{const t=_[e];return"nombre_enfants"===e?null!=t:null!=t&&""!==t})).length;return 0===e.length?100:Math.round(t/e.length*100)};J.useEffect((()=>{(async()=>{const{data:{session:e}}=await Ai.auth.getSession();(null==e?void 0:e.user)?(W(e.user.id),Y(e.user.email||null),await he(e.user.id)):de("/")})()}),[de]);const he=async e=>{try{const{data:t,error:s}=await Ai.from("user_profiles").select("*").eq("user_id",e).single();if(s&&"PGRST116"!==s.code)throw s;if(t){j(t);const e=ue();k(e>80)}else j(zi),k(!1)}catch(t){console.error("Erreur lors du chargement du profil:",t),j(zi),k(!1)}},me=e=>({dirigeant_IS:"Dirigeant IS",salarie:"Salarié",independant:"Indépendant",investisseur_immobilier:"Investisseur Immobilier",expatrie:"Expatrié",retraite:"Retraité"}[e]||e),pe=async(e,t)=>{var s,i;e&&e.preventDefault();const r=t||c;if(!r.trim()||!K)return;h(!0);const a=r;t||d(""),f((e=>[...e,{role:"user",content:a}]));try{const e="",t=null==(i=null==(s=await Ai.auth.getSession())?void 0:s.data.session)?void 0:i.access_token,r=await fetch(`${e}/ask`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({question:a})});if(!r.ok){const e=await r.json().catch((()=>({detail:"Erreur inconnue du serveur"})));throw new Error(`Erreur ${r.status}: ${e.detail||r.statusText}`)}const n=await r.json();f((e=>[...e,{role:"assistant",content:n.answer}]))}catch(n){console.error("Erreur lors de la soumission de la question:",n),f((e=>[...e,{role:"assistant",content:n instanceof Error?`Désolé, une erreur est survenue : ${n.message}`:"Oups ! Je rencontre une difficulté technique. Veuillez réessayer."}]))}finally{h(!1)}},fe=async e=>{var t,s;if(!e)return;if(!K)return void f((e=>[...e,{role:"assistant",content:"Veuillez vous connecter pour uploader des documents."}]));ae(!0);const i={name:e.name,type:e.type,status:"processing"};oe((e=>[...e,i]));try{const i=new FormData;i.append("file",e);const r=null==(s=null==(t=await Ai.auth.getSession())?void 0:t.data.session)?void 0:s.access_token,a="",n=await fetch(`${a}/upload/document`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:i});if(!n.ok){const e=await n.json().catch((()=>({detail:"Erreur lors de l'upload"})));throw new Error(e.detail||`Erreur ${n.status}`)}const o=await n.json();oe((t=>t.map((t=>t.name===e.name?{...t,status:"success",data:o}:t)))),f((t=>[...t,{role:"assistant",content:o.message||`Document "${e.name}" traité avec succès.`}]))}catch(r){console.error("Erreur Upload:",r),oe((t=>t.map((t=>t.name===e.name?{...t,status:"error"}:t)))),f((e=>[...e,{role:"assistant",content:r instanceof Error?`Erreur d'upload: ${r.message}`:"Erreur inconnue lors de l'upload."}]))}finally{ae(!1)}};return e.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-[#101A2E] via-[#162238] to-[#1E3253] text-gray-200 font-sans",children:[e.jsx(y,{children:o&&e.jsxs(s.aside,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{duration:.3,ease:"easeInOut"},className:"w-72 bg-[#0D1523]/80 backdrop-blur-xl p-6 flex flex-col border-r border-[#2A3F6C]/20 shadow-2xl fixed inset-y-0 left-0 z-40",children:[e.jsx("div",{className:"flex items-center space-x-3.5 mb-10 px-2",children:e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(i,{className:"h-10 w-10 text-[#c5a572] transition-transform group-hover:scale-110 duration-300"}),e.jsx(r,{className:"h-7 w-7 text-[#c5a572] absolute -bottom-2 -right-2 bg-[#0D1523] rounded-full p-0.5 transition-transform group-hover:scale-110 duration-300"})]})}),e.jsx("nav",{className:"flex-grow space-y-1.5",children:[{id:"chat",label:"Chat avec Francis",icon:i},{id:"profile",label:"Mon Profil Fiscal",icon:A},{id:"discovery",label:"Découverte",icon:a},{id:"documents",label:"Mes Documents",icon:P},{id:"analytics",label:"Analyse & Rapports",icon:g},{id:"settings",label:"Paramètres",icon:I}].map((t=>e.jsxs("button",{onClick:()=>v(t.id),className:"w-full flex items-center space-x-3.5 px-3 py-3 rounded-lg transition-all duration-200 group hover:bg-[#c5a572]/15 focus:outline-none focus:ring-2 focus:ring-[#c5a572] focus:ring-offset-2 focus:ring-offset-[#0D1523] "+(x===t.id?"bg-[#c5a572]/20 text-[#e8cfa0] shadow-inner":"text-gray-400 hover:text-gray-100"),children:[e.jsx(t.icon,{className:"w-5 h-5 transition-colors duration-200 "+(x===t.id?"text-[#e8cfa0]":"text-gray-500 group-hover:text-[#c5a572]")}),e.jsx("span",{className:"font-medium text-sm",children:t.label})]},t.id)))}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-[#2A3F6C]/20",children:[Q&&e.jsxs("div",{className:"mb-3 p-3 bg-[#162238]/60 rounded-lg text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Connecté en tant que"}),e.jsx("p",{className:"text-sm font-medium text-gray-200 truncate",children:Q})]}),e.jsxs("button",{onClick:async()=>{await Ai.auth.signOut(),de("/")},className:"w-full flex items-center space-x-3.5 px-3 py-3 rounded-lg text-gray-400 hover:bg-red-600/15 hover:text-red-400 transition-colors duration-200 group focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-[#0D1523]",children:[e.jsx(O,{className:"w-5 h-5 text-gray-500 group-hover:text-red-400 transition-colors"}),e.jsx("span",{className:"font-medium text-sm",children:"Déconnexion"})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden transition-all duration-300 ease-easeInOut "+(o?"md:ml-72":"ml-0"),children:[e.jsxs("header",{className:"h-20 bg-[#162238]/80 backdrop-blur-xl flex items-center justify-between px-6 sm:px-8 border-b border-[#2A3F6C]/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>l(!o),className:"p-2.5 rounded-xl text-gray-400 hover:text-white hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-[#c5a572] transition-all duration-200 md:hidden",children:o?e.jsx(t,{className:"h-6 w-6"}):e.jsx(R,{className:"h-6 w-6"})}),!o&&e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx("img",{src:"/fiscalia-logo.svg",alt:"Fiscal.ia",className:"h-12 w-12 transition-transform group-hover:scale-110 duration-300"}),e.jsx("span",{className:"ml-3 text-2xl font-bold text-white",children:"Fiscal.ia"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 px-4 py-2 bg-[#1E3253]/50 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Francis en ligne"})]}),e.jsx($,{className:"h-5 w-5 text-gray-400 hover:text-[#c5a572] cursor-pointer transition-colors"}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] flex items-center justify-center text-[#162238] font-semibold text-sm shadow-lg border-2 border-[#162238]/20",children:Q?Q.substring(0,1).toUpperCase():"U"})]})]}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-[#101A2E] p-6 sm:p-8",children:e.jsxs(y,{mode:"wait",children:["chat"===x&&e.jsxs(s.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"h-full max-h-[calc(100vh-10rem)] flex flex-col bg-white/5 backdrop-blur-lg rounded-2xl shadow-2xl border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 scrollbar-thin scrollbar-thumb-[#2A3F6C]/70 scrollbar-track-transparent scrollbar-thumb-rounded-full",children:[p.map(((t,r)=>e.jsx(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.05*r},className:"flex "+("user"===t.role?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-[85%] sm:max-w-[70%] p-4 rounded-2xl shadow-lg text-sm leading-relaxed backdrop-blur-sm "+("user"===t.role?"bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] text-[#162238] rounded-br-md shadow-[#c5a572]/20":"bg-[#1E3253]/80 text-gray-100 rounded-bl-md border border-white/10"),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1.5",children:["assistant"===t.role&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(i,{className:"w-3.5 h-3.5 text-[#162238]"})}),e.jsx("span",{className:"text-xs font-semibold "+("user"===t.role?"text-[#162238]/90":"text-[#e8cfa0]"),children:"user"===t.role?Q||"Vous":"Francis"})]}),e.jsx("div",{className:"whitespace-pre-wrap break-words "+("user"===t.role?"text-[#162238]":"text-gray-200"),children:t.content})]})},r))),e.jsx("div",{ref:m})]}),!u&&p.length>2&&"assistant"===p[p.length-1].role&&e.jsx("div",{className:"px-4 sm:px-6 py-2.5 border-t border-[#2A3F6C]/20",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:["Comment optimiser ma déclaration d'impôts ?","Quelles sont les stratégies de défiscalisation pour 2024 ?","Je suis auto-entrepreneur, comment gérer ma TVA ?","Quels avantages fiscaux pour un investissement locatif Pinel ?"].slice(0,3).map(((t,s)=>e.jsx("button",{onClick:()=>pe(void 0,t),className:"px-3 py-1.5 bg-[#1E3253]/60 hover:bg-[#2A3F6C]/60 text-xs text-gray-300 hover:text-white rounded-full transition-colors shadow-sm",children:t},s)))})}),e.jsxs("div",{className:"p-4 sm:p-6 border-t border-white/10 bg-[#162238]/40 backdrop-blur-lg",children:[e.jsxs("form",{onSubmit:pe,className:"flex items-center space-x-3",children:[e.jsx("label",{htmlFor:"file-upload-chat",className:"p-3 rounded-xl text-gray-400 hover:text-[#c5a572] hover:bg-white/10 transition-all duration-200 cursor-pointer "+(u||re?"opacity-50 cursor-not-allowed":""),children:e.jsx(L,{className:"w-5 h-5"})}),e.jsx("input",{type:"file",id:"file-upload-chat",className:"hidden",accept:".pdf,.jpg,.jpeg,.png,.txt,.md",onChange:e=>fe(e.target.files?e.target.files[0]:void 0),disabled:u||re}),e.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Posez votre question à Francis...",className:"flex-1 rounded-xl bg-white/5 border border-white/20 text-gray-100 placeholder-gray-400 focus:border-[#c5a572] focus:ring-2 focus:ring-[#c5a572]/50 px-4 py-3 text-sm transition-all duration-200 shadow-inner backdrop-blur-sm",disabled:u||re}),e.jsx("button",{type:"submit",disabled:u||!c.trim()||re,className:"p-3 bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] text-[#162238] rounded-xl hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-transparent focus:ring-[#c5a572] transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:scale-100 shadow-lg hover:shadow-[#c5a572]/30",children:u?e.jsx(U,{className:"w-5 h-5 animate-spin"}):e.jsx(D,{className:"w-5 h-5"})})]}),re&&e.jsxs("div",{className:"text-xs text-center text-[#c5a572] pt-2",children:["Téléchargement de ",null==(n=ne.find((e=>"processing"===e.status)))?void 0:n.name,"..."]})]})]},"chat"),"home"===x&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("h2",{className:"text-3xl font-semibold text-white mb-8",children:"Tableau de Bord"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-[#1E3253]/50 backdrop-blur-sm rounded-xl border border-[#2A3F6C]/40 p-6 shadow-lg hover:shadow-[#c5a572]/10 transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gradient-to-br from-[#c5a572] to-[#e8cfa0]",children:e.jsx(A,{className:"w-6 h-6 text-[#162238]"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Profil Fiscal"})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Complétez votre profil pour des conseils plus précis."}),e.jsx("div",{className:"w-full bg-[#101A2E]/50 rounded-full h-2.5 mb-1",children:e.jsx("div",{className:"bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] h-2.5 rounded-full transition-all duration-500 ease-out",style:{width:`${ue()}%`}})}),e.jsxs("p",{className:"text-right text-xs text-[#c5a572]",children:[ue(),"% complet"]})]}),e.jsxs("div",{className:"bg-[#1E3253]/50 backdrop-blur-sm rounded-xl border border-[#2A3F6C]/40 p-6 shadow-lg hover:shadow-[#c5a572]/10 transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gradient-to-br from-[#c5a572] to-[#e8cfa0]",children:e.jsx(P,{className:"w-6 h-6 text-[#162238]"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Mes Documents"})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Gérez vos documents fiscaux uploadés."}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[ne.filter((e=>"success"===e.status)).length," ",e.jsx("span",{className:"text-base font-normal text-gray-400",children:"documents"})]})]})]})]},"home"),"discovery"===x&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("h2",{className:"text-3xl font-semibold text-white mb-6",children:"Découverte de Profils"}),e.jsx(Di,{})]},"discovery"),"documents"===x&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("h2",{className:"text-3xl font-semibold text-white mb-6",children:"Mes Documents"}),e.jsxs("div",{className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-6 sm:p-8 shadow-xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("label",{htmlFor:"doc-upload-main",className:"w-full flex flex-col items-center justify-center p-6 border-2 border-dashed border-[#2A3F6C]/50 rounded-lg cursor-pointer hover:border-[#c5a572]/70 hover:bg-[#162238]/30 transition-colors",children:[e.jsx(F,{className:"w-10 h-10 text-gray-400 mb-3"}),e.jsx("span",{className:"text-sm text-gray-300 font-medium",children:"Glissez-déposez vos fichiers ici ou cliquez pour parcourir"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"PDF, JPG, PNG, TXT, MD (max. 5MB)"}),e.jsx("input",{id:"doc-upload-main",type:"file",className:"hidden",onChange:e=>fe(e.target.files?e.target.files[0]:void 0)})]})}),re&&e.jsx("p",{className:"text-center text-[#c5a572] text-sm my-4",children:"Traitement du fichier en cours..."}),ne.length>0?e.jsx("ul",{className:"space-y-3",children:ne.map(((t,s)=>e.jsxs("li",{className:"flex items-center justify-between p-3 bg-[#101A2E]/70 rounded-lg border border-[#2A3F6C]/40",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:["success"===t.status&&e.jsx(b,{className:"w-5 h-5 text-green-500 flex-shrink-0"}),"error"===t.status&&e.jsx(q,{className:"w-5 h-5 text-red-500 flex-shrink-0"}),"processing"===t.status&&e.jsx(U,{className:"w-5 h-5 text-[#c5a572] animate-spin flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-200 truncate",title:t.name,children:t.name})]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full "+("success"===t.status?"bg-green-500/20 text-green-400":"error"===t.status?"bg-red-500/20 text-red-400":"bg-yellow-500/20 text-yellow-400"),children:t.status})]},s)))}):e.jsx("p",{className:"text-center text-gray-500 text-sm",children:"Aucun document uploadé pour le moment."})]})]},"documents"),"profile"===x&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("h2",{className:"text-3xl font-semibold text-white mb-6",children:"Mon Profil Fiscal Adaptatif"}),E?e.jsxs("div",{className:"space-y-6",children:[z&&e.jsx("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(b,{className:"w-6 h-6 text-green-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold",children:"Profil fiscal sauvegardé !"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[e.jsx("strong",{children:me(z.priorite_affichage[0])})," détecté avec ",z.confiance_detection,"% de confiance"]})]})]})}),C?e.jsx(qi,{onComplete:e=>{M(e),T(!1)}}):e.jsx(Fi,{initialData:E,onProfileUpdate:(e,t)=>{(async(e,t)=>{if(K)try{const s={situation_professionnelle:e.activite_principale||_.situation_professionnelle,situation_familiale:e.situation_familiale||_.situation_familiale,nombre_enfants:e.nb_enfants||_.nombre_enfants,secteur_activite:e.secteur_activite||_.secteur_activite,revenus:e.revenu_brut_annuel?`${e.revenu_brut_annuel}€/an`:e.ca_annuel?`${e.ca_annuel}€/an (CA)`:e.pension_brute?`${e.pension_brute}€/an (pension)`:_.revenus,type_revenus:[...e.revenus_passifs||[],...e.epargne_salariale||[],...e.autres_revenus_retraite||[]].filter(Boolean),statut_fiscal:t.priorite_affichage[0]||_.statut_fiscal,regime_imposition:e.regime_fiscal_societe||e.regime_fiscal_independant||_.regime_imposition,patrimoine:e.patrimoine_total_estime?`${e.patrimoine_total_estime}€`:_.patrimoine,investissements_existants:[...e.statuts_juridiques||[],...e.typologie_biens||[],...e.mode_detention||[]].filter(Boolean),revenus_passifs:e.revenus_fonciers_bruts?`${e.revenus_fonciers_bruts}€/an (foncier)`:e.dividendes_verses?`${e.dividendes_verses}€/an (dividendes)`:_.revenus_passifs,localisation:e.pays_residence||e.juridiction_fiscale||_.localisation,zone_fiscale:e.juridiction_fiscale||_.zone_fiscale,objectifs_financiers:e.objectifs_patrimoniaux||_.objectifs_financiers||[],interaction_history:[..._.interaction_history||[],{question:"Profil adaptatif détecté",response:`Profil principal: ${me(t.priorite_affichage[0])} (${t.score_total[t.priorite_affichage[0]]}% de compatibilité)`,timestamp:(new Date).toISOString(),insights:[{type:"profile_detection",value:JSON.stringify({detectedProfile:t,adaptiveData:e,variables_determinantes:t.variables_determinantes}),confidence:t.confiance_detection}]}]},{error:i}=await Ai.from("user_profiles").upsert({..._,...s,user_id:K,updated_at:(new Date).toISOString()});if(i)throw i;j((e=>({...e,...s}))),M(e),B(t),t.confiance_detection>=70&&k(!0),f((e=>[...e,{role:"assistant",content:`🎯 **Profil fiscal détecté et sauvegardé !**\n\n**Profil principal :** ${me(t.priorite_affichage[0])}\n**Confiance :** ${t.confiance_detection}%\n\nVotre profil fiscal a été automatiquement mis à jour. Je peux maintenant vous donner des conseils ultra-personnalisés !`}]))}catch(s){console.error("Erreur lors de la sauvegarde du profil adaptatif:",s),f((e=>[...e,{role:"assistant",content:"Erreur lors de la sauvegarde du profil détecté. Vos données sont temporairement conservées en mémoire."}]))}})(e,t),M(e),B(t)}}),z&&e.jsx(Mi,{detectedProfile:z,profileData:E||{}})]}):e.jsxs("div",{className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-6 sm:p-8 shadow-xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-[#c5a572] to-[#e8cfa0] rounded-full mb-6",children:e.jsx(S,{className:"w-10 h-10 text-[#162238]"})}),e.jsx("h3",{className:"text-2xl font-semibold text-white mb-3",children:"Francis va analyser votre profil"}),e.jsx("p",{className:"text-gray-300 max-w-2xl mx-auto",children:"Répondez à quelques questions rapides pour que Francis détecte automatiquement votre profil fiscal et vous propose des conseils ultra-personnalisés."})]}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:()=>{alert("🎯 BOUTON CLIQUÉ ! Si vous voyez cette alerte, le bouton fonctionne !"),console.log('🎯 DEBUG: Bouton "Commencer l\'analyse" cliqué !'),console.log("🎯 DEBUG: adaptiveProfileData:",E),console.log("🎯 DEBUG: showInitialQuestions avant:",C),T(!0),console.log("🎯 DEBUG: setShowInitialQuestions(true) appelé")},className:"px-8 py-4 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#162238] font-semibold rounded-lg shadow-lg hover:shadow-[#c5a572]/40 hover:scale-105 transition-all duration-300 flex items-center space-x-3 mx-auto",children:[e.jsx(S,{className:"w-6 h-6"}),e.jsx("span",{children:"Commencer l'analyse"}),e.jsx(w,{className:"w-5 h-5"})]})})]})]},"profile"),"analytics"===x&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("h2",{className:"text-3xl font-semibold text-white mb-6",children:"Analyse & Rapports"}),e.jsx("div",{className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-6 sm:p-8 shadow-xl",children:e.jsx("p",{className:"text-gray-300",children:"Les fonctionnalités d'analyse et de rapports seront disponibles ici prochainement."})})]},"analytics"),"settings"===x&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("h2",{className:"text-3xl font-semibold text-white mb-6",children:"Paramètres"}),e.jsx("div",{className:"bg-[#1E3253]/60 backdrop-blur-md rounded-xl border border-[#2A3F6C]/30 p-6 sm:p-8 shadow-xl",children:e.jsx("p",{className:"text-gray-300",children:"Options de configuration du compte et des préférences."})})]},"settings")]})})]})]})}function Ji({open:t,onClose:s}){return t?e.jsx("div",{style:{position:"fixed",zIndex:1e3,left:0,top:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.5)"},onClick:s,children:e.jsxs("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",background:"#1a2942",color:"#fff",borderRadius:12,maxWidth:600,width:"90vw",maxHeight:"90vh",overflowY:"auto",padding:24,fontSize:12,boxShadow:"0 8px 32px #0008"},onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:s,style:{position:"absolute",right:12,top:12,background:"none",border:"none",color:"#c5a572",fontWeight:"bold",fontSize:18,cursor:"pointer"},children:"×"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"inherit",fontSize:11,color:"#e8cfa0",marginTop:24},children:"MENTIONS LÉGALES ET CONDITIONS GÉNÉRALES D'UTILISATION (CGU)\n\nDERNIÈRE MISE À JOUR : 27 MAI 2025\n\nRésumé express\n• Vos données sont protégées, chiffrées, stockées selon les standards RGPD, jamais revendues et supprimables sur simple demande.\n• Abonnement clair, résiliable à tout moment, prix garanti à vie pour les 100 premiers inscrits.\n• Support humain et contact facile : fiscalia.group@gmail.com\n\n⸻\n\n1. Identification de l'Éditeur\n\nNom du site : Fiscal.IA\nÉditeur : FISCAL.IA SAS au capital de 100 €\n• SIREN : 943 531 152\n• SIRET : 943 531 152 00016\n• Siège social : 17 Chemin du Prieuré, 79260 La Crèche, France\n• Directeur de la publication : Monsieur Garcia Aitor\n\nHébergeur :\nNetlify, Inc.\n44 Montgomery Street, Suite 300, San Francisco, CA 94104, USA\nTél. : +1 415-691-1573\nEmail : support@netlify.com\n\nContact général : fiscalia.group@gmail.com\n\n⸻\n\n2. Définitions\n\nDans les présentes CGU, les termes suivants ont la signification ci-après :\n• « Site » : le portail accessible à l'URL https://www.fiscal.ia et ses sous-domaines.\n• « Utilisateur » : toute personne physique majeure accédant au Site.\n• « Données Utilisateur » : toutes informations collectées lors de l'utilisation du Site.\n• « Services » : l'ensemble des fonctionnalités proposées par Fiscal.IA, notamment l'assistant fiscal et financier.\n\n⸻\n\n3. Objet\n\nLe présent document définit les modalités et conditions dans lesquelles FISCAL.IA met à disposition des Utilisateurs les Services du Site. L'utilisation du Site implique l'acceptation sans réserve des présentes CGU.\n\n⸻\n\n4. Accès et conditions d'utilisation\n1. Accès\n• L'accès au Site est réservé aux personnes physiques majeures (18 ans révolus) et capables juridiquement.\n2. Création de compte\n• Certaines fonctionnalités exigent un compte. L'Utilisateur est responsable de la confidentialité de ses identifiants et de toutes les activités réalisées via son compte.\n3. Usage licite\n• L'Utilisateur s'engage à utiliser le Site conformément aux lois en vigueur et aux présentes CGU. Tout usage frauduleux ou abusif pourra entraîner la suspension ou la suppression du compte.\n4. Responsabilité de l'Utilisateur\n• Il appartient à l'Utilisateur de vérifier la conformité des suggestions IA auprès d'experts compétents avant tout usage.\n\n⸻\n\n5. Propriété intellectuelle\n\nTous les éléments (textes, logos, marques, visuels, logiciels, bases de données) présents sur le Site sont la propriété exclusive de FISCAL.IA ou de ses partenaires. Toute reproduction, représentation ou exploitation non autorisée est interdite et constitue une contrefaçon.\n\n⸻\n\n6. Données personnelles et RGPD\n1. Responsable de traitement : FISCAL.IA SAS\n2. Finalités\n• Gestion des abonnements, personnalisation des services, amélioration et sécurité du Site.\n3. Catégories de données\n• Identification (email, nom d'utilisateur), fiscales (revenus, dépenses), financières (épargne, budget), techniques (adresse IP, logs).\n4. Base légale\n• Exécution du contrat (art. 6.1.b RGPD) et intérêt légitime (art. 6.1.f RGPD).\n5. Durées de conservation\n• Données fiscales et financières : durée de l'abonnement + 5 ans.\n• Données de compte : jusqu'à suppression.\n• Données techniques : 1 an.\n6. Transferts hors UE\n• Conformes via clauses contractuelles types.\n7. Droits des Utilisateurs\n• Accès, rectification, suppression, limitation, portabilité, opposition.\n• Exercice par email à fiscalia.group@gmail.com ou courrier au siège.\n8. Cookies\n• Cookie strictement nécessaires, analytiques et fonctionnels.\n• Consentement géré via bannière.\n• Paramétrage possible à tout moment dans votre navigateur.\n9. Délégué à la protection des données (DPO)\n• Contact : fiscalia.group@gmail.com\n\n⸻\n\n7. Clauses de responsabilité\n1. Absence de conseil personnalisé\n• Les suggestions IA sont fournies \"en l'état\" sans garantie. Elles ne constituent pas un conseil fiscal ou financier personnalisé.\n2. Limitation de responsabilité\n• FISCAL.IA décline toute responsabilité en cas de dommages directs ou indirects résultant de l'utilisation du Site ou de l'impossibilité d'y accéder.\n3. Force majeure\n• Événements échappant au contrôle de FISCAL.IA (incendie, inondation, cyberattaque, grève) exonèrent partiellement ou totalement la responsabilité de l'Éditeur.\n4. Indemnisation\n• L'Utilisateur s'engage à indemniser FISCAL.IA contre toute réclamation ou dommage résultant de son usage non conforme du Site.\n\n⸻\n\n8. Conditions tarifaires et abonnement\n1. Tarif\n• Abonnement mensuel : 9,99 € TTC.\n• Prix garanti à vie pour les 100 premiers inscrits (bêta privée avant 15/05/2025).\n2. Facturation et paiement\n• Paiement automatique par carte bancaire via un prestataire sécurisé.\n3. Renouvellement et résiliation\n• Renouvellement automatique chaque mois.\n• Résiliation possible à tout moment via l'espace \"Mon Compte\" ou par email.\n• Résiliation effective en fin de période en cours, sans remboursement prorata.\n4. Droit de rétractation\n• 14 jours selon l'article L.221-18 du Code de la consommation, sans frais, par email à fiscalia.group@gmail.com.\n\n⸻\n\n9. Loi applicable et juridiction\n\nLes présentes CGU sont régies par le droit français. Tout litige relatif à leur interprétation ou exécution sera de la compétence exclusive des tribunaux de Niort, France.\n\n⸻\n\n10. Modification des CGU\n\nFISCAL.IA se réserve le droit de modifier à tout moment les présentes CGU. Les modifications seront publiées sur cette page et notifiées par email. L'utilisation continue du Site après publication vaut acceptation des nouvelles CGU.\n\n⸻\n\nPour toute question ou réclamation, contactez-nous à fiscalia.group@gmail.com."})]})}):null}function Gi(){const[t,s]=J.useState(null),[i,r]=J.useState(!0),[a,n]=J.useState(!1);return J.useEffect((()=>{Ai.auth.getSession().then((({data:{session:e}})=>{s((null==e?void 0:e.user)??null),r(!1)}));const{data:{subscription:e}}=Ai.auth.onAuthStateChange(((e,t)=>{s((null==t?void 0:t.user)??null)}));return()=>e.unsubscribe()}),[]),i?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876] flex items-center justify-center",children:e.jsx("div",{className:"text-white text-xl",children:"Chargement..."})}):e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(W,{path:"/",element:e.jsx(Ui,{})}),e.jsx(W,{path:"/dashboard",element:t?e.jsx(Bi,{}):e.jsx(Q,{to:"/",replace:!0})}),e.jsx(W,{path:"*",element:e.jsx(Q,{to:"/",replace:!0})})]})}),e.jsx("footer",{style:{position:"fixed",left:0,right:0,bottom:0,zIndex:100,textAlign:"center",fontSize:10,color:"#c5a572",background:"rgba(26,41,66,0.85)",padding:4,letterSpacing:.5},children:e.jsx("button",{style:{background:"none",border:"none",color:"#c5a572",textDecoration:"underline",cursor:"pointer",fontSize:10},onClick:()=>n(!0),children:"Mentions légales et CGU"})}),e.jsx(Ji,{open:a,onClose:()=>n(!1)})]})}Y.createRoot(document.getElementById("root")).render(e.jsx(G.StrictMode,{children:e.jsx(Gi,{})}));
//# sourceMappingURL=main-Bofhqoiv.js.map
