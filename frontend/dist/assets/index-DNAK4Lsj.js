const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-BaWd0N-J.js","assets/vendor-UD6CX1rU.js"])))=>i.map(i=>d[i]);
import{j as e,X as t,m as s,M as r,E as i,U as n,C as a,H as o,a as l,b as c,A as d,c as h,S as u,d as m,T as p,e as f,f as g,g as x,h as v,i as b,B as y,k as w,P as j,l as _,F as k,L as N,n as S,o as T}from"./ui-DShsa_c8.js";import{a as E,g as P,c as C,r as A,b as O}from"./vendor-UD6CX1rU.js";import{u as I,B as R,R as $,a as L,N as U}from"./router-RMwWabV4.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var D={},q=E;D.createRoot=q.createRoot,D.hydrateRoot=q.hydrateRoot;const z={},F=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in z)return;z[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script"),i.crossOrigin="",i.href=e,s&&i.setAttribute("nonce",s),document.head.appendChild(i),t?new Promise(((t,s)=>{i.addEventListener("load",t),i.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then((t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)}))};class M extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class B extends M{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class J extends M{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class V extends M{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var G,H;(H=G||(G={})).Any="any",H.ApNortheast1="ap-northeast-1",H.ApNortheast2="ap-northeast-2",H.ApSouth1="ap-south-1",H.ApSoutheast1="ap-southeast-1",H.ApSoutheast2="ap-southeast-2",H.CaCentral1="ca-central-1",H.EuCentral1="eu-central-1",H.EuWest1="eu-west-1",H.EuWest2="eu-west-2",H.EuWest3="eu-west-3",H.SaEast1="sa-east-1",H.UsEast1="us-east-1",H.UsWest1="us-west-1",H.UsWest2="us-west-2";var K=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};class W{constructor(e,{headers:t={},customFetch:s,region:r=G.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>F((async()=>{const{default:e}=await Promise.resolve().then((()=>le));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return K(this,void 0,void 0,(function*(){try{const{headers:r,method:i,body:n}=t;let a,o={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(o["x-region"]=l),n&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",a=n):"string"==typeof n?(o["Content-Type"]="text/plain",a=n):"undefined"!=typeof FormData&&n instanceof FormData?a=n:(o["Content-Type"]="application/json",a=JSON.stringify(n)));const c=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:a}).catch((e=>{throw new B(e)})),d=c.headers.get("x-relay-error");if(d&&"true"===d)throw new J(c);if(!c.ok)throw new V(c);let h,u=(null!==(s=c.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return h="application/json"===u?yield c.json():"application/octet-stream"===u?yield c.blob():"text/event-stream"===u?c:"multipart/form-data"===u?yield c.formData():yield c.text(),{data:h,error:null}}catch(r){return{data:null,error:r}}}))}}var Q={},X={},Y={},Z={},ee={},te={},se=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const re=se.fetch,ie=se.fetch.bind(se),ne=se.Headers,ae=se.Request,oe=se.Response,le=Object.freeze(Object.defineProperty({__proto__:null,Headers:ne,Request:ae,Response:oe,default:ie,fetch:re},Symbol.toStringTag,{value:"Module"})),ce=P(le);var de={};Object.defineProperty(de,"__esModule",{value:!0});let he=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};de.default=he;var ue=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(te,"__esModule",{value:!0});const me=ue(ce),pe=ue(de);te.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=me.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async e=>{var t,s,r;let i=null,n=null,a=null,o=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(n="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const r=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");r&&c&&c.length>1&&(a=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(n)&&(n.length>1?(i={code:"PGRST116",details:`Results contain ${n.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},n=null,a=null,o=406,l="Not Acceptable"):n=1===n.length?n[0]:null)}else{const t=await e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(n=[],i=null,o=200,l="OK")}catch(c){404===e.status&&""===t?(o=204,l="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(r=null==i?void 0:i.details)||void 0===r?void 0:r.includes("0 rows"))&&(i=null,o=200,l="OK"),i&&this.shouldThrowOnError)throw new pe.default(i)}return{error:i,data:n,count:a,status:o,statusText:l}}));return this.shouldThrowOnError||(s=s.catch((e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}}))),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var fe=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ee,"__esModule",{value:!0});const ge=fe(te);let xe=class extends ge.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:i=r}={}){const n=i?`${i}.order`:"order",a=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const i=void 0===r?"offset":`${r}.offset`,n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(n,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:i=!1,format:n="text"}={}){var a;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=null!==(a=this.headers.Accept)&&void 0!==a?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};ee.default=xe;var ve=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Z,"__esModule",{value:!0});const be=ve(ee);let ye=class extends be.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let i="";"plain"===r?i="pl":"phrase"===r?i="ph":"websearch"===r&&(i="w");const n=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${n}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Z.default=ye;var we=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Y,"__esModule",{value:!0});const je=we(Z);Y.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let i=!1;const n=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e))).join("");return this.url.searchParams.set("select",n),s&&(this.headers.Prefer=`count=${s}`),new je.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new je.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:i=!0}={}){const n=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&n.push(this.headers.Prefer),r&&n.push(`count=${r}`),i||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new je.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new je.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new je.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var _e={},ke={};Object.defineProperty(ke,"__esModule",{value:!0}),ke.version=void 0,ke.version="0.0.0-automated",Object.defineProperty(_e,"__esModule",{value:!0}),_e.DEFAULT_HEADERS=void 0;const Ne=ke;_e.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Ne.version}`};var Se=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(X,"__esModule",{value:!0});const Te=Se(Y),Ee=Se(Z),Pe=_e;X.default=class e{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},Pe.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new Te.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:i}={}){let n;const a=new URL(`${this.url}/rpc/${e}`);let o;s||r?(n=s?"HEAD":"GET",Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`])).forEach((([e,t])=>{a.searchParams.append(e,t)}))):(n="POST",o=t);const l=Object.assign({},this.headers);return i&&(l.Prefer=`count=${i}`),new Ee.default({method:n,url:a,headers:l,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}};var Ce=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Q,"__esModule",{value:!0}),Q.PostgrestError=Q.PostgrestBuilder=Q.PostgrestTransformBuilder=Q.PostgrestFilterBuilder=Q.PostgrestQueryBuilder=Q.PostgrestClient=void 0;const Ae=Ce(X);Q.PostgrestClient=Ae.default;const Oe=Ce(Y);Q.PostgrestQueryBuilder=Oe.default;const Ie=Ce(Z);Q.PostgrestFilterBuilder=Ie.default;const Re=Ce(ee);Q.PostgrestTransformBuilder=Re.default;const $e=Ce(te);Q.PostgrestBuilder=$e.default;const Le=Ce(de);Q.PostgrestError=Le.default;var Ue=Q.default={PostgrestClient:Ae.default,PostgrestQueryBuilder:Oe.default,PostgrestFilterBuilder:Ie.default,PostgrestTransformBuilder:Re.default,PostgrestBuilder:$e.default,PostgrestError:Le.default};const{PostgrestClient:De,PostgrestQueryBuilder:qe,PostgrestFilterBuilder:ze,PostgrestTransformBuilder:Fe,PostgrestBuilder:Me,PostgrestError:Be}=Ue,Je={"X-Client-Info":"realtime-js/2.11.2"};var Ve,Ge,He,Ke,We,Qe,Xe,Ye,Ze,et,tt;(Ge=Ve||(Ve={}))[Ge.connecting=0]="connecting",Ge[Ge.open=1]="open",Ge[Ge.closing=2]="closing",Ge[Ge.closed=3]="closed",(Ke=He||(He={})).closed="closed",Ke.errored="errored",Ke.joined="joined",Ke.joining="joining",Ke.leaving="leaving",(Qe=We||(We={})).close="phx_close",Qe.error="phx_error",Qe.join="phx_join",Qe.reply="phx_reply",Qe.leave="phx_leave",Qe.access_token="access_token",(Xe||(Xe={})).websocket="websocket",(Ze=Ye||(Ye={})).Connecting="connecting",Ze.Open="open",Ze.Closing="closing",Ze.Closed="closed";class st{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),i=t.getUint8(2);let n=this.HEADER_LENGTH+2;const a=s.decode(e.slice(n,n+r));n+=r;const o=s.decode(e.slice(n,n+i));n+=i;return{ref:null,topic:a,event:o,payload:JSON.parse(s.decode(e.slice(n,e.byteLength)))}}}class rt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}(tt=et||(et={})).abstime="abstime",tt.bool="bool",tt.date="date",tt.daterange="daterange",tt.float4="float4",tt.float8="float8",tt.int2="int2",tt.int4="int4",tt.int4range="int4range",tt.int8="int8",tt.int8range="int8range",tt.json="json",tt.jsonb="jsonb",tt.money="money",tt.numeric="numeric",tt.oid="oid",tt.reltime="reltime",tt.text="text",tt.time="time",tt.timestamp="timestamp",tt.timestamptz="timestamptz",tt.timetz="timetz",tt.tsrange="tsrange",tt.tstzrange="tstzrange";const it=(e,t,s={})=>{var r;const i=null!==(r=s.skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce(((s,r)=>(s[r]=nt(r,e,t,i),s)),{})},nt=(e,t,s,r)=>{const i=t.find((t=>t.name===e)),n=null==i?void 0:i.type,a=s[e];return n&&!r.includes(n)?at(n,a):ot(a)},at=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return ht(t,s)}switch(e){case et.bool:return lt(t);case et.float4:case et.float8:case et.int2:case et.int4:case et.int8:case et.numeric:case et.oid:return ct(t);case et.json:case et.jsonb:return dt(t);case et.timestamp:return ut(t);case et.abstime:case et.date:case et.daterange:case et.int4range:case et.int8range:case et.money:case et.reltime:case et.text:case et.time:case et.timestamptz:case et.timetz:case et.tsrange:case et.tstzrange:default:return ot(t)}},ot=e=>e,lt=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},ct=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},dt=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},ht=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const n=e.slice(1,s);try{r=JSON.parse("["+n+"]")}catch(i){r=n?n.split(","):[]}return r.map((e=>at(t,e)))}return e},ut=e=>"string"==typeof e?e.replace(" ","T"):e,mt=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class pt{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ft,gt,xt,vt,bt,yt,wt,jt;(gt=ft||(ft={})).SYNC="sync",gt.JOIN="join",gt.LEAVE="leave";class _t{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},(e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=_t.syncState(this.state,e,t,s),this.pendingDiffs.forEach((e=>{this.state=_t.syncDiff(this.state,e,t,s)})),this.pendingDiffs=[],r()})),this.channel._on(s.diff,{},(e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=_t.syncDiff(this.state,e,t,s),r())})),this.onJoin(((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})})),this.onLeave(((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,s,r){const i=this.cloneDeep(e),n=this.transformState(t),a={},o={};return this.map(i,((e,t)=>{n[e]||(o[e]=t)})),this.map(n,((e,t)=>{const s=i[e];if(s){const r=t.map((e=>e.presence_ref)),i=s.map((e=>e.presence_ref)),n=t.filter((e=>i.indexOf(e.presence_ref)<0)),l=s.filter((e=>r.indexOf(e.presence_ref)<0));n.length>0&&(a[e]=n),l.length>0&&(o[e]=l)}else a[e]=t})),this.syncDiff(i,{joins:a,leaves:o},s,r)}static syncDiff(e,t,s,r){const{joins:i,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,((t,r)=>{var i;const n=null!==(i=e[t])&&void 0!==i?i:[];if(e[t]=this.cloneDeep(r),n.length>0){const s=e[t].map((e=>e.presence_ref)),r=n.filter((e=>s.indexOf(e.presence_ref)<0));e[t].unshift(...r)}s(t,n,r)})),this.map(n,((t,s)=>{let i=e[t];if(!i)return;const n=s.map((e=>e.presence_ref));i=i.filter((e=>n.indexOf(e.presence_ref)<0)),e[t]=i,r(t,i,s),0===i.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((s=>t(s,e[s])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):r,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(vt=xt||(xt={})).ALL="*",vt.INSERT="INSERT",vt.UPDATE="UPDATE",vt.DELETE="DELETE",(yt=bt||(bt={})).BROADCAST="broadcast",yt.PRESENCE="presence",yt.POSTGRES_CHANGES="postgres_changes",yt.SYSTEM="system",(jt=wt||(wt={})).SUBSCRIBED="SUBSCRIBED",jt.TIMED_OUT="TIMED_OUT",jt.CLOSED="CLOSED",jt.CHANNEL_ERROR="CHANNEL_ERROR";class kt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=He.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new pt(this,We.join,this.params,this.timeout),this.rejoinTimer=new rt((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=He.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=He.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=He.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=He.errored,this.rejoinTimer.scheduleTimeout())})),this._on(We.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new _t(this),this.broadcastEndpointURL=mt(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:n,private:a}}=this.params;this._onError((t=>null==e?void 0:e(wt.CHANNEL_ERROR,t))),this._onClose((()=>null==e?void 0:e(wt.CLOSED)));const o={},l={broadcast:i,presence:n,postgres_changes:null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map((e=>e.filter)))&&void 0!==r?r:[],private:a};this.socket.accessTokenValue&&(o.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,i=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,n=[];for(let s=0;s<i;s++){const i=r[s],{filter:{event:a,schema:o,table:l,filter:c}}=i,d=t&&t[s];if(!d||d.event!==a||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),void(null==e||e(wt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},i),{id:d.id}))}return this.bindings.postgres_changes=n,void(e&&e(wt.SUBSCRIBED))}null==e||e(wt.SUBSCRIBED)})).receive("error",(t=>{null==e||e(wt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{null==e||e(wt.TIMED_OUT)}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise((s=>{var r,i,n;const a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(n=null===(i=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===i?void 0:i.broadcast)||void 0===n?void 0:n.ack)||s("ok"),a.receive("ok",(()=>s("ok"))),a.receive("error",(()=>s("error"))),a.receive("timeout",(()=>s("timed out")))}));{const{event:n,payload:a}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(i){return"AbortError"===i.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=He.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(We.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((s=>{const r=new pt(this,We.leave,{},e);r.receive("ok",(()=>{t(),s("ok")})).receive("timeout",(()=>{t(),s("timed out")})).receive("error",(()=>{s("error")})),r.send(),this._canPush()||r.trigger("ok",{})}))}async _fetchWithTimeout(e,t,s){const r=new AbortController,i=setTimeout((()=>r.abort()),s),n=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),n}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new pt(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,i;const n=e.toLocaleLowerCase(),{close:a,error:o,leave:l,join:c}=We;if(s&&[a,o,l,c].indexOf(n)>=0&&s!==this._joinRef())return;let d=this._onMessage(n,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter((e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===n})).map((e=>e.callback(d,s))):null===(i=this.bindings[n])||void 0===i||i.filter((e=>{var s,r,i,a,o,l;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in e){const n=e.id,a=null===(s=e.filter)||void 0===s?void 0:s.event;return n&&(null===(r=t.ids)||void 0===r?void 0:r.includes(n))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null===(i=t.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{const s=null===(o=null===(a=null==e?void 0:e.filter)||void 0===a?void 0:a.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===n})).map((e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:r,type:i,errors:n}=e,a={schema:t,table:s,commit_timestamp:r,eventType:i,new:{},old:{},errors:n};d=Object.assign(Object.assign({},a),this._getPayloadRecords(e))}e.callback(d,s)}))}_isClosed(){return this.state===He.closed}_isJoined(){return this.state===He.joined}_isJoining(){return this.state===He.joining}_isLeaving(){return this.state===He.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter((e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&kt.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(We.close,{},e)}_onError(e){this._on(We.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=He.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=it(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=it(e.columns,e.old_record)),t}}const Nt=()=>{},St="undefined"!=typeof WebSocket;class Tt{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Je,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Nt,this.conn=null,this.sendBuffer=[],this.serializer=new st,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>F((async()=>{const{default:e}=await Promise.resolve().then((()=>le));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${Xe.websocket}`,this.httpEndpoint=mt(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const r=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new rt((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});else{if(St)return this.conn=new WebSocket(this.endpointURL()),void this.setupConnection();this.conn=new Et(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),F((async()=>{const{default:e}=await import("./browser-BaWd0N-J.js").then((e=>e.b));return{default:e}}),__vite__mapDeps([0,1])).then((({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()}))}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Ve.connecting:return Ye.Connecting;case Ve.open:return Ye.Open;case Ve.closing:return Ye.Closing;default:return Ye.Closed}}isConnected(){return this.connectionState()===Ye.Open}channel(e,t={config:{}}){const s=new kt(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:r,ref:i}=e,n=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${s} (${i})`,r),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let e=null;try{e=JSON.parse(atob(t.split(".")[1]))}catch(s){}if(e&&e.exp){if(!(Math.floor(Date.now()/1e3)-e.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`)}this.accessTokenValue=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(We.access_token,{access_token:t})}))}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t._joinRef()!==e._joinRef()))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:s,payload:r,ref:i}=e;i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${t} ${s} ${i&&"("+i+")"||""}`,r),this.channels.filter((e=>e._isMember(t))).forEach((e=>e._trigger(s,r,i))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(We.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class Et{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Ve.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class Pt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ct(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class At extends Pt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ot extends Pt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var It=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const Rt=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>F((async()=>{const{default:e}=await Promise.resolve().then((()=>le));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},$t=e=>{if(Array.isArray(e))return e.map((e=>$t(e)));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach((([e,s])=>{const r=e.replace(/([-_][a-z])/gi,(e=>e.toUpperCase().replace(/[-_]/g,"")));t[r]=$t(s)})),t};var Lt=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const Ut=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Dt=(e,t,s)=>Lt(void 0,void 0,void 0,(function*(){const r=yield It(void 0,void 0,void 0,(function*(){return"undefined"==typeof Response?(yield F((()=>Promise.resolve().then((()=>le))),void 0)).Response:Response}));e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then((s=>{t(new At(Ut(s),e.status||500))})).catch((e=>{t(new Ot(Ut(e),e))})):t(new Ot(Ut(e),e))}));function qt(e,t,s,r,i,n){return Lt(this,void 0,void 0,(function*(){return new Promise(((a,o)=>{e(s,((e,t,s,r)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),r&&(i.body=JSON.stringify(r)),Object.assign(Object.assign({},i),s))})(t,r,i,n)).then((e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()})).then((e=>a(e))).catch((e=>Dt(e,o,r)))}))}))}function zt(e,t,s,r){return Lt(this,void 0,void 0,(function*(){return qt(e,"GET",t,s,r)}))}function Ft(e,t,s,r,i){return Lt(this,void 0,void 0,(function*(){return qt(e,"POST",t,r,i,s)}))}function Mt(e,t,s,r,i){return Lt(this,void 0,void 0,(function*(){return qt(e,"DELETE",t,r,i,s)}))}var Bt=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const Jt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Vt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Gt{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Rt(r)}uploadOrUpdate(e,t,s,r){return Bt(this,void 0,void 0,(function*(){try{let i;const n=Object.assign(Object.assign({},Vt),r);let a=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});const o=n.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(i=new FormData,i.append("cacheControl",n.cacheControl),o&&i.append("metadata",this.encodeMetadata(o)),i.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(i=s,i.append("cacheControl",n.cacheControl),o&&i.append("metadata",this.encodeMetadata(o))):(i=s,a["cache-control"]=`max-age=${n.cacheControl}`,a["content-type"]=n.contentType,o&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==r?void 0:r.headers)&&(a=Object.assign(Object.assign({},a),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:a},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{})),h=yield d.json();if(d.ok)return{data:{path:l,id:h.Id,fullPath:h.Key},error:null};return{data:null,error:h}}catch(i){if(Ct(i))return{data:null,error:i};throw i}}))}upload(e,t,s){return Bt(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,s)}))}uploadToSignedUrl(e,t,s,r){return Bt(this,void 0,void 0,(function*(){const i=this._removeEmptyFolders(e),n=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${n}`);a.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Vt.upsert},r),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,n["cache-control"]=`max-age=${t.cacheControl}`,n["content-type"]=t.contentType);const o=yield this.fetch(a.toString(),{method:"PUT",body:e,headers:n}),l=yield o.json();if(o.ok)return{data:{path:i,fullPath:l.Key},error:null};return{data:null,error:l}}catch(o){if(Ct(o))return{data:null,error:o};throw o}}))}createSignedUploadUrl(e,t){return Bt(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const i=yield Ft(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),n=new URL(this.url+i.url),a=n.searchParams.get("token");if(!a)throw new Pt("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:a},error:null}}catch(s){if(Ct(s))return{data:null,error:s};throw s}}))}update(e,t,s){return Bt(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,s)}))}move(e,t,s){return Bt(this,void 0,void 0,(function*(){try{return{data:yield Ft(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(Ct(r))return{data:null,error:r};throw r}}))}copy(e,t,s){return Bt(this,void 0,void 0,(function*(){try{return{data:{path:(yield Ft(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(Ct(r))return{data:null,error:r};throw r}}))}createSignedUrl(e,t,s){return Bt(this,void 0,void 0,(function*(){try{let r=this._getFinalPath(e),i=yield Ft(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${n}`)},{data:i,error:null}}catch(r){if(Ct(r))return{data:null,error:r};throw r}}))}createSignedUrls(e,t,s){return Bt(this,void 0,void 0,(function*(){try{const r=yield Ft(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${i}`):null}))),error:null}}catch(r){if(Ct(r))return{data:null,error:r};throw r}}))}download(e,t){return Bt(this,void 0,void 0,(function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=r?`?${r}`:"";try{const t=this._getFinalPath(e),r=yield zt(this.fetch,`${this.url}/${s}/${t}${i}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(n){if(Ct(n))return{data:null,error:n};throw n}}))}info(e){return Bt(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{const e=yield zt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:$t(e),error:null}}catch(s){if(Ct(s))return{data:null,error:s};throw s}}))}exists(e){return Bt(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return Lt(this,void 0,void 0,(function*(){return qt(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)}))}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(Ct(s)&&s instanceof Ot){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}}))}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],i=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==i&&r.push(i);const n=void 0!==(null==t?void 0:t.transform)?"render/image":"object",a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&r.push(a);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${s}${o}`)}}}remove(e){return Bt(this,void 0,void 0,(function*(){try{return{data:yield Mt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Ct(t))return{data:null,error:t};throw t}}))}list(e,t,s){return Bt(this,void 0,void 0,(function*(){try{const r=Object.assign(Object.assign(Object.assign({},Jt),t),{prefix:e||""});return{data:yield Ft(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(Ct(r))return{data:null,error:r};throw r}}))}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ht={"X-Client-Info":"storage-js/2.7.1"};var Kt=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};class Wt{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Ht),t),this.fetch=Rt(s)}listBuckets(){return Kt(this,void 0,void 0,(function*(){try{return{data:yield zt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Ct(e))return{data:null,error:e};throw e}}))}getBucket(e){return Kt(this,void 0,void 0,(function*(){try{return{data:yield zt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Ct(t))return{data:null,error:t};throw t}}))}createBucket(e,t={public:!1}){return Kt(this,void 0,void 0,(function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Ct(s))return{data:null,error:s};throw s}}))}updateBucket(e,t){return Kt(this,void 0,void 0,(function*(){try{const s=yield function(e,t,s,r,i){return Lt(this,void 0,void 0,(function*(){return qt(e,"PUT",t,r,i,s)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:s,error:null}}catch(s){if(Ct(s))return{data:null,error:s};throw s}}))}emptyBucket(e){return Kt(this,void 0,void 0,(function*(){try{return{data:yield Ft(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Ct(t))return{data:null,error:t};throw t}}))}deleteBucket(e){return Kt(this,void 0,void 0,(function*(){try{return{data:yield Mt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Ct(t))return{data:null,error:t};throw t}}))}}class Qt extends Wt{constructor(e,t={},s){super(e,t,s)}from(e){return new Gt(this.url,this.headers,e,this.fetch)}}let Xt="";Xt="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Yt={headers:{"X-Client-Info":`supabase-js-${Xt}/2.49.8`}},Zt={schema:"public"},es={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ts={};var ss=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const rs=(e,t,s)=>{const r=(e=>{let t;return t=e||("undefined"==typeof fetch?ie:fetch),(...e)=>t(...e)})(s),i="undefined"==typeof Headers?ne:Headers;return(s,n)=>ss(void 0,void 0,void 0,(function*(){var a;const o=null!==(a=yield t())&&void 0!==a?a:e;let l=new i(null==n?void 0:n.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,Object.assign(Object.assign({},n),{headers:l}))}))};var is=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const ns="2.69.1",as=3e4,os=9e4,ls={"X-Client-Info":`gotrue-js/${ns}`},cs="X-Supabase-Api-Version",ds={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},hs=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class us extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function ms(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class ps extends us{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class fs extends us{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class gs extends us{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class xs extends gs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class vs extends gs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class bs extends gs{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ys extends gs{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ws extends gs{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class js extends gs{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function _s(e){return ms(e)&&"AuthRetryableFetchError"===e.name}class ks extends gs{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Ns extends gs{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ss="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ts=" \t\n\r=".split(""),Es=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Ts.length;t+=1)e[Ts[t].charCodeAt(0)]=-2;for(let t=0;t<Ss.length;t+=1)e[Ss[t].charCodeAt(0)]=t;return e})();function Ps(e,t,s){const r=Es[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Cs(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let a=0;a<e.length;a+=1)Ps(e.charCodeAt(a),i,n);return t.join("")}function As(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Os(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let i=0;i<e.length;i+=1)Ps(e.charCodeAt(i),s,r);return new Uint8Array(t)}function Is(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}As(r,t)}}(e,(e=>t.push(e))),new Uint8Array(t)}const Rs=()=>"undefined"!=typeof window&&"undefined"!=typeof document,$s={tested:!1,writable:!1},Ls=()=>{if(!Rs())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if($s.tested)return $s.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),$s.tested=!0,$s.writable=!0}catch(t){$s.tested=!0,$s.writable=!1}return $s.writable};const Us=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>F((async()=>{const{default:e}=await Promise.resolve().then((()=>le));return{default:e}}),void 0).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},Ds=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},qs=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(r){return s}},zs=async(e,t)=>{await e.removeItem(t)};class Fs{constructor(){this.promise=new Fs.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function Ms(e){const t=e.split(".");if(3!==t.length)throw new Ns("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!hs.test(t[s]))throw new Ns("JWT not in base64url format");return{header:JSON.parse(Cs(t[0])),payload:JSON.parse(Cs(t[1])),signature:Os(t[2]),raw:{header:t[0],payload:t[1]}}}function Bs(e){return("0"+e.toString(16)).substr(-2)}async function Js(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map((e=>String.fromCharCode(e))).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Vs(e,t,s=!1){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Bs).join("")}();let i=r;s&&(i+="/PASSWORD_RECOVERY"),await Ds(e,`${t}-code-verifier`,i);const n=await Js(r);return[n,r===n?"plain":"s256"]}Fs.promiseConstructor=Promise;const Gs=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Hs=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ks=[502,503,504];async function Ws(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new js(Hs(e),0);if(Ks.includes(e.status))throw new js(Hs(e),e.status);let r,i;try{r=await e.json()}catch(a){throw new fs(Hs(a),a)}const n=function(e){const t=e.headers.get(cs);if(!t)return null;if(!t.match(Gs))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(a){return null}}(e);if(n&&n.getTime()>=ds.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?i=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(i=r.error_code),i){if("weak_password"===i)throw new ks(Hs(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===i)throw new xs}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new ks(Hs(r),e.status,r.weak_password.reasons);throw new ps(Hs(r),e.status||500,i)}async function Qs(e,t,s,r){var i;const n=Object.assign({},null==r?void 0:r.headers);n[cs]||(n[cs]=ds.name),(null==r?void 0:r.jwt)&&(n.Authorization=`Bearer ${r.jwt}`);const a=null!==(i=null==r?void 0:r.query)&&void 0!==i?i:{};(null==r?void 0:r.redirectTo)&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await async function(e,t,s,r,i,n){const a=((e,t,s,r)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),s))})(t,r,i,n);let o;try{o=await e(s,Object.assign({},a))}catch(l){throw console.error(l),new js(Hs(l),0)}o.ok||await Ws(o);if(null==r?void 0:r.noResolveJson)return o;try{return await o.json()}catch(l){await Ws(l)}}(e,t,s+o,{headers:n,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function Xs(e){var t;let s=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Ys(e){const t=Xs(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function Zs(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function er(e){return{data:e,error:null}}function tr(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:i,verification_type:n}=e,a=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:i,verification_type:n},user:Object.assign({},a)},error:null}}function sr(e){return e}class rr{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Us(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await Qs(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(ms(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await Qs(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Zs})}catch(s){if(ms(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s}(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await Qs(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:tr,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(ms(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Qs(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Zs})}catch(t){if(ms(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,i,n,a,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Qs(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(i=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==i?i:""},xform:sr});if(c.error)throw c.error;const d=await c.json(),h=null!==(n=c.headers.get("x-total-count"))&&void 0!==n?n:0,u=null!==(o=null===(a=c.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==o?o:[];return u.length>0&&(u.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t})),l.total=parseInt(h)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(ms(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await Qs(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Zs})}catch(t){if(ms(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await Qs(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Zs})}catch(s){if(ms(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await Qs(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Zs})}catch(s){if(ms(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await Qs(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(ms(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await Qs(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ms(t))return{data:null,error:t};throw t}}}const ir={getItem:e=>Ls()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{Ls()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{Ls()&&globalThis.localStorage.removeItem(e)}};function nr(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const ar=!!(globalThis&&Ls()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class or extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class lr extends or{}async function cr(e,t,s){ar&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout((()=>{r.abort(),ar&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)}),t),await Promise.resolve().then((()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},(async r=>{if(!r){if(0===t)throw ar&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new lr(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(ar)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}ar&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await s()}finally{ar&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const dr={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ls,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function hr(e,t,s){return await s()}class ur{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ur.nextInstanceID,ur.nextInstanceID+=1,this.instanceID>0&&Rs()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},dr),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new rr({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Us(r.fetch),this.lock=r.lock||hr,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:Rs()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=cr:this.lock=hr,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:Ls()?this.storage=ir:(this.memoryStorage={},this.storage=nr(this.memoryStorage)):(this.memoryStorage={},this.storage=nr(this.memoryStorage)),Rs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",(async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ns}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach(((e,s)=>{t[s]=e}))}catch(r){}return s.searchParams.forEach(((e,s)=>{t[s]=e})),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),Rs()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),function(e){return ms(e)&&"AuthImplicitGrantRedirectError"===e.name}(i)){const t=null===(e=i.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:i}}return await this._removeSession(),{error:i}}const{session:n,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",n,"redirect type",a),await this._saveSession(n),setTimeout((async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",n):await this._notifyAllSubscribers("SIGNED_IN",n)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ms(t)?{error:t}:{error:new fs("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const i=await Qs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:Xs}),{data:n,error:a}=i;if(a||!n)return{data:{user:null,session:null},error:a};const o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(i){if(ms(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,r;try{let i;if("email"in e){const{email:s,password:r,options:n}=e;let a=null,o=null;"pkce"===this.flowType&&([a,o]=await Vs(this.storage,this.storageKey)),i=await Qs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:a,code_challenge_method:o},xform:Xs})}else{if(!("phone"in e))throw new bs("You must provide either an email or phone number and a password");{const{phone:t,password:n,options:a}=e;i=await Qs(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:n,data:null!==(s=null==a?void 0:a.data)&&void 0!==s?s:{},channel:null!==(r=null==a?void 0:a.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:Xs})}}const{data:n,error:a}=i;if(a||!n)return{data:{user:null,session:null},error:a};const o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(i){if(ms(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:r,options:i}=e;t=await Qs(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Ys})}else{if(!("phone"in e))throw new bs("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:i}=e;t=await Qs(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Ys})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new vs}}catch(t){if(ms(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(e)))}async _exchangeCodeForSession(e){const t=await qs(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:i}=await Qs(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Xs});if(await zs(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:i}):{data:{user:null,session:null,redirectType:null},error:new vs}}catch(i){if(ms(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:i,nonce:n}=e,a=await Qs(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Xs}),{data:o,error:l}=a;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new vs}}catch(t){if(ms(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,i,n;try{if("email"in e){const{email:r,options:i}=e;let n=null,a=null;"pkce"===this.flowType&&([n,a]=await Vs(this.storage,this.storageKey));const{error:o}=await Qs(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},create_user:null===(s=null==i?void 0:i.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:a},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:a,error:o}=await Qs(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(i=null==s?void 0:s.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(n=null==s?void 0:s.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o}}throw new bs("You must provide either an email or phone number.")}catch(a){if(ms(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let r,i;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,i=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:n,error:a}=await Qs(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:Xs});if(a)throw a;if(!n)throw new Error("An error occurred on token verification.");const o=n.session,l=n.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(ms(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let i=null,n=null;return"pkce"===this.flowType&&([i,n]=await Vs(this.storage,this.storageKey)),await Qs(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:n}),headers:this.headers,xform:er})}catch(i){if(ms(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new xs;const{error:r}=await Qs(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}}))}catch(e){if(ms(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:i}=e,{error:n}=await Qs(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){const{phone:s,type:r,options:i}=e,{data:n,error:a}=await Qs(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:a}}throw new bs("You must provide either an email or phone number and a type")}catch(t){if(ms(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,(async()=>this._useSession((async e=>e))))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await qs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<os;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,(async()=>await this._getUser()))}async _getUser(e){try{return e?await Qs(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Zs}):await this._useSession((async e=>{var t,s,r;const{data:i,error:n}=e;if(n)throw n;return(null===(t=i.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Qs(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=i.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:Zs}):{data:{user:null},error:new xs}}))}catch(t){if(ms(t))return function(e){return ms(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await zs(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(e,t)))}async _updateUser(e,t={}){try{return await this._useSession((async s=>{const{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new xs;const n=r.session;let a=null,o=null;"pkce"===this.flowType&&null!=e.email&&([a,o]=await Vs(this.storage,this.storageKey));const{data:l,error:c}=await Qs(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:o}),jwt:n.access_token,xform:Zs});if(c)throw c;return n.user=l.user,await this._saveSession(n),await this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}}))}catch(s){if(ms(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(e)))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new xs;const t=Date.now()/1e3;let s=t,r=!0,i=null;const{payload:n}=Ms(e.access_token);if(n.exp&&(s=n.exp,r=s<=t),r){const{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};i=t}else{const{data:r,error:n}=await this._getUser(e.access_token);if(n)throw n;i={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(ms(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(e)))}async _refreshSession(e){try{return await this._useSession((async t=>{var s;if(!e){const{data:r,error:i}=t;if(i)throw i;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new xs;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(ms(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Rs())throw new ys("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ys(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new ws("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new ys("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ws("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:n,expires_in:a,expires_at:o,token_type:l}=e;if(!(i&&a&&n&&l))throw new ys("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(a);let h=c+d;o&&(h=parseInt(o));const u=h-c;1e3*u<=as&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${u}s, should have been closer to ${d}s`);const m=h-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,c);const{data:p,error:f}=await this._getUser(i);if(f)throw f;const g={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:d,expires_at:h,refresh_token:n,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(s){if(ms(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await qs(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(e)))}async _signOut({scope:e}={scope:"global"}){return await this._useSession((async t=>{var s;const{data:r,error:i}=t;if(i)return{error:i};const n=null===(s=r.session)||void 0===s?void 0:s.access_token;if(n){const{error:t}=await this.admin.signOut(n,e);if(t&&(!function(e){return ms(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await zs(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(t)}))})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession((async t=>{var s,r;try{const{data:{session:r},error:i}=t;if(i)throw i;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(i){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}}))}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await Vs(this.storage,this.storageKey,!0));try{return await Qs(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(ms(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(ms(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession((async t=>{var s,r,i,n,a;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(i=e.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:!0});return await Qs(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(a=null===(n=o.session)||void 0===n?void 0:n.access_token)&&void 0!==a?a:void 0})}));if(r)throw r;return Rs()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(ms(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession((async t=>{var s,r;const{data:i,error:n}=t;if(n)throw n;return await Qs(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=i.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})}))}catch(t){if(ms(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const i=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise((t=>{setTimeout((()=>t(null)),e)}))}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Qs(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Xs})),r=(e,t)=>{const s=200*Math.pow(2,e);return t&&_s(t)&&Date.now()+s-i<as},new Promise(((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{const t=await s(n);if(!r(n,null,t))return void e(t)}catch(i){if(!r(n,i))return void t(i)}})()})))}catch(i){if(this._debug(t,"error",i),ms(i))return{data:{session:null,user:null},error:i};throw i}finally{this._debug(t,"end")}var s,r}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Rs()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await qs(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s))return this._debug(t,"session is not valid"),void(null!==s&&await this._removeSession());const r=1e3*(null!==(e=s.expires_at)&&void 0!==e?e:1/0)-Date.now()<os;if(this._debug(t,`session has${r?"":" not"} expired with margin of 90000s`),r){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),_s(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return this._debug(t,"error",s),void console.error(s)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new xs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Fs;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new xs;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(i){if(this._debug(r,"error",i),ms(i)){const e={session:null,error:i};return _s(i)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],i=Array.from(this.stateChangeEmitters.values()).map((async s=>{try{await s.callback(e,t)}catch(i){r.push(i)}}));if(await Promise.all(i),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ds(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await zs(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Rs()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),as);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const t=Date.now();try{return await this._useSession((async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-t)/as);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof or))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Rs()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await Vs(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession((async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await Qs(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(ms(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession((async t=>{var s,r;const{data:i,error:n}=t;if(n)return{data:null,error:n};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await Qs(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}))}catch(t){if(ms(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:n,error:a}=await Qs(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",n),{data:n,error:a})}))}catch(t){if(ms(t))return{data:null,error:t};throw t}}))}async _challenge(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await Qs(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(ms(t))return{data:null,error:t};throw t}}))}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],r=s.filter((e=>"totp"===e.factor_type&&"verified"===e.status)),i=s.filter((e=>"phone"===e.factor_type&&"verified"===e.status));return{data:{all:s,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async e=>{var t,s;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=Ms(r.access_token);let a=null;n.aal&&(a=n.aal);let o=a;(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==s?s:[]).length>0&&(o="aal2");return{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:n.amr||[]},error:null}}))))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find((t=>t.kid===e));if(s)return s;if(s=this.jwks.keys.find((t=>t.kid===e)),s&&this.jwks_cached_at+6e5>Date.now())return s;const{data:r,error:i}=await Qs(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!r.keys||0===r.keys.length)throw new Ns("JWKS is empty");if(this.jwks=r,this.jwks_cached_at=Date.now(),s=r.keys.find((t=>t.kid===e)),!s)throw new Ns("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:i,signature:n,raw:{header:a,payload:o}}=Ms(s);if(function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(i.exp),!r.kid||"HS256"===r.alg||!("crypto"in globalThis)||!("subtle"in globalThis.crypto)){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:i,header:r,signature:n},error:null}}const l=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),c=await this.fetchJwk(r.kid,t),d=await crypto.subtle.importKey("jwk",c,l,!0,["verify"]);if(!(await crypto.subtle.verify(l,d,n,Is(`${a}.${o}`))))throw new Ns("Invalid JWT signature");return{data:{claims:i,header:r,signature:n},error:null}}catch(s){if(ms(s))return{data:null,error:s};throw s}}}ur.nextInstanceID=0;const mr=ur;class pr extends mr{constructor(e){super(e)}}var fr=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};class gr{constructor(e,t,s){var r,i,n;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=(o=e).endsWith("/")?o:o+"/";var o;const l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d=function(e,t){var s,r;const{db:i,auth:n,realtime:a,global:o}=e,{db:l,auth:c,realtime:d,global:h}=t,u={db:Object.assign(Object.assign({},l),i),auth:Object.assign(Object.assign({},c),n),realtime:Object.assign(Object.assign({},d),a),global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},null!==(s=null==h?void 0:h.headers)&&void 0!==s?s:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:()=>is(this,void 0,void 0,(function*(){return""}))};return e.accessToken?u.accessToken=e.accessToken:delete u.accessToken,u}(null!=s?s:{},{db:Zt,realtime:ts,auth:Object.assign(Object.assign({},es),{storageKey:c}),global:Yt});this.storageKey=null!==(r=d.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(i=d.global.headers)&&void 0!==i?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(n=d.auth)&&void 0!==n?n:{},this.headers,d.global.fetch),this.fetch=rs(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new De(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new W(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Qt(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return fr(this,void 0,void 0,(function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:i,flowType:n,lock:a,debug:o},l,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new pr({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:n,lock:a,debug:o,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Tt(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}const xr=new gr("https://lqxfjjtjxktjgpekugtf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxeGZqanRqeGt0amdwZWt1Z3RmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3OTgyMDMsImV4cCI6MjA2MzM3NDIwM30.-E66kbBxRAVcJcPdhhUJWq5BZB-2GRpiBEaGtiWLVrA",vr);var vr;const br=({onClose:s})=>{const[r,i]=A.useState(!0),[n,a]=A.useState(""),[o,l]=A.useState(""),[c,d]=A.useState(""),[h,u]=A.useState(null),[m,p]=A.useState(!1),f=I();return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative bg-gradient-to-br from-[#1a2942] to-[#234876] rounded-2xl p-8 w-full max-w-md mx-4 shadow-2xl border border-[#c5a572]/20",children:[e.jsx("button",{onClick:s,className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors",children:e.jsx(t,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:r?"Connexion":"Inscription"}),e.jsx("p",{className:"text-gray-300",children:r?"Bienvenue ! Connectez-vous à votre compte.":"Créez votre compte Francis"})]}),h&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-500 text-sm",children:h}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),u(null),p(!0);try{if(!r&&o!==c)throw new Error("Les mots de passe ne correspondent pas");if(r){const{data:e,error:t}=await xr.auth.signInWithPassword({email:n,password:o});if(t)throw t;e.user&&(f("/dashboard"),s())}else{const{data:e,error:t}=await xr.auth.signUp({email:n,password:o});if(t)throw t;e.user&&(f("/dashboard"),s())}}catch(t){u(t.message)}finally{p(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-1",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:n,onChange:e=>a(e.target.value),className:"w-full px-4 py-2 bg-[#1a2942]/50 border border-[#c5a572]/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-[#c5a572] focus:ring-1 focus:ring-[#c5a572]",placeholder:"votre@email.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Mot de passe"}),e.jsx("input",{type:"password",id:"password",value:o,onChange:e=>l(e.target.value),className:"w-full px-4 py-2 bg-[#1a2942]/50 border border-[#c5a572]/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-[#c5a572] focus:ring-1 focus:ring-[#c5a572]",placeholder:"••••••••",required:!0})]}),!r&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300 mb-1",children:"Confirmer le mot de passe"}),e.jsx("input",{type:"password",id:"confirmPassword",value:c,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 bg-[#1a2942]/50 border border-[#c5a572]/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-[#c5a572] focus:ring-1 focus:ring-[#c5a572]",placeholder:"••••••••",required:!0})]}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#1a2942] font-bold py-3 px-4 rounded-lg hover:shadow-lg hover:shadow-[#c5a572]/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Chargement...":r?"Se connecter":"S'inscrire"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>i(!r),className:"text-[#c5a572] hover:text-[#e8cfa0] transition-colors",children:r?"Pas encore de compte ? S'inscrire":"Déjà un compte ? Se connecter"})})]})]})};function yr({onClose:h,onStart:u}){return e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(s.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"w-full max-w-4xl bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876] rounded-2xl p-8 border-2 border-[#c5a572]/30 relative shadow-2xl shadow-[#c5a572]/10",children:[e.jsx("button",{onClick:h,className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors",children:e.jsx(t,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(r,{className:"h-8 w-8 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(i,{className:"h-6 w-6 text-[#c5a572] absolute -bottom-2 -right-2 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Francis"}),e.jsx("p",{className:"text-sm text-[#c5a572]",children:"Assistant fiscal IA"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"})]})]}),e.jsx("div",{className:"bg-[#1a2942]/80 backdrop-blur-sm rounded-lg p-6 mb-4 max-h-[60vh] overflow-y-auto custom-scrollbar border border-[#c5a572]/20",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex gap-4",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(r,{className:"h-7 w-7 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(i,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-lg mb-2",children:"Salut Paul ! Pour optimiser ton IR 2025, confirme-moi :"}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 space-y-2 border border-[#c5a572]/20",children:[e.jsx("p",{className:"text-[#c5a572] font-medium",children:"• Revenu net imposable 2024 : 50 000 €"}),e.jsx("p",{className:"text-[#c5a572] font-medium",children:"• Situation : marié, 1 enfant à charge"}),e.jsx("p",{className:"text-[#c5a572] font-medium",children:"• Horizon : réduire IR maintenant, préparer retraite"})]})]})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center flex-shrink-0 border border-blue-500/30",children:e.jsx(n,{className:"w-5 h-5 text-blue-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-white text-lg",children:"C'est ça."})})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:1},className:"flex gap-4",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(r,{className:"h-7 w-7 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(i,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-lg mb-2",children:"Top, voici les 3 leviers les plus efficients pour ton profil :"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 hover:bg-white/15 transition-all cursor-pointer border border-[#c5a572]/20 hover:border-[#c5a572]/40 hover:shadow-lg hover:shadow-[#c5a572]/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(a,{className:"w-6 h-6 text-[#c5a572]"}),e.jsx("h4",{className:"text-[#c5a572] font-medium text-lg",children:"1. PER – Versement 8 000 €"})]}),e.jsxs("div",{className:"pl-8 space-y-1 text-sm text-gray-200",children:[e.jsx("p",{children:"• Déductible de ton revenu imposable → base passe de 50 000 € à 42 000 €"}),e.jsx("p",{children:"• Économie IR nette : 8 000 € × TMI 30 % = 2 400 €"})]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 hover:bg-white/15 transition-all cursor-pointer border border-[#c5a572]/20 hover:border-[#c5a572]/40 hover:shadow-lg hover:shadow-[#c5a572]/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(o,{className:"w-6 h-6 text-[#c5a572]"}),e.jsx("h4",{className:"text-[#c5a572] font-medium text-lg",children:"2. Pinel – Achat d'un T2 180 000 € (zone B1)"})]}),e.jsx("div",{className:"pl-8 space-y-1 text-sm text-gray-200",children:e.jsx("p",{children:"• Engagement locatif 6 ans → réduction 12 % répartie → 3 600 €/an"})})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 hover:bg-white/15 transition-all cursor-pointer border border-[#c5a572]/20 hover:border-[#c5a572]/40 hover:shadow-lg hover:shadow-[#c5a572]/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(l,{className:"w-6 h-6 text-[#c5a572]"}),e.jsx("h4",{className:"text-[#c5a572] font-medium text-lg",children:"3. Don – 1 000 € à une ONG"})]}),e.jsx("div",{className:"pl-8 space-y-1 text-sm text-gray-200",children:e.jsx("p",{children:"• Crédit d'impôt 66 % → 660 €"})})]})]}),e.jsx("div",{className:"mt-4 bg-[#c5a572]/10 rounded-lg p-4 border border-[#c5a572]/20",children:e.jsx("p",{className:"text-[#c5a572] font-medium",children:"Chaque option est cliquable pour voir le détail fiscal et le simulateur de cash-flow."})})]})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:1.5},className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center flex-shrink-0 border border-blue-500/30",children:e.jsx(n,{className:"w-5 h-5 text-blue-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-white text-lg",children:"Je veux tester un PER à 6 000 € seulement."})})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:2},className:"flex gap-4",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(r,{className:"h-7 w-7 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(i,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-lg mb-2",children:"D'accord. Avec 6 000 € de PER, ton économie passe à 1 800 € (6 000 × 30 %)."}),e.jsx("p",{className:"text-white text-lg mb-4",children:"Du coup, tes économies totales deviennent 1 800 + 3 600 + 660 = 6 060 €."}),e.jsx("div",{className:"bg-[#c5a572]/10 rounded-lg p-4 border border-[#c5a572]/20",children:e.jsx("p",{className:"text-[#c5a572] font-medium",children:"Veux-tu ajuster la durée Pinel ou le montant du don ?"})})]})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:2.5},className:"flex gap-4",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(r,{className:"h-7 w-7 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(i,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1 -right-1 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-white text-lg mb-2",children:"Voulez-vous que nous continuions avec votre inscription ? Je pourrai alors analyser vos données réelles et vous proposer des optimisations concrètes."})})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(s.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:u,className:"px-8 py-4 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#1a2942] font-bold rounded-xl hover:shadow-lg hover:shadow-[#c5a572]/20 transition-all transform flex items-center gap-2 text-lg",children:[e.jsx(c,{className:"w-6 h-6"}),"Commencer gratuitement",e.jsx(d,{className:"w-6 h-6"})]})})]})})}const wr={MONTHLY:{price:9.99,currency:"EUR",interval:"month",stripePriceId:"price_monthly",features:["Accès illimité à Francis","Conseils personnalisés","Sans engagement"]},ANNUAL:{price:99.99,currency:"EUR",interval:"year",stripePriceId:"price_annual",features:["Accès illimité à Francis","Conseils personnalisés","Sans engagement","Économisez 17%"]}};var jr={};class _r{constructor(){this.baseUrl=jr.REACT_APP_API_URL||"http://localhost:3000"}static getInstance(){return _r.instance||(_r.instance=new _r),_r.instance}async createCheckoutSession(e){try{const t=await fetch(`${this.baseUrl}/api/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:wr[e].stripePriceId,successUrl:`${window.location.origin}/success`,cancelUrl:`${window.location.origin}/pricing`})});if(!t.ok)throw new Error("Erreur lors de la création de la session de paiement");const{url:s}=await t.json();return s}catch(t){throw console.error("Erreur Stripe:",t),t}}async createPortalSession(){try{const e=await fetch(`${this.baseUrl}/api/create-portal-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({returnUrl:`${window.location.origin}/account`})});if(!e.ok)throw new Error("Erreur lors de la création de la session du portail");const{url:t}=await e.json();return t}catch(e){throw console.error("Erreur Stripe:",e),e}}}function kr({message:t}){return t?e.jsx("div",{className:"mt-4 p-4 bg-red-500/10 border border-red-500/20 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx(h,{className:"h-5 w-5"}),e.jsx("p",{className:"text-sm font-medium",children:t})]})}):null}function Nr(){const[t,a]=A.useState(!1),[o,l]=A.useState(!1),{handleCheckout:h,isLoading:g,error:x}=(()=>{const[e,t]=A.useState(!1),[s,r]=A.useState(null),i=_r.getInstance();return{handleCheckout:async e=>{try{t(!0),r(null);const s=await i.createCheckoutSession(e);window.location.href=s}catch(s){r(s instanceof Error?s.message:"Une erreur est survenue")}finally{t(!1)}},handlePortal:async()=>{try{t(!0),r(null);const e=await i.createPortalSession();window.location.href=e}catch(e){r(e instanceof Error?e.message:"Une erreur est survenue")}finally{t(!1)}},isLoading:e,error:s}})();return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876]",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 bg-[#1a2942]/95 backdrop-blur-sm border-b border-[#234876] z-30",children:e.jsx("div",{className:"h-16 max-w-7xl mx-auto px-4 flex items-center justify-center",children:e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(r,{className:"h-10 w-10 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(i,{className:"h-7 w-7 text-[#c5a572] absolute -bottom-2 -right-2 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]})})}),t&&e.jsx(br,{onClose:()=>a(!1)}),o&&e.jsx(yr,{onClose:()=>l(!1),onStart:()=>{l(!1),a(!0)}}),e.jsxs("section",{className:"min-h-screen flex flex-col items-center justify-center px-4 pt-40 pb-20 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute inset-0 opacity-5",style:{backgroundImage:"radial-gradient(circle, #c5a572 1px, transparent 1px)",backgroundSize:"30px 30px"}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#1a2942]/95 via-[#223c63]/85 to-[#234876]/75",children:e.jsx("div",{className:"absolute inset-0 opacity-30",children:e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gradient-to-br from-[#c5a572]/20 via-transparent to-transparent animate-pulse"})})})]}),e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:[...Array(20)].map(((t,r)=>e.jsx(s.div,{className:"absolute rounded-full bg-[#c5a572]",initial:{opacity:0,scale:0},animate:{opacity:[.3,.6,.3],scale:[1,1.2,1],x:[0,100*Math.random()-50],y:[0,100*Math.random()-50]},transition:{duration:3+2*Math.random(),repeat:1/0,delay:2*Math.random()},style:{width:2+3*Math.random()+"px",height:2+3*Math.random()+"px",top:100*Math.random()+"%",left:100*Math.random()+"%",boxShadow:"0 0 10px #c5a572"}},r)))}),e.jsxs("div",{className:"max-w-6xl mx-auto text-center relative z-10",children:[e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8",children:[e.jsx(s.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},children:e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-16 leading-tight",children:["Optimisez votre fiscalité avec"," ",e.jsxs("span",{className:"relative inline-block text-[#c5a572]",children:["Francis",e.jsx(s.span,{className:"absolute -bottom-2 left-0 w-full h-1 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] rounded-full",initial:{scaleX:0},animate:{scaleX:1},transition:{duration:.5,delay:.5}})]})]})}),e.jsxs("p",{className:"text-xl md:text-2xl text-gray-300 mb-12 max-w-3xl mx-auto leading-relaxed",children:["Votre assistant fiscal intelligent qui vous aide à"," ",e.jsx("span",{className:"text-[#c5a572] font-semibold",children:"optimiser vos impôts"})," et à prendre les meilleures décisions financières."]})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},className:"flex flex-col sm:flex-row gap-4 justify-center mb-16",children:[e.jsxs(s.button,{onClick:()=>a(!0),whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-8 py-4 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#1a2942] font-bold rounded-xl hover:shadow-lg hover:shadow-[#c5a572]/20 transition-all transform flex items-center justify-center gap-2",children:[e.jsx(c,{className:"w-5 h-5"}),"Se connecter",e.jsx(d,{className:"w-5 h-5"})]}),e.jsxs(s.button,{whileHover:{scale:1.05},onClick:()=>l(!0),className:"px-8 py-4 bg-white/10 text-white font-bold rounded-xl hover:bg-white/20 transition-all transform flex items-center justify-center gap-2",children:["Voir la démo",e.jsx(d,{className:"w-5 h-5"})]})]}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.6},className:"flex flex-wrap justify-center gap-6 opacity-70 mb-16",children:[e.jsxs(s.div,{whileHover:{scale:1.05},className:"px-4 py-2 bg-white/5 rounded-lg backdrop-blur-sm border border-white/10 flex items-center",children:[e.jsx(u,{className:"h-4 w-4 text-[#c5a572] mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"100% Sécurisé"})]}),e.jsxs(s.div,{whileHover:{scale:1.05},className:"px-4 py-2 bg-white/5 rounded-lg backdrop-blur-sm border border-white/10 flex items-center",children:[e.jsx(n,{className:"h-4 w-4 text-[#c5a572] mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"+1000 Utilisateurs"})]}),e.jsxs(s.div,{whileHover:{scale:1.05},className:"px-4 py-2 bg-white/5 rounded-lg backdrop-blur-sm border border-white/10 flex items-center",children:[e.jsx(m,{className:"h-4 w-4 text-[#c5a572] mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"IA de pointe"})]})]})]})]}),e.jsx("section",{className:"py-20 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs(s.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.8},className:"text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold text-white mb-6",children:["Pourquoi choisir"," ",e.jsxs("span",{className:"relative inline-block text-[#c5a572]",children:["Francis",e.jsx(s.span,{className:"absolute -bottom-2 left-0 w-full h-1 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] rounded-full",initial:{scaleX:0},animate:{scaleX:1},transition:{duration:.5,delay:.5}})]})," ","?"]}),e.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"Une solution complète pour gérer vos finances et optimiser votre fiscalité"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx(s.div,{initial:{opacity:0,x:-20},whileInView:{opacity:1,x:0},viewport:{once:!0},transition:{duration:.8},className:"bg-white/5 backdrop-blur-sm rounded-2xl p-8 border border-[#c5a572]/20",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-[#c5a572]/20 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(p,{className:"w-6 h-6 text-[#c5a572]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Analyse des dépenses"}),e.jsx("p",{className:"text-gray-300",children:"Visualisez instantanément où va votre argent et identifiez les opportunités d'optimisation fiscale dans votre interface connectée."})]})]})}),e.jsx(s.div,{initial:{opacity:0,x:20},whileInView:{opacity:1,x:0},viewport:{once:!0},transition:{duration:.8},className:"bg-white/5 backdrop-blur-sm rounded-2xl p-8 border border-[#c5a572]/20",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-[#c5a572]/20 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(n,{className:"w-6 h-6 text-[#c5a572]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Personnalisation"}),e.jsx("p",{className:"text-gray-300",children:"Des recommandations adaptées à votre situation personnelle et professionnelle."}),e.jsx("p",{className:"text-[#c5a572] font-medium italic mt-2",children:"Francis explique, vous décidez !"})]})]})})]})]})}),e.jsx("section",{className:"py-20 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs(s.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.8},className:"text-center mb-16",children:[e.jsxs("h2",{className:"text-4xl font-bold text-white mb-6",children:["Une offre unique, des résultats"," ",e.jsxs("span",{className:"relative inline-block text-[#c5a572]",children:["concrets",e.jsx(s.span,{className:"absolute -bottom-2 left-0 w-full h-1 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] rounded-full",initial:{scaleX:0},animate:{scaleX:1},transition:{duration:.5,delay:.5}})]})]}),e.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"Accédez à toutes les fonctionnalités pour optimiser votre fiscalité"})]}),e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(s.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.8},className:"bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876] rounded-2xl shadow-2xl overflow-hidden border border-[#c5a572]/30",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#1a2942] to-[#223c63] px-8 py-10 border-b border-[#c5a572]/30",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-6",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(r,{className:"h-12 w-12 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(i,{className:"h-8 w-8 text-[#c5a572] absolute -bottom-2 -right-2 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-3xl font-bold text-white",children:"Francis"}),e.jsx("p",{className:"text-xl text-gray-300",children:"Votre conseiller fiscal propulsé par IA"})]})]})}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6 mb-8",children:[e.jsxs("h4",{className:"text-xl font-semibold text-white mb-6 flex items-center",children:[e.jsx(m,{className:"w-6 h-6 mr-3 text-[#c5a572]"}),"Tout est inclus"]}),e.jsxs("ul",{className:"space-y-6",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#c5a572]/20 flex items-center justify-center mr-3 mt-1 flex-shrink-0",children:e.jsx(f,{className:"w-4 h-4 text-[#c5a572]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[#c5a572] font-medium mb-1",children:"Analyse complète de vos transactions"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Récupération sécurisée via connexion bancaire PSD2 pour un audit financier exhaustif."})]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#c5a572]/20 flex items-center justify-center mr-3 mt-1 flex-shrink-0",children:e.jsx(f,{className:"w-4 h-4 text-[#c5a572]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[#c5a572] font-medium mb-1",children:"Détection automatique des optimisations"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Notre IA fiscaliste analyse vos données et identifie instantanément les leviers fiscaux les plus efficaces."})]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#c5a572]/20 flex items-center justify-center mr-3 mt-1 flex-shrink-0",children:e.jsx(f,{className:"w-4 h-4 text-[#c5a572]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[#c5a572] font-medium mb-1",children:"Recommandations personnalisées"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Stratégies sur-mesure (PER, Pinel, dons…) générées selon votre profil et vos objectifs."})]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#c5a572]/20 flex items-center justify-center mr-3 mt-1 flex-shrink-0",children:e.jsx(f,{className:"w-4 h-4 text-[#c5a572]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[#c5a572] font-medium mb-1",children:"Mises à jour régulières"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Dispositifs fiscaux et plafonds automatiquement actualisés dès chaque changement législatif."})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6 hover:bg-[#1a2942]/60 transition-all duration-200 transform hover:scale-105",children:e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-3xl font-bold text-[#c5a572]",children:"9,99€"}),e.jsx("p",{className:"text-gray-300",children:"par mois"})]})}),e.jsxs("div",{className:"bg-[#c5a572]/10 rounded-xl border border-[#c5a572]/30 p-6 relative hover:bg-[#c5a572]/20 transition-all duration-200 transform hover:scale-105",children:[e.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#1a2942] px-6 py-2 rounded-full text-sm font-bold shadow-lg shadow-[#c5a572]/20",children:"Économisez 17%"}),e.jsxs("div",{className:"text-center mb-4 mt-4",children:[e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("p",{className:"text-3xl font-bold text-[#c5a572]",children:"99,99€"})}),e.jsx("p",{className:"text-gray-300",children:"par an"}),e.jsx("p",{className:"text-sm text-gray-400 line-through mt-1",children:"119,88€"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsx("button",{onClick:()=>h("MONTHLY"),disabled:g,className:"w-full px-6 py-3 bg-white/10 text-white font-bold rounded-xl hover:bg-white/20 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Chargement...":"Choisir mensuel"}),e.jsx("button",{onClick:()=>h("ANNUAL"),disabled:g,className:"w-full px-6 py-3 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#1a2942] font-bold rounded-xl hover:shadow-lg hover:shadow-[#c5a572]/20 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Chargement...":"Choisir annuel"}),e.jsx("button",{onClick:()=>a(!0),className:"w-full px-6 py-3 bg-[#1a2942] text-white font-bold rounded-xl border border-[#c5a572]/30 hover:bg-[#1a2942]/80 transition-all transform hover:scale-105",children:"Se connecter"})]}),e.jsx(kr,{message:x||""}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-400 flex items-center justify-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"Sans engagement • Annulation à tout moment • Paiement sécurisé"]})})]})]})})]})}),e.jsx("section",{className:"py-20 px-4",children:e.jsx("div",{className:"max-w-4xl mx-auto text-center",children:e.jsxs(s.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.8},className:"bg-gradient-to-br from-[#1a2942] to-[#234876] rounded-2xl p-12 border border-[#c5a572]/20",children:[e.jsxs("h2",{className:"text-4xl font-bold text-white mb-6",children:["Prêt à"," ",e.jsxs("span",{className:"relative inline-block text-[#c5a572]",children:["optimiser",e.jsx(s.span,{className:"absolute -bottom-2 left-0 w-full h-1 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] rounded-full",initial:{scaleX:0},animate:{scaleX:1},transition:{duration:.5,delay:.5}})]})," ","votre fiscalité ?"]}),e.jsx("p",{className:"text-xl text-gray-300 mb-8 max-w-2xl mx-auto",children:"Rejoignez des milliers d'utilisateurs qui font confiance à Francis pour leurs finances."}),e.jsx("button",{onClick:()=>a(!0),className:"px-8 py-4 bg-gradient-to-r from-[#c5a572] to-[#e8cfa0] text-[#1a2942] font-bold rounded-xl hover:shadow-lg hover:shadow-[#c5a572]/20 transition-all transform hover:scale-105",children:"Commencer gratuitement"})]})})})]})}function Sr(){const[t,n]=A.useState(!0),[o,l]=A.useState(""),[c,d]=A.useState(!1),[h,u]=A.useState([{role:"assistant",content:"Bonjour ! Je suis Francis, votre conseiller fiscal IA 🤖\n\nJe peux vous aider à :\n• Optimiser vos impôts\n• Analyser vos documents fiscaux\n• Répondre à vos questions sur la fiscalité\n\nPosez-moi votre question ou choisissez un parcours :\n1. 🎯 Parcours guidé\n2. 💬 Chat libre\n\nVoici quelques questions que vous pouvez me poser :\n• Comment optimiser ma déclaration d'impôts ?\n• Quelles sont les meilleures stratégies de défiscalisation ?\n• Comment gérer ma TVA en tant qu'auto-entrepreneur ?\n• Quels sont les avantages fiscaux pour les investissements immobiliers ?\n\nJe suis là pour vous accompagner ! 💡"}]),[m,f]=A.useState("home"),[E,P]=A.useState({situation:"",revenus:"",patrimoine:"",objectifs:[],toleranceRisque:"",horizonInvestissement:"",nombreEnfants:0,agesEnfants:"",typeRevenus:[],autresRevenus:"",situationProfessionnelle:"",statutFiscal:"",regimeImposition:"",investissementsExistants:[],projetsImmobiliers:"",besoinsRetraite:"",situationFamiliale:"",localisation:"",zoneFiscale:"",secteurActivite:"",revenusPassifs:"",dettes:"",objectifsFinanciers:[],contraintesFiscales:[],compositionPatrimoine:[],is_active:!1}),[C,O]=A.useState(!1),[I,R]=A.useState("libre"),[$,L]=A.useState(null),[U,D]=A.useState(!1),[q,z]=A.useState([]),[F,M]=A.useState(null),[B,J]=A.useState(!1),[V,G]=A.useState([]),[H,K]=A.useState(!1),W=()=>{const e=["situationFamiliale","nombreEnfants","localisation","zoneFiscale","situationProfessionnelle","secteurActivite","regimeImposition","statutFiscal","revenus","typeRevenus","patrimoine","compositionPatrimoine","investissementsExistants","projetsImmobiliers","besoinsRetraite","horizonInvestissement","toleranceRisque","objectifs","contraintesFiscales"],t=e.filter((e=>{const t=E[e];return Array.isArray(t)?t.length>0:void 0!==t&&""!==t}));return Math.round(t.length/e.length*100)};A.useEffect((()=>{(async()=>{const{data:{user:e}}=await xr.auth.getUser();e&&(L(e.id),await Q(e.id))})()}),[]);const Q=async e=>{try{const{data:t,error:s}=await xr.from("user_profiles").select("*").eq("user_id",e).single();if(s)throw s;if(t&&(P(t),O(!0),t.interaction_history)){const e=t.interaction_history.map((e=>({role:"assistant",content:`Q: ${e.question}\nR: ${e.response}`})));u(e)}}catch(t){console.error("Erreur lors du chargement du profil:",t)}},X=async e=>{if(e.preventDefault(),!o.trim()||!$)return;d(!0);const t=o;l(""),u((e=>[...e,{role:"user",content:t}]));try{const e=await fetch("http://localhost:8080/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:t,profile:E,chatMode:I,userId:$,context:h.slice(-5).map((e=>({role:e.role,content:e.content})))})});if(!e.ok)throw new Error(`Erreur ${e.status}: ${e.statusText}`);const s=await e.json();s.suggestedPath?(e=>{let t="";switch(e){case"optimisation":t="Parfait ! Commençons l'optimisation de votre fiscalité. 🎯\n\nPour vous accompagner au mieux, j'ai besoin de quelques informations :\n1. Quel est votre statut fiscal actuel ?\n2. Quels sont vos principaux revenus ?\n3. Avez-vous des investissements en cours ?\n\nVous pouvez répondre à ces questions dans l'ordre qui vous convient.";break;case"documents":t="Très bien ! Analysons vos documents fiscaux. 📄\n\nVous pouvez :\n1. Partager vos avis d'imposition\n2. Télécharger vos justificatifs\n3. Me poser des questions sur vos documents\n\nJe vous guiderai dans l'analyse et l'optimisation de votre situation.";break;case"conseil":t="Excellent choix ! Je vais vous donner des conseils personnalisés. 💡\n\nPour vous conseiller au mieux, dites-moi :\n1. Quels sont vos objectifs fiscaux ?\n2. Avez-vous des projets spécifiques ?\n3. Quel est votre horizon d'investissement ?\n\nJe vous aiderai à atteindre vos objectifs."}u((e=>[...e,{role:"assistant",content:t}]))})(s.suggestedPath):u((e=>[...e,{role:"assistant",content:s.response}])),s.insights&&await(async(e,t,s)=>{if($)try{const{data:r}=await xr.from("user_profiles").select("*").eq("user_id",$).single();if(!r)return;const i={...r};s.forEach((e=>{e.confidence>.8&&(i[e.type]=e.value)}));const n={role:"assistant",content:`Q: ${e}\nR: ${t}`};i.interaction_history=[...r.interaction_history||[],n].slice(-50);const{error:a}=await xr.from("user_profiles").update(i).eq("user_id",$);if(a)throw a;P(i)}catch(r){console.error("Erreur lors de la mise à jour du profil:",r)}})(t,s.response,s.insights)}catch(s){console.error("Erreur:",s),u((e=>[...e,{role:"assistant",content:"Oups ! Je rencontre une difficulté technique. 🤔\n\nVoici ce que vous pouvez faire :\n1. Vérifiez votre connexion internet\n2. Rafraîchissez la page\n3. Réessayez dans quelques instants\n\nSi le problème persiste, vous pouvez :\n• Me reposer votre question différemment\n• Choisir une autre question parmi les suggestions\n• Me contacter via le support si le problème persiste\n\nJe m'excuse pour ce désagrément et reste à votre disposition ! 🙏"}]))}finally{d(!1)}},Y=async(e,t="document")=>{if(!e)return;J(!0);const s={name:e.name,type:e.type,status:"processing"};G((e=>[...e,s]));try{const s=new FormData;s.append("file",e),s.append("userId",$||""),s.append("type",t);const r=await fetch("http://localhost:8000/process-document",{method:"POST",body:s});if(!r.ok)throw new Error("Erreur lors du traitement du document");const i=await r.json();G((t=>t.map((t=>t.name===e.name?{...t,status:"success",data:i}:t))));let n="";n="tva"===t?`J'ai analysé votre ticket TVA "${e.name}". Voici les informations :\n\n• Montant HT: ${i.montantHT}€\n• TVA: ${i.tva}€\n• Montant TTC: ${i.montantTTC}€\n• Date: ${i.date}\n• Numéro de ticket: ${i.numeroTicket}\n\nLe ticket a été enregistré pour votre déclaration de TVA.`:"frais"===t?`J'ai analysé votre note de frais "${e.name}". Voici les informations :\n\n• Montant: ${i.montant}€\n• Catégorie: ${i.categorie}\n• Date: ${i.date}\n• Description: ${i.description}\n\nLa note de frais a été enregistrée pour votre déclaration.`:`J'ai analysé votre document "${e.name}". Voici les informations importantes :\n\n`+Object.entries(i).map((([e,t])=>`• ${e}: ${t}`)).join("\n"),u((e=>[...e,{role:"assistant",content:n}])),f("chat")}catch(r){console.error("Erreur OCR:",r),G((t=>t.map((t=>t.name===e.name?{...t,status:"error"}:t))))}finally{J(!1)}},Z=()=>{const{situation:e,revenus:t,patrimoine:s,objectifs:r,toleranceRisque:i,horizonInvestissement:n}=E;let a=[],o=[];return"marie"!==e&&"pacs"!==e||(a.push("Optimisation du quotient familial"),o.push("Déclaration commune pour optimiser les tranches d'imposition")),"50k-100k"===t?(a.push("Optimisation de la TMI avec le PER"),o.push("Défiscalisation via l'investissement locatif")):"100k-200k"===t?(a.push("Mise en place d'une holding"),o.push("Optimisation IS/IR")):">200k"===t&&(a.push("Stratégie de défiscalisation globale"),o.push("Optimisation des niches fiscales")),"100k-300k"===s?(a.push("Diversification patrimoniale"),o.push("Investissement en SCPI")):"300k-500k"===s?(a.push("Stratégie de transmission anticipée"),o.push("Optimisation des droits de succession")):"500k-1M"!==s&&">1M"!==s||(a.push("Stratégie patrimoniale globale"),o.push("Optimisation fiscale multi-supports")),(null==r?void 0:r.includes("retraite"))?(a.push("PER et assurance vie"),o.push("Défiscalisation retraite")):(null==r?void 0:r.includes("patrimoine"))?(a.push("Donation progressive"),o.push("Optimisation des abattements")):(null==r?void 0:r.includes("investissement"))?(a.push("Mix d'investissements défiscalisés"),o.push("Optimisation des plus-values")):(null==r?void 0:r.includes("protection"))&&(a.push("Assurance décès et invalidité"),o.push("Protection du conjoint et des enfants")),"conservateur"===i?(a.push("Investissements défiscalisés sécurisés"),o.push("SCPI de rendement")):"modere"===i?(a.push("Mix d'investissements équilibré"),o.push("Diversification multi-supports")):"dynamique"===i&&(a.push("Investissements à fort potentiel"),o.push("Optimisation des plus-values")),"court"===n?(a.push("Investissements liquides"),o.push("Optimisation court terme")):"moyen"===n?(a.push("Investissements mixtes"),o.push("Diversification temporelle")):"long"===n&&(a.push("Investissements de long terme"),o.push("Optimisation transmission")),{recommendations:a,opportunities:o}};return E&&!1===E.is_active?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876]",children:e.jsxs("div",{className:"bg-[#1a2942]/80 p-8 rounded-2xl shadow-xl border border-[#c5a572]/30 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-[#c5a572] mb-4",children:"Compte en attente d'activation"}),e.jsx("p",{className:"text-white mb-2",children:"Votre compte n'est pas encore activé."}),e.jsx("p",{className:"text-gray-300",children:"Merci de finaliser votre paiement pour accéder à toutes les fonctionnalités."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876]",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 bg-[#1a2942]/95 backdrop-blur-sm border-b border-[#234876] z-30",children:e.jsxs("div",{className:"h-16 max-w-7xl mx-auto px-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3 group",children:e.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[e.jsx(r,{className:"h-7 w-7 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(i,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1.5 -right-1.5 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>f("home"),className:"px-4 py-2 rounded-lg transition-colors "+("home"===m?"bg-[#c5a572] text-[#1a2942]":"text-gray-300 hover:bg-white/5"),children:e.jsxs("span",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-5 h-5"}),e.jsx("span",{children:"Tableau de bord"})]})}),e.jsx("button",{onClick:()=>f("chat"),className:"px-4 py-2 rounded-lg transition-colors "+("chat"===m?"bg-[#c5a572] text-[#1a2942]":"text-gray-300 hover:bg-white/5"),children:e.jsxs("span",{className:"flex items-center space-x-2",children:[e.jsx(r,{className:"w-5 h-5"}),e.jsx("span",{children:"Chat"})]})}),e.jsx("button",{onClick:()=>f("analytics"),className:"px-4 py-2 rounded-lg transition-colors "+("analytics"===m?"bg-[#c5a572] text-[#1a2942]":"text-gray-300 hover:bg-white/5"),children:e.jsxs("span",{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"w-5 h-5"}),e.jsx("span",{children:"Analytics"})]})}),e.jsx("button",{onClick:()=>f("settings"),className:"px-4 py-2 rounded-lg transition-colors "+("settings"===m?"bg-[#c5a572] text-[#1a2942]":"text-gray-300 hover:bg-white/5"),children:e.jsxs("span",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"w-5 h-5"}),e.jsx("span",{children:"Paramètres"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#c5a572] flex items-center justify-center",children:e.jsx(v,{className:"w-6 h-6 text-[#1a2942]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Utilisateur"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Voir le profil"})]})]})]})}),e.jsx("main",{className:"pt-16 min-h-[calc(100vh-theme(spacing.16)-theme(spacing.16))]",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(b,{mode:"wait",children:["home"===m&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876] rounded-2xl shadow-2xl overflow-hidden border border-[#c5a572]/30",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#1a2942] to-[#223c63] px-8 py-10 border-b border-[#c5a572]/30",children:e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#c5a572] flex items-center justify-center",children:e.jsx(g,{className:"w-10 h-10 text-[#1a2942]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-white",children:"Bienvenue chez Francis"}),e.jsx("p",{className:"text-xl text-gray-300",children:"Votre conseiller fiscal propulsé par intelligence artificielle"})]})]})}),e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{onClick:()=>f("profile"),className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6 cursor-pointer hover:bg-[#1a2942]/60 transition-all duration-200 transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-[#c5a572] flex items-center justify-center",children:e.jsx(g,{className:"w-6 h-6 text-[#1a2942]"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Profil Fiscal"})]}),e.jsx("p",{className:"text-gray-400",children:"Gérez votre profil et vos informations fiscales"}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-300 mb-2",children:[e.jsx("span",{children:"Progression"}),e.jsxs("span",{className:"text-[#c5a572] font-semibold",children:[W(),"%"]})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#c5a572] to-[#d4b583] transition-all duration-500 ease-out",style:{width:`${W()}%`}})})]})]}),e.jsxs("div",{onClick:()=>f("chat"),className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6 cursor-pointer hover:bg-[#1a2942]/60 transition-all duration-200 transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-[#c5a572] flex items-center justify-center",children:e.jsx(r,{className:"w-6 h-6 text-[#1a2942]"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Chat avec Francis"})]}),e.jsx("p",{className:"text-gray-400",children:"Posez vos questions et obtenez des conseils personnalisés"})]}),e.jsxs("div",{onClick:()=>f("analytics"),className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6 cursor-pointer hover:bg-[#1a2942]/60 transition-all duration-200 transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-[#c5a572] flex items-center justify-center",children:e.jsx(p,{className:"w-6 h-6 text-[#1a2942]"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Analytics"})]}),e.jsx("p",{className:"text-gray-400",children:"Suivez vos performances et optimisations fiscales"})]}),e.jsxs("div",{onClick:()=>f("settings"),className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6 cursor-pointer hover:bg-[#1a2942]/60 transition-all duration-200 transform hover:scale-105",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-[#c5a572] flex items-center justify-center",children:e.jsx(x,{className:"w-6 h-6 text-[#1a2942]"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Paramètres"})]}),e.jsx("p",{className:"text-gray-400",children:"Configurez vos préférences et notifications"})]})]})})]},"home"),"profile"===m&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876] rounded-2xl shadow-2xl overflow-hidden border border-[#c5a572]/30",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#1a2942] to-[#223c63] px-8 py-10 border-b border-[#c5a572]/30",children:[e.jsxs("h1",{className:"text-4xl font-bold text-white mb-6 flex items-center",children:[e.jsx(g,{className:"w-10 h-10 mr-4 text-[#c5a572]"}),"Votre Profil Fiscal"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Progression du profil"}),e.jsxs("span",{className:"text-[#c5a572] font-semibold",children:[W(),"%"]})]}),e.jsx("div",{className:"h-3 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#c5a572] to-[#d4b583] transition-all duration-500 ease-out",style:{width:`${W()}%`}})})]})]}),e.jsx("div",{className:"p-8",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),$){d(!0);try{await(async e=>{if($)try{const{error:t}=await xr.from("user_profiles").upsert({user_id:$,...e,updated_at:(new Date).toISOString()});if(t)throw t}catch(t){console.error("Erreur lors de la sauvegarde du profil:",t)}})(E),O(!0);const{recommendations:e,opportunities:t}=Z(),s=`Bonjour ! Je suis Francis, votre conseiller fiscal propulsé par intelligence artificielle. \n\nBasé sur votre profil, je peux vous aider à optimiser votre fiscalité. Voici mes premières recommandations :\n\n${e.map((e=>`• ${e}`)).join("\n")}\n\nOpportunités identifiées :\n${t.map((e=>`• ${e}`)).join("\n")}\n\nPosez-moi des questions spécifiques pour en savoir plus sur ces recommandations.`;u((e=>[...e,{role:"assistant",content:s}])),f("chat")}catch(t){console.error("Erreur lors de la sauvegarde du profil:",t)}finally{d(!1)}}},className:"space-y-10",children:[e.jsxs("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 overflow-hidden shadow-lg",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#1a2942] to-[#223c63] px-8 py-6 border-b border-[#c5a572]/30",children:e.jsxs("h2",{className:"text-2xl font-semibold text-white flex items-center",children:[e.jsx(g,{className:"w-8 h-8 mr-4 text-[#c5a572]"}),"Situation Personnelle"]})}),e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:["Situation Familiale",e.jsx("span",{className:"text-[#c5a572] ml-1",children:"*"})]}),e.jsxs("select",{value:E.situationFamiliale,onChange:e=>P({...E,situationFamiliale:e.target.value}),className:"w-full rounded-lg bg-[#1a2942]/60 border border-[#c5a572]/30 text-white focus:border-[#c5a572] focus:ring-[#c5a572] px-4 py-3",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez votre situation"}),e.jsx("option",{value:"celibataire",children:"Célibataire"}),e.jsx("option",{value:"marie",children:"Marié(e)"}),e.jsx("option",{value:"pacs",children:"PACS"}),e.jsx("option",{value:"divorce",children:"Divorcé(e)"}),e.jsx("option",{value:"veuf",children:"Veuf(ve)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:["Nombre d'Enfants",e.jsx("span",{className:"text-[#c5a572] ml-1",children:"*"})]}),e.jsx("input",{type:"number",value:E.nombreEnfants,onChange:e=>P({...E,nombreEnfants:parseInt(e.target.value)}),className:"w-full rounded-lg bg-[#1a2942]/60 border border-[#c5a572]/30 text-white focus:border-[#c5a572] focus:ring-[#c5a572] px-4 py-3",min:"0",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:["Localisation",e.jsx("span",{className:"text-[#c5a572] ml-1",children:"*"})]}),e.jsx("input",{type:"text",value:E.localisation,onChange:e=>P({...E,localisation:e.target.value}),className:"w-full rounded-lg bg-[#1a2942]/60 border border-[#c5a572]/30 text-white focus:border-[#c5a572] focus:ring-[#c5a572] px-4 py-3",placeholder:"Ville, département",required:!0})]})]})]}),e.jsxs("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 overflow-hidden shadow-lg",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#1a2942] to-[#223c63] px-8 py-6 border-b border-[#c5a572]/30",children:e.jsxs("h2",{className:"text-2xl font-semibold text-white flex items-center",children:[e.jsx(y,{className:"w-8 h-8 mr-4 text-[#c5a572]"}),"Situation Professionnelle"]})}),e.jsx("div",{className:"p-8 space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:["Statut Professionnel",e.jsx("span",{className:"text-[#c5a572] ml-1",children:"*"})]}),e.jsxs("select",{value:E.situationProfessionnelle,onChange:e=>P({...E,situationProfessionnelle:e.target.value}),className:"w-full rounded-lg bg-[#1a2942]/60 border border-[#c5a572]/30 text-white focus:border-[#c5a572] focus:ring-[#c5a572] px-4 py-3",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez votre statut"}),e.jsx("option",{value:"salarie",children:"Salarié"}),e.jsx("option",{value:"independant",children:"Indépendant"}),e.jsx("option",{value:"retraite",children:"Retraité"}),e.jsx("option",{value:"chomeur",children:"Chômeur"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:["Secteur d'Activité",e.jsx("span",{className:"text-[#c5a572] ml-1",children:"*"})]}),e.jsx("input",{type:"text",value:E.secteurActivite,onChange:e=>P({...E,secteurActivite:e.target.value}),className:"w-full rounded-lg bg-[#1a2942]/60 border border-[#c5a572]/30 text-white focus:border-[#c5a572] focus:ring-[#c5a572] px-4 py-3",placeholder:"Ex: Informatique, Santé, etc.",required:!0})]})]})})]}),e.jsxs("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 overflow-hidden shadow-lg",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#1a2942] to-[#223c63] px-8 py-6 border-b border-[#c5a572]/30",children:e.jsxs("h2",{className:"text-2xl font-semibold text-white flex items-center",children:[e.jsx(w,{className:"w-8 h-8 mr-4 text-[#c5a572]"}),"Situation Fiscale"]})}),e.jsx("div",{className:"p-8 space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:["Régime d'Imposition",e.jsx("span",{className:"text-[#c5a572] ml-1",children:"*"})]}),e.jsxs("select",{value:E.regimeImposition,onChange:e=>P({...E,regimeImposition:e.target.value}),className:"w-full rounded-lg bg-[#1a2942]/60 border border-[#c5a572]/30 text-white focus:border-[#c5a572] focus:ring-[#c5a572] px-4 py-3",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez votre régime"}),e.jsx("option",{value:"micro",children:"Micro-entreprise"}),e.jsx("option",{value:"reel",children:"Régime réel"}),e.jsx("option",{value:"auto",children:"Auto-entrepreneur"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:["Zone Fiscale",e.jsx("span",{className:"text-[#c5a572] ml-1",children:"*"})]}),e.jsxs("select",{value:E.zoneFiscale,onChange:e=>P({...E,zoneFiscale:e.target.value}),className:"w-full rounded-lg bg-[#1a2942]/60 border border-[#c5a572]/30 text-white focus:border-[#c5a572] focus:ring-[#c5a572] px-4 py-3",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez votre zone"}),e.jsx("option",{value:"zone1",children:"Zone 1"}),e.jsx("option",{value:"zone2",children:"Zone 2"}),e.jsx("option",{value:"zone3",children:"Zone 3"})]})]})]})})]}),e.jsxs("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 overflow-hidden shadow-lg",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#1a2942] to-[#223c63] px-8 py-6 border-b border-[#c5a572]/30",children:e.jsxs("h2",{className:"text-2xl font-semibold text-white flex items-center",children:[e.jsx(j,{className:"w-8 h-8 mr-4 text-[#c5a572]"}),"Patrimoine et Investissements"]})}),e.jsx("div",{className:"p-8 space-y-8",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-4",children:["Composition du Patrimoine",e.jsx("span",{className:"text-[#c5a572] ml-1",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["Immobilier","Actions","Obligations","Assurance-vie","SCPI"].map((t=>{var s;return e.jsxs("label",{className:"flex items-center space-x-3 p-3 rounded-lg bg-[#1a2942]/60 border border-[#c5a572]/30 hover:bg-[#1a2942]/80 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:(null==(s=E.compositionPatrimoine)?void 0:s.includes(t))||!1,onChange:e=>{const s=e.target.checked?[...E.compositionPatrimoine||[],t]:(E.compositionPatrimoine||[]).filter((e=>e!==t));P({...E,compositionPatrimoine:s})},className:"h-5 w-5 text-[#c5a572] focus:ring-[#c5a572] border-[#c5a572]/30 rounded bg-[#1a2942]/60"}),e.jsx("span",{className:"text-gray-300 font-medium",children:t})]},t)}))})]})})]}),e.jsxs("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 overflow-hidden shadow-lg",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#1a2942] to-[#223c63] px-8 py-6 border-b border-[#c5a572]/30",children:e.jsxs("h2",{className:"text-2xl font-semibold text-white flex items-center",children:[e.jsx(_,{className:"w-8 h-8 mr-4 text-[#c5a572]"}),"Objectifs"]})}),e.jsx("div",{className:"h-[calc(100vh-16rem)] overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-6",children:h.map(((t,s)=>e.jsx("div",{className:"flex "+("user"===t.role?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-[80%] rounded-2xl p-4 "+("user"===t.role?"bg-[#c5a572] text-[#1a2942]":"bg-white/5 text-white"),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:["assistant"===t.role&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#c5a572] flex items-center justify-center",children:e.jsx(r,{className:"w-4 h-4 text-[#1a2942]"})}),e.jsx("span",{className:"text-sm font-medium",children:"user"===t.role?"Vous":"Francis"})]}),e.jsx("div",{className:"prose prose-invert max-w-none",children:t.content.split("\n").map(((t,s)=>e.jsx("p",{className:"mb-2 last:mb-0",children:t},s)))})]})},s)))})})]})]})})]},"profile"),"chat"===m&&e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-[#1a2942]/95 backdrop-blur-lg rounded-2xl shadow-xl overflow-hidden border border-[#c5a572]/20 h-[calc(100vh-12rem)] flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#1a2942] to-[#223c63] px-6 py-4 border-b border-[#c5a572]/20",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center group",children:[e.jsx(r,{className:"h-7 w-7 text-[#c5a572] transition-transform group-hover:scale-110"}),e.jsx(i,{className:"h-5 w-5 text-[#c5a572] absolute -bottom-1.5 -right-1.5 bg-[#1a2942] rounded-full p-0.5 transition-transform group-hover:scale-110"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Francis"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Conseiller fiscal propulsé par IA"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:h.map(((t,i)=>e.jsx(s.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex "+("user"===t.role?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-[80%] rounded-2xl p-4 "+("user"===t.role?"bg-[#c5a572] text-[#1a2942]":"bg-white/5 text-white"),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:["assistant"===t.role&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#c5a572] flex items-center justify-center",children:e.jsx(r,{className:"w-4 h-4 text-[#1a2942]"})}),e.jsx("span",{className:"text-sm font-medium",children:"user"===t.role?"Vous":"Francis"})]}),e.jsx("div",{className:"prose prose-invert max-w-none",children:t.content.split("\n").map(((t,s)=>e.jsx("p",{className:"mb-2 last:mb-0",children:t},s)))})]})},i)))}),!c&&h.length>1&&e.jsxs("div",{className:"px-6 py-4 border-t border-[#c5a572]/20",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Questions suggérées :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["Comment optimiser ma déclaration d'impôts ?","Quelles sont les meilleures stratégies de défiscalisation ?","Comment gérer ma TVA en tant qu'auto-entrepreneur ?","Quels sont les avantages fiscaux pour les investissements immobiliers ?"].map(((t,s)=>e.jsx("button",{onClick:()=>{l(t),X(new Event("submit"))},className:"px-3 py-1.5 bg-white/5 hover:bg-white/10 text-sm text-gray-300 rounded-full transition-colors",children:t},s)))})]}),e.jsx("div",{className:"p-4 border-t border-[#c5a572]/20 bg-[#1a2942]/50",children:e.jsxs("form",{onSubmit:X,className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:o,onChange:e=>l(e.target.value),placeholder:"Posez votre question à Francis...",className:"w-full rounded-xl bg-white/5 border border-[#c5a572]/30 text-white focus:border-[#c5a572] focus:ring-[#c5a572] pl-4 pr-12 py-3",disabled:c}),e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center space-x-2",children:[e.jsx("input",{type:"file",id:"file-upload",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:async e=>{e.target.files&&e.target.files[0]&&await Y(e.target.files[0])},disabled:c}),e.jsx("label",{htmlFor:"file-upload",className:"text-gray-400 hover:text-white cursor-pointer transition-colors "+(c?"opacity-50 cursor-not-allowed":""),children:e.jsx(k,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-[#c5a572] text-[#1a2942] rounded-xl hover:bg-[#d4b583] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#c5a572] transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:c?e.jsx(N,{className:"w-5 h-5 animate-spin"}):e.jsx(S,{className:"w-5 h-5"})})]})}),c&&e.jsx("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-[#1a2942] rounded-lg shadow-lg p-4 border border-[#c5a572]/30",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(N,{className:"w-5 h-5 text-[#c5a572] animate-spin"}),e.jsx("span",{className:"text-white",children:"Francis réfléchit..."})]})})]},"chat"),"analytics"===m&&e.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-[#1a2942]/95 backdrop-blur-lg rounded-2xl shadow-xl overflow-hidden border border-[#c5a572]/20",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Analytics"}),e.jsxs("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Connexion Bancaire"}),e.jsx("p",{className:"text-gray-400",children:"Connectez votre compte bancaire pour une analyse en temps réel"})]}),e.jsx("button",{onClick:async()=>{D(!0);try{const e=await fetch("http://localhost:8001/init-truelayer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:$})});if(!e.ok)throw new Error("Erreur lors de l'initialisation de TrueLayer");const{clientId:t,redirectUri:s}=await e.json();new window.TrueLayer({clientId:t,redirectUri:s,scope:["accounts","transactions","balance"],locale:"fr",onSuccess:async e=>{const t=await fetch("http://localhost:8001/bank-data",{method:"GET",headers:{Authorization:`Bearer ${e.accessToken}`}});if(!t.ok)throw new Error("Erreur lors de la récupération des données");const s=await t.json();M(s),z((e=>[...e,"Compte bancaire"]));const r=`J'ai analysé vos données bancaires. Voici un résumé :\n\n• Solde total : ${s.totalBalance}€\n• Revenus mensuels : ${s.analysis.revenus.total}€\n• Dépenses mensuelles : ${s.analysis.depenses.total}€\n• Taux d'épargne : ${s.analysis.tendances.taux_epargne.toFixed(1)}%\n\nJe peux vous aider à optimiser votre situation fiscale en fonction de ces données.`;u((e=>[...e,{role:"assistant",content:r}]))},onError:e=>{console.error("Erreur TrueLayer:",e),u((t=>[...t,{role:"assistant",content:`Désolé, je n'ai pas pu me connecter à votre compte bancaire : ${e.error_description}`}]))}}).open()}catch(e){console.error("Erreur de connexion bancaire:",e),u((e=>[...e,{role:"assistant",content:"Désolé, je rencontre des difficultés techniques. Veuillez réessayer dans quelques instants."}]))}finally{D(!1)}},disabled:U,className:"px-4 py-2 bg-[#c5a572] text-[#1a2942] rounded-lg hover:bg-[#d4b583] transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:U?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Connexion en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-5 h-5"}),e.jsx("span",{children:"Connecter mon compte"})]})})]}),q.length>0&&e.jsx("div",{className:"mt-4 p-4 bg-white/5 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-green-500"})}),e.jsx("span",{className:"text-white font-medium",children:"Compte bancaire connecté"})]}),e.jsx("span",{className:"text-[#c5a572] text-sm",children:"Données à jour"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Performance"}),F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Solde total"}),e.jsxs("span",{className:"text-[#c5a572] font-semibold",children:[F.totalBalance,"€"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Revenus mensuels"}),e.jsxs("span",{className:"text-[#c5a572] font-semibold",children:[F.analysis.revenus.total,"€"]})]})]}):e.jsx("p",{className:"text-gray-400",children:"Connectez votre compte pour voir les analyses"})]}),e.jsxs("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Risques"}),F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Ratio d'endettement"}),e.jsxs("span",{className:"text-[#c5a572] font-semibold",children:[F.debtRatio,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Épargne mensuelle"}),e.jsxs("span",{className:"text-[#c5a572] font-semibold",children:[F.analysis.tendances.taux_epargne.toFixed(1),"%"]})]})]}):e.jsx("p",{className:"text-gray-400",children:"Connectez votre compte pour voir les analyses"})]}),e.jsxs("div",{className:"bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Objectifs"}),F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Progression"}),e.jsxs("span",{className:"text-[#c5a572] font-semibold",children:[F.goalsProgress,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Objectif mensuel"}),e.jsxs("span",{className:"text-[#c5a572] font-semibold",children:[F.monthlyGoal,"€"]})]})]}):e.jsx("p",{className:"text-gray-400",children:"Connectez votre compte pour voir les analyses"})]})]}),e.jsxs("div",{className:"mt-8 bg-[#1a2942]/40 backdrop-blur-sm rounded-xl border border-[#c5a572]/30 p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Analyse de vos dépenses"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Francis analyse vos transactions bancaires pour vous aider à :"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-[#c5a572]/20 flex items-center justify-center flex-shrink-0",children:e.jsx(p,{className:"w-6 h-6 text-[#c5a572]"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-2",children:"Équilibrer votre budget"}),e.jsx("p",{className:"text-gray-400",children:"Visualisez vos dépenses par catégorie et identifiez les postes où vous pouvez optimiser votre budget."})]})]}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-[#c5a572]/20 flex items-center justify-center flex-shrink-0",children:e.jsx(a,{className:"w-6 h-6 text-[#c5a572]"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-2",children:"Comprendre vos dépenses"}),e.jsx("p",{className:"text-gray-400",children:"Découvrez où va votre argent et recevez des recommandations personnalisées pour optimiser vos finances."})]})]})]})]})]})},"analytics"),"settings"===m&&e.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-[#1a2942]/95 backdrop-blur-lg rounded-2xl shadow-xl overflow-hidden border border-[#c5a572]/20",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Paramètres"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-6 border border-[#c5a572]/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Profil"}),e.jsx("p",{className:"text-gray-400",children:"Gérez vos informations personnelles"})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-6 border border-[#c5a572]/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Notifications"}),e.jsx("p",{className:"text-gray-400",children:"Configurez vos préférences de notification"})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-6 border border-[#c5a572]/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Sécurité"}),e.jsx("p",{className:"text-gray-400",children:"Gérez votre sécurité et confidentialité"})]})]})]})},"settings")]})})})]})}function Tr({open:t,onClose:s}){return t?e.jsx("div",{style:{position:"fixed",zIndex:1e3,left:0,top:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.5)"},onClick:s,children:e.jsxs("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",background:"#1a2942",color:"#fff",borderRadius:12,maxWidth:600,width:"90vw",maxHeight:"90vh",overflowY:"auto",padding:24,fontSize:12,boxShadow:"0 8px 32px #0008"},onClick:e=>e.stopPropagation(),children:[e.jsx("button",{onClick:s,style:{position:"absolute",right:12,top:12,background:"none",border:"none",color:"#c5a572",fontWeight:"bold",fontSize:18,cursor:"pointer"},children:"×"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"inherit",fontSize:11,color:"#e8cfa0",marginTop:24},children:"MENTIONS LÉGALES ET CONDITIONS GÉNÉRALES D'UTILISATION (CGU)\n\nDERNIÈRE MISE À JOUR : 27 MAI 2025\n\nRésumé express\n• Vos données sont protégées, chiffrées, stockées selon les standards RGPD, jamais revendues et supprimables sur simple demande.\n• Abonnement clair, résiliable à tout moment, prix garanti à vie pour les 100 premiers inscrits.\n• Support humain et contact facile : fiscalia.group@gmail.com\n\n⸻\n\n1. Identification de l'Éditeur\n\nNom du site : Fiscal.IA\nÉditeur : FISCAL.IA SAS au capital de 100 €\n• SIREN : 943 531 152\n• SIRET : 943 531 152 00016\n• Siège social : 17 Chemin du Prieuré, 79260 La Crèche, France\n• Directeur de la publication : Monsieur Garcia Aitor\n\nHébergeur :\nNetlify, Inc.\n44 Montgomery Street, Suite 300, San Francisco, CA 94104, USA\nTél. : +1 415-691-1573\nEmail : support@netlify.com\n\nContact général : fiscalia.group@gmail.com\n\n⸻\n\n2. Définitions\n\nDans les présentes CGU, les termes suivants ont la signification ci-après :\n• « Site » : le portail accessible à l'URL https://www.fiscal.ia et ses sous-domaines.\n• « Utilisateur » : toute personne physique majeure accédant au Site.\n• « Données Utilisateur » : toutes informations collectées lors de l'utilisation du Site.\n• « Services » : l'ensemble des fonctionnalités proposées par Fiscal.IA, notamment l'assistant fiscal et financier.\n\n⸻\n\n3. Objet\n\nLe présent document définit les modalités et conditions dans lesquelles FISCAL.IA met à disposition des Utilisateurs les Services du Site. L'utilisation du Site implique l'acceptation sans réserve des présentes CGU.\n\n⸻\n\n4. Accès et conditions d'utilisation\n1. Accès\n• L'accès au Site est réservé aux personnes physiques majeures (18 ans révolus) et capables juridiquement.\n2. Création de compte\n• Certaines fonctionnalités exigent un compte. L'Utilisateur est responsable de la confidentialité de ses identifiants et de toutes les activités réalisées via son compte.\n3. Usage licite\n• L'Utilisateur s'engage à utiliser le Site conformément aux lois en vigueur et aux présentes CGU. Tout usage frauduleux ou abusif pourra entraîner la suspension ou la suppression du compte.\n4. Responsabilité de l'Utilisateur\n• Il appartient à l'Utilisateur de vérifier la conformité des suggestions IA auprès d'experts compétents avant tout usage.\n\n⸻\n\n5. Propriété intellectuelle\n\nTous les éléments (textes, logos, marques, visuels, logiciels, bases de données) présents sur le Site sont la propriété exclusive de FISCAL.IA ou de ses partenaires. Toute reproduction, représentation ou exploitation non autorisée est interdite et constitue une contrefaçon.\n\n⸻\n\n6. Données personnelles et RGPD\n1. Responsable de traitement : FISCAL.IA SAS\n2. Finalités\n• Gestion des abonnements, personnalisation des services, amélioration et sécurité du Site.\n3. Catégories de données\n• Identification (email, nom d'utilisateur), fiscales (revenus, dépenses), financières (épargne, budget), techniques (adresse IP, logs).\n4. Base légale\n• Exécution du contrat (art. 6.1.b RGPD) et intérêt légitime (art. 6.1.f RGPD).\n5. Durées de conservation\n• Données fiscales et financières : durée de l'abonnement + 5 ans.\n• Données de compte : jusqu'à suppression.\n• Données techniques : 1 an.\n6. Transferts hors UE\n• Conformes via clauses contractuelles types.\n7. Droits des Utilisateurs\n• Accès, rectification, suppression, limitation, portabilité, opposition.\n• Exercice par email à fiscalia.group@gmail.com ou courrier au siège.\n8. Cookies\n• Cookie strictement nécessaires, analytiques et fonctionnels.\n• Consentement géré via bannière.\n• Paramétrage possible à tout moment dans votre navigateur.\n9. Délégué à la protection des données (DPO)\n• Contact : fiscalia.group@gmail.com\n\n⸻\n\n7. Clauses de responsabilité\n1. Absence de conseil personnalisé\n• Les suggestions IA sont fournies \"en l'état\" sans garantie. Elles ne constituent pas un conseil fiscal ou financier personnalisé.\n2. Limitation de responsabilité\n• FISCAL.IA décline toute responsabilité en cas de dommages directs ou indirects résultant de l'utilisation du Site ou de l'impossibilité d'y accéder.\n3. Force majeure\n• Événements échappant au contrôle de FISCAL.IA (incendie, inondation, cyberattaque, grève) exonèrent partiellement ou totalement la responsabilité de l'Éditeur.\n4. Indemnisation\n• L'Utilisateur s'engage à indemniser FISCAL.IA contre toute réclamation ou dommage résultant de son usage non conforme du Site.\n\n⸻\n\n8. Conditions tarifaires et abonnement\n1. Tarif\n• Abonnement mensuel : 9,99 € TTC.\n• Prix garanti à vie pour les 100 premiers inscrits (bêta privée avant 15/05/2025).\n2. Facturation et paiement\n• Paiement automatique par carte bancaire via un prestataire sécurisé.\n3. Renouvellement et résiliation\n• Renouvellement automatique chaque mois.\n• Résiliation possible à tout moment via l'espace \"Mon Compte\" ou par email.\n• Résiliation effective en fin de période en cours, sans remboursement prorata.\n4. Droit de rétractation\n• 14 jours selon l'article L.221-18 du Code de la consommation, sans frais, par email à fiscalia.group@gmail.com.\n\n⸻\n\n9. Loi applicable et juridiction\n\nLes présentes CGU sont régies par le droit français. Tout litige relatif à leur interprétation ou exécution sera de la compétence exclusive des tribunaux de Niort, France.\n\n⸻\n\n10. Modification des CGU\n\nFISCAL.IA se réserve le droit de modifier à tout moment les présentes CGU. Les modifications seront publiées sur cette page et notifiées par email. L'utilisation continue du Site après publication vaut acceptation des nouvelles CGU.\n\n⸻\n\nPour toute question ou réclamation, contactez-nous à fiscalia.group@gmail.com."})]})}):null}function Er(){const[t,s]=A.useState(null),[r,i]=A.useState(!0),[n,a]=A.useState(!1);return A.useEffect((()=>{xr.auth.getSession().then((({data:{session:e}})=>{s((null==e?void 0:e.user)??null),i(!1)}));const{data:{subscription:e}}=xr.auth.onAuthStateChange(((e,t)=>{s((null==t?void 0:t.user)??null)}));return()=>e.unsubscribe()}),[]),r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#1a2942] via-[#223c63] to-[#234876] flex items-center justify-center",children:e.jsx("div",{className:"text-white text-xl",children:"Chargement..."})}):e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsxs($,{children:[e.jsx(L,{path:"/",element:e.jsx(Nr,{})}),e.jsx(L,{path:"/dashboard",element:t?e.jsx(Sr,{}):e.jsx(U,{to:"/",replace:!0})}),e.jsx(L,{path:"*",element:e.jsx(U,{to:"/",replace:!0})})]})}),e.jsx("footer",{style:{position:"fixed",left:0,right:0,bottom:0,zIndex:100,textAlign:"center",fontSize:10,color:"#c5a572",background:"rgba(26,41,66,0.85)",padding:4,letterSpacing:.5},children:e.jsx("button",{style:{background:"none",border:"none",color:"#c5a572",textDecoration:"underline",cursor:"pointer",fontSize:10},onClick:()=>a(!0),children:"Mentions légales et CGU"})}),e.jsx(Tr,{open:n,onClose:()=>a(!1)})]})}D.createRoot(document.getElementById("root")).render(e.jsx(O.StrictMode,{children:e.jsx(Er,{})}));
